<!DOCTYPE html>
<html lang="en-US" />
<head>
    <meta http-equiv="Content-Type" content="text/html" charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="google-site-verification" content="gBfbdXRLofaOyHsbgiSiuCIHKPaviGMRVWh_qOfDHNE" />

    <title>Add a client-side paywall using checkoutpage.co and vanilla JavaScript &middot; Code with Hugo</title>

    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="apple-touch-icon" sizes="120x120" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#00aba9">
    <meta name="theme-color" content="#090a0b">

    <link rel="shortcut icon" href="https://codewithhugo.com/favicon.ico" />
    <meta name="theme-color" content="#090a0b">
    
    <link rel="canonical" href="https://codewithhugo.com/add-a-client-side-paywall-using-checkoutpage.co-and-vanilla-javascript/" /> 

     <meta name="description" content="How I created the buying mechanism for the Sequelize ES6 Cheatsheet using checkoutpage.co and sprinkles of vanilla JavaScript.
This strictly isn’t a paywall, it" /> 

     
    
    <meta name="twitter:card" content="summary_large_image"/>
    <meta name="twitter:image" content="https://codewithhugo.com/img/samuel-zeller-2-unsplash.jpg"/>
    
 
    <meta name="twitter:title" content="Add a client-side paywall using checkoutpage.co and vanilla JavaScript"/>
    <meta name="twitter:description" content="How I created the buying mechanism for the Sequelize ES6 Cheatsheet using checkoutpage.co and sprinkles of vanilla JavaScript.
This strictly isn’t a paywall, it"/>
    <meta name="twitter:url" content="https://codewithhugo.com/add-a-client-side-paywall-using-checkoutpage.co-and-vanilla-javascript/" />
    <meta name="twitter:site" content="@hugo__df"/>

    <meta property="og:site_name" content="Code with Hugo" />
    <meta property="og:title" content="Add a client-side paywall using checkoutpage.co and vanilla JavaScript &middot; Code with Hugo" />
    <meta property="og:url" content="https://codewithhugo.com/add-a-client-side-paywall-using-checkoutpage.co-and-vanilla-javascript/" />
    

    <meta property="og:type" content="article" />
    <meta property="og:description" content="How I created the buying mechanism for the Sequelize ES6 Cheatsheet using checkoutpage.co and sprinkles of vanilla JavaScript.
This strictly isn’t a paywall, it" />

    <meta property="article:published_time" content="2018-11-22T00:00:00Z" />
    <meta property="article:tag" content="JavaScript" /><meta property="article:tag" content="meta" /><meta property="article:tag" content="payment" />

    <meta property="og:image" content="https://codewithhugo.com/img/samuel-zeller-2-unsplash.jpg"/>


    <meta name="generator" content="Hugo 0.46" />

    <!-- Stylesheets -->
    <link rel="stylesheet" type="text/css" href="https://codewithhugo.com/built/screen.css" />
    <link rel="stylesheet" type="text/css" href="https://codewithhugo.com/css/casper-two.css" />
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css" />
    
      
      <link rel="stylesheet" href="https://codewithhugo.com/overrides.min.bd35cf74c58c56c4aa8eff40730357744dec20ff31d8bae7b0618dbe30e0dbe4.css">
    
      
      <link rel="stylesheet" href="https://codewithhugo.com/syntax.min.e1646a3f88f77e1b5e7d0253633b1958013aa132890dfe4d7e15dc4718d4aecc.css">
    
      
      <link rel="stylesheet" href="https://codewithhugo.com/cta.min.2a90f41cf8cf23510a102e013116d80ad7ed31824b86f0862a21f69386ec9a51.css">
    

    

     
</head>


<body class="post-template">
  <div class="site-wrapper"> 

<header class="site-header outer">
  <div class="inner">
    <nav class="site-nav">
      <div class="site-nav-left">

        <ul class="nav" role="menu">
        
        
        
            <li class="" role="menuitem">
              <a href="/">Home</a>
            </li>
        
            <li class="" role="menuitem">
              <a href="/guides/">guides</a>
            </li>
        
            <li class="" role="menuitem">
              <a href="/tags/javascript/">JavaScript</a>
            </li>
        
            <li class="" role="menuitem">
              <a href="/tags/node/">Node</a>
            </li>
        
            <li class="" role="menuitem">
              <a href="/tags/css/">CSS</a>
            </li>
        
            <li class="" role="menuitem">
              <a href="/open/">#open</a>
            </li>
        
      </ul></div>

      <div class="site-nav-right">
        <div class="social-links">
                    

                    <a class="social-link social-link-tw" href="https://twitter.com/hugo__df" target="_blank" rel="noopener"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M30.063 7.313c-.813 1.125-1.75 2.125-2.875 2.938v.75c0 1.563-.188 3.125-.688 4.625a15.088 15.088 0 0 1-2.063 4.438c-.875 1.438-2 2.688-3.25 3.813a15.015 15.015 0 0 1-4.625 2.563c-1.813.688-3.75 1-5.75 1-3.25 0-6.188-.875-8.875-2.625.438.063.875.125 1.375.125 2.688 0 5.063-.875 7.188-2.5-1.25 0-2.375-.375-3.375-1.125s-1.688-1.688-2.063-2.875c.438.063.813.125 1.125.125.5 0 1-.063 1.5-.25-1.313-.25-2.438-.938-3.313-1.938a5.673 5.673 0 0 1-1.313-3.688v-.063c.813.438 1.688.688 2.625.688a5.228 5.228 0 0 1-1.875-2c-.5-.875-.688-1.813-.688-2.75 0-1.063.25-2.063.75-2.938 1.438 1.75 3.188 3.188 5.25 4.25s4.313 1.688 6.688 1.813a5.579 5.579 0 0 1 1.5-5.438c1.125-1.125 2.5-1.688 4.125-1.688s3.063.625 4.188 1.813a11.48 11.48 0 0 0 3.688-1.375c-.438 1.375-1.313 2.438-2.563 3.188 1.125-.125 2.188-.438 3.313-.875z"/></svg></a>

                    <a class="social-link" href="https://github.com/HugoDF" target="_blank" rel="noopener"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a>

                    

                    <a class="social-link" href="https://medium.com/@hugo__df" target="_blank" rel="noopener"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 195 195"><path d="M46.5340803,65.2157554 C46.6968378,63.6076572 46.0836,62.018231 44.8828198,60.93592 L32.6512605,46.2010582 L32.6512605,44 L70.6302521,44 L99.9859944,108.380952 L125.794585,44 L162,44 L162,46.2010582 L151.542017,56.2281011 C150.640424,56.9153477 150.193188,58.0448862 150.380019,59.1628454 L150.380019,132.837155 C150.193188,133.955114 150.640424,135.084652 151.542017,135.771899 L161.755369,145.798942 L161.755369,148 L110.38282,148 L110.38282,145.798942 L120.963119,135.527337 C122.002801,134.487948 122.002801,134.182246 122.002801,132.592593 L122.002801,73.0417402 L92.585901,147.755438 L88.6106443,147.755438 L54.3622782,73.0417402 L54.3622782,123.115814 C54.0767278,125.221069 54.7759199,127.3406 56.2581699,128.863022 L70.0186741,145.55438 L70.0186741,147.755438 L31,147.755438 L31,145.55438 L44.7605042,128.863022 C46.2319621,127.338076 46.8903838,125.204485 46.5340803,123.115814 L46.5340803,65.2157554 Z"/></svg></a>
        </div>  
        
        <a class="subscribe-button" href="https://codewithhugo.com/index.xml">Subscribe</a>
            
      </div>

    </nav>  

  </div>
</header>

<main id="site-main" class="site-main outer" role="main">
  <div class="inner">
    
      <article class="post-full post">
    <header class="post-full-header">
        <section class="post-full-meta">
            <time class="post-full-meta-date" datetime="2018-11-22">22 November 2018</time>
                <span class="date-divider">/</span> <a href="https://codewithhugo.com/tags/javascript/">#JavaScript</a>&nbsp;<a href="https://codewithhugo.com/tags/meta/">#meta</a>&nbsp;
        </section>
        <h1 class="post-full-title">Add a client-side paywall using checkoutpage.co and vanilla JavaScript</h1>
    </header>
    <div class="hero-container">

      
      <figure class="post-full-image" style="background-image: url(https://codewithhugo.com/img/samuel-zeller-2-unsplash.jpg)">
        

      </figure>
    </div>

    <section class="post-full-content">
        <div class="kg-card-markdown">
        

<p>How I created the buying mechanism for the <a href="https://codewithhugo.com/guides/sequelize-es6-cheatsheet/">Sequelize ES6 Cheatsheet</a> using checkoutpage.co and sprinkles of vanilla JavaScript.</p>

<p>This strictly <em>isn’t</em> a paywall, it&rsquo;s all client-side and doesn&rsquo;t check much.</p>

<p>In principle you can display the whole things using a bit of CSS magic. You could also read the source and reverse-engineer what query params work for this page.</p>

<p>You could also spoof as Google Bot (or another crawler) and skip the pay overlay. If someone shares the link containing the &ldquo;paid&rdquo; query param whoever they’re sharing with will see it without paying.</p>

<p>I don&rsquo;t think it&rsquo;s likely that people will go through the effort of doing the above reverse-engineering, so I&rsquo;m going to walk anyone who will listen through how I&rsquo;ve implemented it.</p>

<p>If you like getting the cheatsheet for free but also want to support my work you can <a href="buymeacoff.ee/hugodf">Buy me a Coffee</a> or just <a href="https://buttondown.email/hugo">subscribe to my mailing list</a>.</p>

<h2 id="set-up-hiding-of-content">Set up hiding of content</h2>

<p>I use the following CSS:</p>
<div class="highlight"><pre class="chroma"><code class="language-css" data-lang="css"><span class="p">.</span><span class="nc">site-wrapper</span><span class="p">.</span><span class="nc">js-site-wrapper--no-scroll</span> <span class="p">{</span>
  <span class="k">top</span><span class="p">:</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">left</span><span class="p">:</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">width</span><span class="p">:</span> <span class="mi">100</span><span class="kt">%</span><span class="p">;</span>
  <span class="k">z-index</span><span class="p">:</span> <span class="mi">1</span><span class="p">;</span>
  <span class="k">position</span><span class="p">:</span> <span class="kc">fixed</span><span class="p">;</span>
<span class="p">}</span>

<span class="p">.</span><span class="nc">js-site-wrapper--no-scroll</span> <span class="p">.</span><span class="nc">post-full__table-of-contents</span> <span class="p">{</span>
  <span class="k">height</span><span class="p">:</span> <span class="mi">100</span><span class="kt">%</span><span class="p">;</span>
  <span class="k">overflow</span><span class="p">:</span> <span class="kc">hidden</span><span class="p">;</span>
<span class="p">}</span></code></pre></div>
<p>This won’t work if your content is already inside of a <code>relative</code>, <code>absolute</code> or <code>fixed</code> position container but it works for me 🤷‍♀️.</p>

<p>The corresponding JS code is pretty simple:</p>
<div class="highlight"><pre class="chroma"><code class="language-html" data-lang="html"><span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
  <span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nb">document</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">const</span> <span class="nx">SITE_WRAPPER_SELECTOR</span> <span class="o">=</span> <span class="s1">&#39;.js-site-wrapper&#39;</span><span class="p">;</span>
    <span class="k">const</span> <span class="nx">SITE_WRAPPER_NO_SCROLL_CLASS</span> <span class="o">=</span> <span class="s1">&#39;js-site-wrapper--no-scroll&#39;</span><span class="p">;</span>
    
    <span class="nx">$siteWrapper</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="nx">SITE_WRAPPER_SELECTOR</span><span class="p">);</span>
    <span class="kd">function</span> <span class="nx">didBuy</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="kd">function</span> <span class="nx">init</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">didBuy</span><span class="p">())</span> <span class="p">{</span>
        <span class="c1">// disable scroll/hide all the things
</span><span class="c1"></span>        <span class="nx">$siteWrapper</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">SITE_WRAPPER_NO_SCROLL_CLASS</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="nx">init</span><span class="p">();</span>
  <span class="p">})(</span><span class="nb">document</span><span class="p">);</span>
<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span></code></pre></div>
<p>Everything is wrapped in an IIFE (immediately invoked function expression) to be nice and old school (and not pollute the global namespace). We pass the document into the IIFE (<code>})(document);</code>) and define it as a parameter (<code>function (document)</code>).</p>

<p>I like to set selectors and classes as constants and prefix elements with <code>$</code> eg. <code>$siteWrapper</code>, again a bit of a throwback to jQuery days.</p>

<h2 id="just-display-everything-when-crawler-or-old-browser">Just display everything when crawler or old browser</h2>

<p>This is inspired by <a href="https://github.com/Swizec/es6-cheatsheet/blob/master/src/pages/index.js#L27-L59">Swizec&rsquo;s ES6 cheatsheet source</a>.</p>

<p>We want to display everything (no <code>no-scroll</code> class) to crawlers.</p>

<p>We start by adding a crawler regex pattern from <a href="https://beta.observablehq.com/@hugodf/crawler-regex">observablehq.com/@hugodf/crawler-regex</a> which fetches from <a href="https://github.com/monperrus/crawler-user-agents">github.com/monperrus/crawler-user-agents</a> under the hood and concatenates the individual patterns.</p>

<p>We turn that into a fully-fledged RegEx object that doesn’t care about case (hence the <code>'i'</code> flag).</p>

<p>The new code in <code>didBuy</code>, is still not the most complex:
if we don’t have a <code>navigator</code> object, just bail (ie. pretend like the person bought it), since it’s likely an old browser.
If we get this far, check the user agent against crawler regular expression, display everything if it’s Google Bot or another crawler.</p>
<div class="highlight"><pre class="chroma"><code class="language-html" data-lang="html"><span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
  <span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nb">document</span><span class="p">,</span> <span class="nx">navigator</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Get from https://beta.observablehq.com/@hugodf/crawler-regex
</span><span class="c1"></span>    <span class="k">const</span> <span class="nx">crawlerPattern</span> <span class="o">=</span> <span class="s2">&#34;REPLACE_ME&#34;</span><span class="p">;</span>
    <span class="k">const</span> <span class="nx">crawlerRegEx</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">RegExp</span><span class="p">(</span><span class="nx">crawlerPattern</span><span class="p">,</span> <span class="s1">&#39;i&#39;</span><span class="p">);</span>
    <span class="k">const</span> <span class="nx">SITE_WRAPPER_SELECTOR</span> <span class="o">=</span> <span class="s1">&#39;.js-site-wrapper&#39;</span><span class="p">;</span>
    <span class="k">const</span> <span class="nx">SITE_WRAPPER_NO_SCROLL_CLASS</span> <span class="o">=</span> <span class="s1">&#39;js-site-wrapper--no-scroll&#39;</span><span class="p">;</span>
    
    <span class="nx">$siteWrapper</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="nx">SITE_WRAPPER_SELECTOR</span><span class="p">);</span>
    
    <span class="kd">function</span> <span class="nx">isCrawler</span><span class="p">(</span><span class="nx">userAgent</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">crawlerRegEx</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">userAgent</span><span class="p">);</span>
    <span class="p">}</span>
    
    <span class="kd">function</span> <span class="nx">didBuy</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">navigator</span> <span class="o">===</span> <span class="s2">&#34;undefined&#34;</span> <span class="o">||</span> <span class="k">typeof</span> <span class="nb">window</span> <span class="o">===</span> <span class="s2">&#34;undefined&#34;</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">isCrawler</span><span class="p">(</span><span class="nx">navigator</span><span class="p">.</span><span class="nx">userAgent</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="kd">function</span> <span class="nx">init</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">didBuy</span><span class="p">())</span> <span class="p">{</span>
        <span class="c1">// disable scroll/hide all the things
</span><span class="c1"></span>        <span class="nx">$siteWrapper</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">SITE_WRAPPER_NO_SCROLL_CLASS</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="nx">init</span><span class="p">();</span>
  <span class="p">})(</span><span class="nb">document</span><span class="p">,</span> <span class="nx">navigator</span><span class="p">);</span>
<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span></code></pre></div>
<h2 id="setup-checkout-page">Setup checkout page</h2>

<p><a href="https://checkoutpage.co">checkoutpage.co</a>: “Checkout pages and forms to sell your products and services. Installed in minutes without coding”. It’s a simple and great way to add a payment page to your site. It just integrates with your Stripe account and gives you URLs to point to.</p>

<p>Let’s set it up, create an account, link it to Stripe, create a new page. Fill in whatever fields you feel like/are required. For <a href="https://checkoutpage.co">checkoutpage.co</a> to work with our client-side paywall code, we’ll have to do a couple of things.</p>

<p>The “Return URL” (Page → Settings → Return URL) should have a query param which will allow us to know someone has paid, that’s as simple as appending <code>?key=has-paid</code> to the URL.</p>

<p>Your complete URL should be of the form: <code>https://your-domain.tld/path/to/cheatsheet/page?key=has-paid</code>.</p>

<p>We should add an email collection field so we can send a confirmation email. Let’s do so at Page → Fields → Add Field with the following data:</p>

<ul>
<li>Label: Email</li>
<li>DataType: Customer Email</li>
<li>required: true</li>
</ul>

<p>If we want to collect the email addresses to add to a mailing list and we want to be GDPR-compliant, we need an opt-in field.</p>

<p>To do so go to Page → Fields → Add Field and create a new field with the following options:
- Label: “I would like to receive the Code with Hugo newsletter”
- DataType: unselected (free text field)
- Placeholder: “No”, this is important and makes this an opt-in
- required: false</p>

<p>Set up a custom “Confirmation Message” email so users can pay once and keep accessing the cheatsheet (eg. from different devices). That’s at Page → Settings → Confirmation Message.</p>

<p>You can use the same query params <code>?key=has-paid</code> or use a different one. Here’s my confirmation email:</p>

<pre><code>Hey there 👋,

Thanks for buying the Sequelize ES6 cheat sheet.

This email confirms your payment. 

You can access the Sequelize ES6 cheat sheet using this link: https://codewithhugo.com/guides/sequelize-cheatsheet?key=list.

Payment details

Paid for: Sequelize ES6 Cheatsheet 
Paid to: Hugo 
Amount: $1.99


If you've opted in, you'll be added to the Code with Hugo newsletter. You can easily unsubscribe from the mailing list by clicking the unsubscribe link at the bottom of each email.
</code></pre>

<p>Checkoutpage will add some extra text after our message when the confirmation email gets sent.</p>

<h2 id="add-a-button-that-points-to-checkoutpage-co">Add a button that points to checkoutpage.co</h2>

<p>I leave this as an implementation detail since Sander has done awesome work with his <a href="https://checkoutpage.co/buy-buttons/">Buy buttons</a>.</p>

<p><strong>tl;dr</strong> You literally just need to point a link to your checkoutpage page 🙂</p>

<h2 id="check-the-query-for-key-values-sets-that-are-allowed">Check the query for key-values sets that are allowed</h2>

<p>Now we want to set some values which will be valid “paid” params and the current page’s query params against that.</p>

<p>That means creating a <code>getQueryObject</code> function which takes <code>window.location.search</code>, removes <code>?</code> takes each <code>&amp;key=value</code> to convert them into an object like <code>{ key: &quot;value&quot; }</code>.</p>

<p>We then take this <code>queryObject</code> and match it against our <code>PAID_QUERY_PARAMS</code>. If for a <code>PAID_QUERY_PARAMS</code> object, all the query keys match the values, then the user has paid. This is the snippet that does the work:</p>
<div class="highlight"><pre class="chroma"><code class="language-js" data-lang="js"><span class="k">const</span> <span class="nx">bought</span> <span class="o">=</span> <span class="nx">PAID_QUERY_PARAMS</span><span class="p">.</span><span class="nx">some</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">queryParams</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">entries</span><span class="p">(</span><span class="nx">queryParams</span><span class="p">).</span><span class="nx">every</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">keyValue</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">const</span> <span class="nx">key</span> <span class="o">=</span> <span class="nx">keyValue</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
    <span class="k">const</span> <span class="nx">value</span> <span class="o">=</span> <span class="nx">keyValue</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
    <span class="k">return</span> <span class="nx">query</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">===</span> <span class="nx">value</span><span class="p">;</span>
  <span class="p">});</span>
<span class="p">});</span>
</code></pre></div>
<p>To be semi-compatible with slightly older browsers I didn’t use arrow functions/destructuring although doing so would make the code more readable, in ES6+ I would do:</p>
<div class="highlight"><pre class="chroma"><code class="language-js" data-lang="js"><span class="k">const</span> <span class="nx">bought</span> <span class="o">=</span> <span class="nx">PAID_QUERY_PARAMS</span><span class="p">.</span><span class="nx">some</span><span class="p">((</span><span class="nx">queryParams</span><span class="p">)</span> <span class="p">=&gt;</span>
  <span class="nb">Object</span><span class="p">.</span><span class="nx">entries</span><span class="p">(</span><span class="nx">queryParams</span><span class="p">).</span><span class="nx">every</span><span class="p">(</span>
    <span class="p">([</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">value</span> <span class="p">])</span> <span class="p">=&gt;</span> <span class="nx">query</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">===</span> <span class="nx">value</span>
  <span class="p">);</span>
<span class="p">);</span>
</code></pre></div>
<p>Which reads like: “if there’s an entry of <code>PAID_QUERY_PARAMS</code> where for each key/value pair the query value for each key/value pair it matches the <code>PAID_QUERY_PARAMS</code> entry pair”</p>
<div class="highlight"><pre class="chroma"><code class="language-html" data-lang="html"><span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
  <span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nb">document</span><span class="p">,</span> <span class="nx">navigator</span><span class="p">,</span> <span class="nb">window</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">const</span> <span class="nx">PAID_QUERY_PARAMS</span> <span class="o">=</span> <span class="p">[</span> <span class="p">{</span> <span class="nx">key</span><span class="o">:</span> <span class="s1">&#39;list&#39;</span> <span class="p">},</span> <span class="p">{</span> <span class="nx">key</span><span class="o">:</span> <span class="s1">&#39;has-paid&#39;</span> <span class="p">}</span> <span class="p">];</span>
    <span class="c1">// Get from https://beta.observablehq.com/@hugodf/crawler-regex
</span><span class="c1"></span>    <span class="k">const</span> <span class="nx">crawlerPattern</span> <span class="o">=</span> <span class="s2">&#34;REPLACE_ME&#34;</span><span class="p">;</span>
    <span class="k">const</span> <span class="nx">crawlerRegEx</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">RegExp</span><span class="p">(</span><span class="nx">crawlerPattern</span><span class="p">,</span> <span class="s1">&#39;i&#39;</span><span class="p">);</span>
    <span class="k">const</span> <span class="nx">SITE_WRAPPER_SELECTOR</span> <span class="o">=</span> <span class="s1">&#39;.js-site-wrapper&#39;</span><span class="p">;</span>
    <span class="k">const</span> <span class="nx">SITE_WRAPPER_NO_SCROLL_CLASS</span> <span class="o">=</span> <span class="s1">&#39;js-site-wrapper--no-scroll&#39;</span><span class="p">;</span>
    
    <span class="nx">$siteWrapper</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="nx">SITE_WRAPPER_SELECTOR</span><span class="p">);</span>
    
    <span class="kd">function</span> <span class="nx">isCrawler</span><span class="p">(</span><span class="nx">userAgent</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">crawlerRegEx</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">userAgent</span><span class="p">);</span>
    <span class="p">}</span>
    
    <span class="kd">function</span> <span class="nx">getQueryObject</span><span class="p">(</span><span class="nb">window</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">search</span>
        <span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/^\?/</span><span class="p">,</span> <span class="s2">&#34;&#34;</span><span class="p">)</span>
        <span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;&amp;&#39;</span><span class="p">)</span>
        <span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">keyValue</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">keyValue</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">);</span> <span class="p">})</span>
        <span class="p">.</span><span class="nx">reduce</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">acc</span><span class="p">,</span> <span class="nx">keyValue</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">const</span> <span class="nx">k</span> <span class="o">=</span> <span class="nx">keyValue</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
          <span class="k">const</span> <span class="nx">v</span> <span class="o">=</span> <span class="nx">keyValue</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
          <span class="nx">acc</span><span class="p">[</span><span class="nx">k</span><span class="p">]</span> <span class="o">=</span> <span class="nx">v</span><span class="p">;</span>
          <span class="k">return</span> <span class="nx">acc</span><span class="p">;</span>
        <span class="p">},</span> <span class="p">{});</span>
    <span class="p">}</span>
    
    <span class="kd">function</span> <span class="nx">didBuy</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">navigator</span> <span class="o">===</span> <span class="s2">&#34;undefined&#34;</span> <span class="o">||</span> <span class="k">typeof</span> <span class="nb">window</span> <span class="o">===</span> <span class="s2">&#34;undefined&#34;</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">isCrawler</span><span class="p">(</span><span class="nx">navigator</span><span class="p">.</span><span class="nx">userAgent</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
      <span class="p">}</span>
      
      <span class="k">const</span> <span class="nx">query</span> <span class="o">=</span> <span class="nx">getQueryObject</span><span class="p">(</span><span class="nb">window</span><span class="p">);</span>
      <span class="k">const</span> <span class="nx">bought</span> <span class="o">=</span> <span class="nx">PAID_QUERY_PARAMS</span><span class="p">.</span><span class="nx">some</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">queryParams</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">entries</span><span class="p">(</span><span class="nx">queryParams</span><span class="p">).</span><span class="nx">every</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">keyValue</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">const</span> <span class="nx">key</span> <span class="o">=</span> <span class="nx">keyValue</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
          <span class="k">const</span> <span class="nx">value</span> <span class="o">=</span> <span class="nx">keyValue</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
          <span class="k">return</span> <span class="nx">query</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">===</span> <span class="nx">value</span><span class="p">;</span>
        <span class="p">});</span>
      <span class="p">});</span>

      <span class="k">return</span> <span class="nx">bought</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="kd">function</span> <span class="nx">init</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">didBuy</span><span class="p">())</span> <span class="p">{</span>
        <span class="c1">// disable scroll/hide all the things
</span><span class="c1"></span>        <span class="nx">$siteWrapper</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">SITE_WRAPPER_NO_SCROLL_CLASS</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="nx">init</span><span class="p">();</span>
  <span class="p">})(</span><span class="nb">document</span><span class="p">,</span> <span class="nx">navigator</span><span class="p">,</span> <span class="nb">window</span><span class="p">);</span>
<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span></code></pre></div>
<h2 id="persist-to-localstorage">Persist to localstorage</h2>

<p>We’ll want to wipe the query param and store that the user has paid to get past the paywall in localStorage. Why? Well so that the use can navigate to the page from anywhere (maybe through site navigation or something) and still see the content.</p>

<p>To do that we’ll need two extra bits of non-business logic-y stuff:
Some new constants that we can check against:</p>
<div class="highlight"><pre class="chroma"><code class="language-js" data-lang="js"><span class="k">const</span> <span class="nx">PAID_LOCALSTORAGE_KEY</span> <span class="o">=</span> <span class="s1">&#39;MY_KEY&#39;</span><span class="p">;</span>
<span class="k">const</span> <span class="nx">PAID_LOCALSTORAGE_VALUE</span> <span class="o">=</span> <span class="s1">&#39;MY_SUPER_SECRET_VALUE&#39;</span><span class="p">;</span>
</code></pre></div>
<p>and a tiny wrapper around window.localStorage, because why not:</p>
<div class="highlight"><pre class="chroma"><code class="language-js" data-lang="js"><span class="k">const</span> <span class="nx">persist</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">set</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nb">window</span><span class="p">.</span><span class="nx">localStorage</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">value</span><span class="p">);</span>
  <span class="p">},</span>
  <span class="nx">get</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">key</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nb">window</span><span class="p">.</span><span class="nx">localStorage</span><span class="p">.</span><span class="nx">getItem</span><span class="p">(</span><span class="nx">key</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>Then the business logic is as follows, we’ll want to check if a <code>HAS_PAID</code> has been persisted in <code>didBuy</code>, if it hasn’t been set, fall back to checking the query object. If the query object checks out as paid, persist that. ie. in <code>didBuy</code>:</p>
<div class="highlight"><pre class="chroma"><code class="language-js" data-lang="js"><span class="kd">function</span> <span class="nx">didBuy</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// navigator and user agent (crawler) checks  
</span><span class="c1"></span>  <span class="c1">// 1. New PAID in persistence check
</span><span class="c1"></span>  <span class="k">if</span> <span class="p">(</span><span class="nx">persist</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">PAID_LOCALSTORAGE_KEY</span><span class="p">)</span> <span class="o">===</span> <span class="nx">PAID_LOCALSTORAGE_VALUE</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
  <span class="p">}</span>
  
  <span class="c1">// 2. Existing &#34;PAID&#34; check
</span><span class="c1"></span>  <span class="k">const</span> <span class="nx">query</span> <span class="o">=</span> <span class="nx">getQueryObject</span><span class="p">(</span><span class="nb">window</span><span class="p">);</span>
  <span class="k">const</span> <span class="nx">bought</span> <span class="o">=</span> <span class="nx">PAID_QUERY_PARAMS</span><span class="p">.</span><span class="nx">some</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">queryParams</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">entries</span><span class="p">(</span><span class="nx">queryParams</span><span class="p">).</span><span class="nx">every</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">keyValue</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">const</span> <span class="nx">key</span> <span class="o">=</span> <span class="nx">keyValue</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
      <span class="k">const</span> <span class="nx">value</span> <span class="o">=</span> <span class="nx">keyValue</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
      <span class="k">return</span> <span class="nx">query</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">===</span> <span class="nx">value</span><span class="p">;</span>
    <span class="p">});</span>
  <span class="p">});</span>
  
  <span class="c1">// 3. New persist PAID
</span><span class="c1"></span>  <span class="k">if</span> <span class="p">(</span><span class="nx">bought</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">persist</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="nx">PAID_LOCALSTORAGE_KEY</span><span class="p">,</span> <span class="nx">PAID_LOCALSTORAGE_VALUE</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="nx">bought</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>In full that’s:</p>
<div class="highlight"><pre class="chroma"><code class="language-html" data-lang="html"><span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
  <span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nb">document</span><span class="p">,</span> <span class="nx">navigator</span><span class="p">,</span> <span class="nb">window</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">const</span> <span class="nx">PAID_QUERY_PARAMS</span> <span class="o">=</span> <span class="p">[</span> <span class="p">{</span> <span class="nx">key</span><span class="o">:</span> <span class="s1">&#39;list&#39;</span> <span class="p">},</span> <span class="p">{</span> <span class="nx">key</span><span class="o">:</span> <span class="s1">&#39;has-paid&#39;</span> <span class="p">}</span> <span class="p">];</span>
    <span class="k">const</span> <span class="nx">PAID_LOCALSTORAGE_KEY</span> <span class="o">=</span> <span class="s1">&#39;MY_KEY&#39;</span><span class="p">;</span>
    <span class="k">const</span> <span class="nx">PAID_LOCALSTORAGE_VALUE</span> <span class="o">=</span> <span class="s1">&#39;MY_SUPER_SECRET_VALUE&#39;</span><span class="p">;</span>
    <span class="c1">// Get from https://beta.observablehq.com/@hugodf/crawler-regex
</span><span class="c1"></span>    <span class="k">const</span> <span class="nx">crawlerPattern</span> <span class="o">=</span> <span class="s2">&#34;REPLACE_ME&#34;</span><span class="p">;</span>
    <span class="k">const</span> <span class="nx">crawlerRegEx</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">RegExp</span><span class="p">(</span><span class="nx">crawlerPattern</span><span class="p">,</span> <span class="s1">&#39;i&#39;</span><span class="p">);</span>
    <span class="k">const</span> <span class="nx">SITE_WRAPPER_SELECTOR</span> <span class="o">=</span> <span class="s1">&#39;.js-site-wrapper&#39;</span><span class="p">;</span>
    <span class="k">const</span> <span class="nx">SITE_WRAPPER_NO_SCROLL_CLASS</span> <span class="o">=</span> <span class="s1">&#39;js-site-wrapper--no-scroll&#39;</span><span class="p">;</span>
    
    <span class="nx">$siteWrapper</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="nx">SITE_WRAPPER_SELECTOR</span><span class="p">);</span>
    
    <span class="k">const</span> <span class="nx">persist</span> <span class="o">=</span> <span class="p">{</span>
      <span class="nx">set</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nb">window</span><span class="p">.</span><span class="nx">localStorage</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">value</span><span class="p">);</span>
      <span class="p">},</span>
      <span class="nx">get</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">key</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nb">window</span><span class="p">.</span><span class="nx">localStorage</span><span class="p">.</span><span class="nx">getItem</span><span class="p">(</span><span class="nx">key</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>
    
    <span class="kd">function</span> <span class="nx">isCrawler</span><span class="p">(</span><span class="nx">userAgent</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">crawlerRegEx</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">userAgent</span><span class="p">);</span>
    <span class="p">}</span>
    
    <span class="kd">function</span> <span class="nx">getQueryObject</span><span class="p">(</span><span class="nb">window</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">search</span>
        <span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/^\?/</span><span class="p">,</span> <span class="s2">&#34;&#34;</span><span class="p">)</span>
        <span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;&amp;&#39;</span><span class="p">)</span>
        <span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">keyValue</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">keyValue</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">);</span> <span class="p">})</span>
        <span class="p">.</span><span class="nx">reduce</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">acc</span><span class="p">,</span> <span class="nx">keyValue</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">const</span> <span class="nx">k</span> <span class="o">=</span> <span class="nx">keyValue</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
          <span class="k">const</span> <span class="nx">v</span> <span class="o">=</span> <span class="nx">keyValue</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
          <span class="nx">acc</span><span class="p">[</span><span class="nx">k</span><span class="p">]</span> <span class="o">=</span> <span class="nx">v</span><span class="p">;</span>
          <span class="k">return</span> <span class="nx">acc</span><span class="p">;</span>
        <span class="p">},</span> <span class="p">{});</span>
    <span class="p">}</span>
    
    <span class="kd">function</span> <span class="nx">didBuy</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">navigator</span> <span class="o">===</span> <span class="s2">&#34;undefined&#34;</span> <span class="o">||</span> <span class="k">typeof</span> <span class="nb">window</span> <span class="o">===</span> <span class="s2">&#34;undefined&#34;</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">isCrawler</span><span class="p">(</span><span class="nx">navigator</span><span class="p">.</span><span class="nx">userAgent</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
      <span class="p">}</span>
      
      <span class="k">if</span> <span class="p">(</span><span class="nx">persist</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">PAID_LOCALSTORAGE_KEY</span><span class="p">)</span> <span class="o">===</span> <span class="nx">PAID_LOCALSTORAGE_VALUE</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
      <span class="p">}</span>
      
      <span class="k">const</span> <span class="nx">query</span> <span class="o">=</span> <span class="nx">getQueryObject</span><span class="p">(</span><span class="nb">window</span><span class="p">);</span>
      <span class="k">const</span> <span class="nx">bought</span> <span class="o">=</span> <span class="nx">PAID_QUERY_PARAMS</span><span class="p">.</span><span class="nx">some</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">queryParams</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">entries</span><span class="p">(</span><span class="nx">queryParams</span><span class="p">).</span><span class="nx">every</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">keyValue</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">const</span> <span class="nx">key</span> <span class="o">=</span> <span class="nx">keyValue</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
          <span class="k">const</span> <span class="nx">value</span> <span class="o">=</span> <span class="nx">keyValue</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
          <span class="k">return</span> <span class="nx">query</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">===</span> <span class="nx">value</span><span class="p">;</span>
        <span class="p">});</span>
      <span class="p">});</span>
      
      <span class="k">if</span> <span class="p">(</span><span class="nx">bought</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">persist</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="nx">PAID_LOCALSTORAGE_KEY</span><span class="p">,</span> <span class="nx">PAID_LOCALSTORAGE_VALUE</span><span class="p">);</span>
      <span class="p">}</span>

      <span class="k">return</span> <span class="nx">bought</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="kd">function</span> <span class="nx">init</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">didBuy</span><span class="p">())</span> <span class="p">{</span>
        <span class="c1">// disable scroll/hide all the things
</span><span class="c1"></span>        <span class="nx">$siteWrapper</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">SITE_WRAPPER_NO_SCROLL_CLASS</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="nx">init</span><span class="p">();</span>
  <span class="p">})(</span><span class="nb">document</span><span class="p">,</span> <span class="nx">navigator</span><span class="p">,</span> <span class="nb">window</span><span class="p">);</span>
<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span></code></pre></div>
<h2 id="clear-the-query-without-refreshing-the-page">Clear the query without refreshing the page</h2>

<p>The JS snippet to remove query parameters without a refresh using <code>.replaceState</code> is:</p>
<div class="highlight"><pre class="chroma"><code class="language-js" data-lang="js"><span class="nb">window</span><span class="p">.</span><span class="nx">history</span><span class="p">.</span><span class="nx">replaceState</span><span class="p">({},</span> <span class="nb">document</span><span class="p">.</span><span class="nx">title</span><span class="p">,</span> <span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">pathname</span><span class="p">);</span>
</code></pre></div>
<p>So we just stuff that in <code>init</code>:</p>
<div class="highlight"><pre class="chroma"><code class="language-js" data-lang="js"><span class="kd">function</span> <span class="nx">init</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">didBuy</span><span class="p">())</span> <span class="p">{</span>
    <span class="nx">$siteWrapper</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">SITE_WRAPPER_NO_SCROLL_CLASS</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nb">window</span><span class="p">.</span><span class="nx">history</span><span class="p">.</span><span class="nx">replaceState</span><span class="p">({},</span> <span class="nb">document</span><span class="p">.</span><span class="nx">title</span><span class="p">,</span> <span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">pathname</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>The full script is therefore:</p>
<div class="highlight"><pre class="chroma"><code class="language-html" data-lang="html"><span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
  <span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nb">document</span><span class="p">,</span> <span class="nx">navigator</span><span class="p">,</span> <span class="nb">window</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">const</span> <span class="nx">PAID_QUERY_PARAMS</span> <span class="o">=</span> <span class="p">[</span> <span class="p">{</span> <span class="nx">key</span><span class="o">:</span> <span class="s1">&#39;list&#39;</span> <span class="p">},</span> <span class="p">{</span> <span class="nx">key</span><span class="o">:</span> <span class="s1">&#39;has-paid&#39;</span> <span class="p">}</span> <span class="p">];</span>
    <span class="k">const</span> <span class="nx">PAID_LOCALSTORAGE_KEY</span> <span class="o">=</span> <span class="s1">&#39;MY_KEY&#39;</span><span class="p">;</span>
    <span class="k">const</span> <span class="nx">PAID_LOCALSTORAGE_VALUE</span> <span class="o">=</span> <span class="s1">&#39;MY_SUPER_SECRET_VALUE&#39;</span><span class="p">;</span>
    <span class="c1">// Get from https://beta.observablehq.com/@hugodf/crawler-regex
</span><span class="c1"></span>    <span class="k">const</span> <span class="nx">crawlerPattern</span> <span class="o">=</span> <span class="s2">&#34;REPLACE_ME&#34;</span><span class="p">;</span>
    <span class="k">const</span> <span class="nx">crawlerRegEx</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">RegExp</span><span class="p">(</span><span class="nx">crawlerPattern</span><span class="p">,</span> <span class="s1">&#39;i&#39;</span><span class="p">);</span>
    <span class="k">const</span> <span class="nx">SITE_WRAPPER_SELECTOR</span> <span class="o">=</span> <span class="s1">&#39;.js-site-wrapper&#39;</span><span class="p">;</span>
    <span class="k">const</span> <span class="nx">SITE_WRAPPER_NO_SCROLL_CLASS</span> <span class="o">=</span> <span class="s1">&#39;js-site-wrapper--no-scroll&#39;</span><span class="p">;</span>
    
    <span class="nx">$siteWrapper</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="nx">SITE_WRAPPER_SELECTOR</span><span class="p">);</span>
    
    <span class="k">const</span> <span class="nx">persist</span> <span class="o">=</span> <span class="p">{</span>
      <span class="nx">set</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nb">window</span><span class="p">.</span><span class="nx">localStorage</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">value</span><span class="p">);</span>
      <span class="p">},</span>
      <span class="nx">get</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">key</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nb">window</span><span class="p">.</span><span class="nx">localStorage</span><span class="p">.</span><span class="nx">getItem</span><span class="p">(</span><span class="nx">key</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>
    
    <span class="kd">function</span> <span class="nx">isCrawler</span><span class="p">(</span><span class="nx">userAgent</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">crawlerRegEx</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">userAgent</span><span class="p">);</span>
    <span class="p">}</span>
    
    <span class="kd">function</span> <span class="nx">getQueryObject</span><span class="p">(</span><span class="nb">window</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">search</span>
        <span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/^\?/</span><span class="p">,</span> <span class="s2">&#34;&#34;</span><span class="p">)</span>
        <span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;&amp;&#39;</span><span class="p">)</span>
        <span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">keyValue</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">keyValue</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">);</span> <span class="p">})</span>
        <span class="p">.</span><span class="nx">reduce</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">acc</span><span class="p">,</span> <span class="nx">keyValue</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">const</span> <span class="nx">k</span> <span class="o">=</span> <span class="nx">keyValue</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
          <span class="k">const</span> <span class="nx">v</span> <span class="o">=</span> <span class="nx">keyValue</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
          <span class="nx">acc</span><span class="p">[</span><span class="nx">k</span><span class="p">]</span> <span class="o">=</span> <span class="nx">v</span><span class="p">;</span>
          <span class="k">return</span> <span class="nx">acc</span><span class="p">;</span>
        <span class="p">},</span> <span class="p">{});</span>
    <span class="p">}</span>
    
    <span class="kd">function</span> <span class="nx">didBuy</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">navigator</span> <span class="o">===</span> <span class="s2">&#34;undefined&#34;</span> <span class="o">||</span> <span class="k">typeof</span> <span class="nb">window</span> <span class="o">===</span> <span class="s2">&#34;undefined&#34;</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">isCrawler</span><span class="p">(</span><span class="nx">navigator</span><span class="p">.</span><span class="nx">userAgent</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
      <span class="p">}</span>
      
      <span class="k">if</span> <span class="p">(</span><span class="nx">persist</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">PAID_LOCALSTORAGE_KEY</span><span class="p">)</span> <span class="o">===</span> <span class="nx">PAID_LOCALSTORAGE_VALUE</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
      <span class="p">}</span>
      
      <span class="k">const</span> <span class="nx">query</span> <span class="o">=</span> <span class="nx">getQueryObject</span><span class="p">(</span><span class="nb">window</span><span class="p">);</span>
      <span class="k">const</span> <span class="nx">bought</span> <span class="o">=</span> <span class="nx">PAID_QUERY_PARAMS</span><span class="p">.</span><span class="nx">some</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">queryParams</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">entries</span><span class="p">(</span><span class="nx">queryParams</span><span class="p">).</span><span class="nx">every</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">keyValue</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">const</span> <span class="nx">key</span> <span class="o">=</span> <span class="nx">keyValue</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
          <span class="k">const</span> <span class="nx">value</span> <span class="o">=</span> <span class="nx">keyValue</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
          <span class="k">return</span> <span class="nx">query</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">===</span> <span class="nx">value</span><span class="p">;</span>
        <span class="p">});</span>
      <span class="p">});</span>
      
      <span class="k">if</span> <span class="p">(</span><span class="nx">bought</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">persist</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="nx">PAID_LOCALSTORAGE_KEY</span><span class="p">,</span> <span class="nx">PAID_LOCALSTORAGE_VALUE</span><span class="p">);</span>
      <span class="p">}</span>

      <span class="k">return</span> <span class="nx">bought</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="kd">function</span> <span class="nx">init</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">didBuy</span><span class="p">())</span> <span class="p">{</span>
        <span class="c1">// disable scroll/hide all the things
</span><span class="c1"></span>        <span class="nx">$siteWrapper</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">SITE_WRAPPER_NO_SCROLL_CLASS</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nb">window</span><span class="p">.</span><span class="nx">history</span><span class="p">.</span><span class="nx">replaceState</span><span class="p">({},</span> <span class="nb">document</span><span class="p">.</span><span class="nx">title</span><span class="p">,</span> <span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">pathname</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="nx">init</span><span class="p">();</span>
  <span class="p">})(</span><span class="nb">document</span><span class="p">,</span> <span class="nx">navigator</span><span class="p">,</span> <span class="nb">window</span><span class="p">);</span>
<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span></code></pre></div>
<h2 id="the-script-in-full-as-it-is-on-my-site">The script in full as it is on my site</h2>

<p>I use polyfill.io to polyfill <code>.some</code>, <code>.entries</code> and <code>.every</code>.
I also have a “Buy Overlay”, which I toggle on using a CSS class.
The rest is all explained in the article.</p>

<p>See it in action at <a href="https://codewithhugo.com/guides/sequelize-es6-cheatsheet/">Sequelize ES6 Cheatsheet</a>.</p>

<p>If you like getting the cheatsheet for free but also want to support my work you can <a href="buymeacoff.ee/hugodf">Buy me a Coffee</a> or just <a href="https://buttondown.email/hugo">subscribe to my mailing list</a>.</p>
<div class="highlight"><pre class="chroma"><code class="language-html" data-lang="html"><span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;https://cdn.polyfill.io/v2/polyfill.min.js?features=es6&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
  <span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nb">document</span><span class="p">,</span> <span class="nx">navigator</span><span class="p">,</span> <span class="nb">window</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">const</span> <span class="nx">PAID_QUERY_PARAMS</span> <span class="o">=</span> <span class="p">[</span> <span class="p">{</span> <span class="nx">key</span><span class="o">:</span> <span class="s1">&#39;list&#39;</span> <span class="p">},</span> <span class="p">{</span> <span class="nx">key</span><span class="o">:</span> <span class="s1">&#39;has-paid&#39;</span> <span class="p">}</span> <span class="p">];</span>
    <span class="k">const</span> <span class="nx">PAID_LOCALSTORAGE_KEY</span> <span class="o">=</span> <span class="s1">&#39;MY_KEY&#39;</span><span class="p">;</span>
    <span class="k">const</span> <span class="nx">PAID_LOCALSTORAGE_VALUE</span> <span class="o">=</span> <span class="s1">&#39;MY_SUPER_SECRET_VALUE&#39;</span><span class="p">;</span>
    <span class="c1">// Get from https://beta.observablehq.com/@hugodf/crawler-regex
</span><span class="c1"></span>    <span class="k">const</span> <span class="nx">crawlerPattern</span> <span class="o">=</span> <span class="s2">&#34;REPLACE_ME&#34;</span><span class="p">;</span>
    <span class="k">const</span> <span class="nx">crawlerRegEx</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">RegExp</span><span class="p">(</span><span class="nx">crawlerPattern</span><span class="p">,</span> <span class="s1">&#39;i&#39;</span><span class="p">);</span>
    <span class="k">const</span> <span class="nx">SITE_WRAPPER_SELECTOR</span> <span class="o">=</span> <span class="s1">&#39;.js-site-wrapper&#39;</span><span class="p">;</span>
    <span class="k">const</span> <span class="nx">SITE_WRAPPER_NO_SCROLL_CLASS</span> <span class="o">=</span> <span class="s1">&#39;js-site-wrapper--no-scroll&#39;</span><span class="p">;</span>
    <span class="k">const</span> <span class="nx">BUY_OVERLAY_SELECTOR</span> <span class="o">=</span> <span class="s1">&#39;.js-buy-overlay&#39;</span><span class="p">;</span>
    <span class="k">const</span> <span class="nx">BUY_OVERLAY_ACTIVE_CLASS</span> <span class="o">=</span> <span class="s1">&#39;js-buy-overlay--active&#39;</span><span class="p">;</span>
    
    <span class="nx">$siteWrapper</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="nx">SITE_WRAPPER_SELECTOR</span><span class="p">);</span>
    <span class="nx">$buyOverlay</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="nx">BUY_OVERLAY_SELECTOR</span><span class="p">);</span>
        
    <span class="k">const</span> <span class="nx">persist</span> <span class="o">=</span> <span class="p">{</span>
      <span class="nx">set</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nb">window</span><span class="p">.</span><span class="nx">localStorage</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">value</span><span class="p">);</span>
      <span class="p">},</span>
      <span class="nx">get</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">key</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nb">window</span><span class="p">.</span><span class="nx">localStorage</span><span class="p">.</span><span class="nx">getItem</span><span class="p">(</span><span class="nx">key</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">isCrawler</span><span class="p">(</span><span class="nx">userAgent</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">crawlerRegEx</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">userAgent</span><span class="p">);</span>
    <span class="p">}</span>
    
    <span class="kd">function</span> <span class="nx">getQueryObject</span><span class="p">(</span><span class="nb">window</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">search</span>
        <span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/^\?/</span><span class="p">,</span> <span class="s2">&#34;&#34;</span><span class="p">)</span>
        <span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;&amp;&#39;</span><span class="p">)</span>
        <span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">keyValue</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">keyValue</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">);</span> <span class="p">})</span>
        <span class="p">.</span><span class="nx">reduce</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">acc</span><span class="p">,</span> <span class="nx">keyValue</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">const</span> <span class="nx">k</span> <span class="o">=</span> <span class="nx">keyValue</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
          <span class="k">const</span> <span class="nx">v</span> <span class="o">=</span> <span class="nx">keyValue</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
          <span class="nx">acc</span><span class="p">[</span><span class="nx">k</span><span class="p">]</span> <span class="o">=</span> <span class="nx">v</span><span class="p">;</span>
          <span class="k">return</span> <span class="nx">acc</span><span class="p">;</span>
        <span class="p">},</span> <span class="p">{});</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">didBuy</span> <span class="p">()</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">navigator</span> <span class="o">===</span> <span class="s2">&#34;undefined&#34;</span> <span class="o">||</span> <span class="k">typeof</span> <span class="nb">window</span> <span class="o">===</span> <span class="s2">&#34;undefined&#34;</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">isCrawler</span><span class="p">(</span><span class="nx">navigator</span><span class="p">.</span><span class="nx">userAgent</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">persist</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">PAID_LOCALSTORAGE_KEY</span><span class="p">)</span> <span class="o">===</span> <span class="nx">PAID_LOCALSTORAGE_VALUE</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">const</span> <span class="nx">query</span> <span class="o">=</span> <span class="nx">getQueryObject</span><span class="p">(</span><span class="nb">window</span><span class="p">);</span>
      <span class="k">const</span> <span class="nx">bought</span> <span class="o">=</span> <span class="nx">PAID_QUERY_PARAMS</span><span class="p">.</span><span class="nx">some</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">queryParams</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">entries</span><span class="p">(</span><span class="nx">queryParams</span><span class="p">).</span><span class="nx">every</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">keyValue</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">const</span> <span class="nx">key</span> <span class="o">=</span> <span class="nx">keyValue</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
          <span class="k">const</span> <span class="nx">value</span> <span class="o">=</span> <span class="nx">keyValue</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
          <span class="k">return</span> <span class="nx">query</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">===</span> <span class="nx">value</span><span class="p">;</span>
        <span class="p">});</span>
      <span class="p">});</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">bought</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">persist</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="nx">PAID_LOCALSTORAGE_KEY</span><span class="p">,</span> <span class="nx">PAID_LOCALSTORAGE_VALUE</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">bought</span><span class="p">;</span>
    <span class="p">}</span>
    
    <span class="kd">function</span> <span class="nx">init</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">didBuy</span><span class="p">())</span> <span class="p">{</span>
        <span class="nx">$siteWrapper</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">SITE_WRAPPER_NO_SCROLL_CLASS</span><span class="p">);</span>
        <span class="nx">$buyOverlay</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">BUY_OVERLAY_ACTIVE_CLASS</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nb">window</span><span class="p">.</span><span class="nx">history</span><span class="p">.</span><span class="nx">replaceState</span><span class="p">({},</span> <span class="nb">document</span><span class="p">.</span><span class="nx">title</span><span class="p">,</span> <span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">pathname</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="nx">init</span><span class="p">();</span>
  <span class="p">})</span> <span class="p">(</span><span class="nb">document</span><span class="p">,</span> <span class="nx">navigator</span><span class="p">,</span> <span class="nb">window</span><span class="p">);</span>
<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span></code></pre></div>
<p><a style="background-color:black;color:white;text-decoration:none;padding:4px 6px;font-family:-apple-system, BlinkMacSystemFont, &quot;San Francisco&quot;, &quot;Helvetica Neue&quot;, Helvetica, Ubuntu, Roboto, Noto, &quot;Segoe UI&quot;, Arial, sans-serif;font-size:12px;font-weight:bold;line-height:1.2;display:inline-block;border-radius:3px" href="https://unsplash.com/@samuelzeller?utm_medium=referral&amp;utm_campaign=photographer-credit&amp;utm_content=creditBadge" target="_blank" rel="noopener noreferrer" title="Download free do whatever you want high-resolution photos from Samuel Zeller"><span style="display:inline-block;padding:2px 3px"><svg xmlns="http://www.w3.org/2000/svg" style="height:12px;width:auto;position:relative;vertical-align:middle;top:-1px;fill:white" viewBox="0 0 32 32"><title>unsplash-logo</title><path d="M20.8 18.1c0 2.7-2.2 4.8-4.8 4.8s-4.8-2.1-4.8-4.8c0-2.7 2.2-4.8 4.8-4.8 2.7.1 4.8 2.2 4.8 4.8zm11.2-7.4v14.9c0 2.3-1.9 4.3-4.3 4.3h-23.4c-2.4 0-4.3-1.9-4.3-4.3v-15c0-2.3 1.9-4.3 4.3-4.3h3.7l.8-2.3c.4-1.1 1.7-2 2.9-2h8.6c1.2 0 2.5.9 2.9 2l.8 2.4h3.7c2.4 0 4.3 1.9 4.3 4.3zm-8.6 7.5c0-4.1-3.3-7.5-7.5-7.5-4.1 0-7.5 3.4-7.5 7.5s3.3 7.5 7.5 7.5c4.2-.1 7.5-3.4 7.5-7.5z"></path></svg></span><span style="display:inline-block;padding:2px 3px">Samuel Zeller</span></a></p>

        </div>
    </section>

    <section class="subscribe-form">
        <h3 class="subscribe-form-title">Subscribe to Code with Hugo</h3>
        <p>Get all the posts of the week before anyone else in your inbox</p>
        <form
            action="https://buttondown.email/api/emails/embed-subscribe/hugo"
            method="post"
            target="popupwindow"
            onsubmit="window.open('https://buttondown.email/hugo', 'popupwindow')"
        >
            <div class="form-group">
                <input class="subscribe-email" type="email" name="email" id="bd-email" placeholder="youremail@example.com">
                <input type="hidden" value="1" name="embed"/>
            </div>
            <button class="" value="Subscribe" type="submit"><span>Subscribe</span></button>
        </form>
    </section>

    <footer class="post-full-footer">
      <section class="author-card">
        <img class="author-profile-image" src="https://cdn-images-1.medium.com/fit/c/200/200/0*Rb-aDjpTtV1UZA4O.jpeg" alt="Author" />
        <section class="author-card-content">
            <h4 class="author-card-name"><a href="https://codewithhugo.com/">Hugo Di Francesco</a></h4>
                <p>A developer, working out of London writing CSS, JavaScript and Python.</p>
        </section>
      </section>
    </footer>
</article>


  <section class="overlay-cta">
    <div class="overlay-cta__inner">
      <div class="overlay-cta__text-container">
        <h3 class="cta-title overlay-cta__title">
          Subscribe to the Code with Hugo newsletter
        </h3>
        <p class="cta-text overlay-cta__text">
          Get the latest articles in your inbox every 2 weeks
        </p>
      </div>
      <div class="overlay-cta__button-container">
        <a href="https://buttondown.email/hugo" class="button overlay-cta__button">
          Subscribe
        </a>
        <a href="#" class="overlay-cta__close">close</a>
      </div>
    </div>
  </section>



    
    
    

  </div>
</main>


<aside class="read-next outer">
  <div class="inner">
    <div class="read-next-feed">      
      
<article class="read-next-card" 
            style="background-image: url(https://codewithhugo.com/img/cover.jpg);" >
    <header class="read-next-card-header">
        <small class="read-next-card-header-sitetitle">&mdash; Code with Hugo &mdash;</small>
        
        <h3 class="read-next-card-header-title"><a href="https://codewithhugo.com/tags/javascript/">#JavaScript</a></h3>
    </header>
    <div class="read-next-divider"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 14.5s2 3 5 3 5.5-2.463 5.5-5.5S21 6.5 18 6.5c-5 0-7 11-12 11C2.962 17.5.5 15.037.5 12S3 6.5 6 6.5s4.5 3.5 4.5 3.5"/></svg>
    </div>

    <div class="read-next-card-content">
      
        <ul>
          <li><a href="https://codewithhugo.com/install-just-redis-cli-on-ubuntu-debian-jessie/">Install just redis-cli on Ubuntu, Debian, Jessie</a></li>            
        
          <li><a href="https://codewithhugo.com/ava-low-config-testing-for-javascript/">AVA, low-config testing for JavaScript</a></li>            
        
          <li><a href="https://codewithhugo.com/abusing-jest-snapshot-tests-some-nice-use-cases-/">Abusing Jest snapshot tests: some nice use-cases 📸</a></li>            
        
          <li><a href="https://codewithhugo.com/just-enough-bash-to-be-dangerous/">Just enough bash to be dangerous</a></li>            
        </ul>
    </div>
    <footer class="read-next-card-footer">
      
        <a href="https://codewithhugo.com/tags/javascript/">See all related posts →</a>
    </footer>
</article>


      
      <article class="post-card post"> 
    
    <a class="post-card-image-link" href="https://codewithhugo.com/post-frequency-from-prototype-to-production-with-vue---node/">
      <div class="post-card-image" style="background-image: url(https://codewithhugo.com/img/neonbrand-unsplash.jpg)"></div>
    </a>
    

    <div class="post-card-content">
      <a class="post-card-content-link" href="https://codewithhugo.com/post-frequency-from-prototype-to-production-with-vue---node/">
          <header class="post-card-header">
              <span class="post-card-tags">
              #JavaScript 
              #vue 
              #node  </span>
              
              <h2 class="post-card-title">Post Frequency: from prototype to production with Vue &#43; Node</h2>
          </header>
          <section class="post-card-excerpt">
              
                <p> If you want to ship, use the tools you know. — A lot of people
 Let&rsquo;s apply that principle: I&rsquo;m building Post Frequency/Accountable Blogging, I&rsquo;m familiar with Vue and Node-based backends. Netlify makes frontend deployments trivial and I’ve settled on Dokku for databases/backend applications hosting.  ...  </p>
              
          </section>
      </a>

      <footer class="post-card-meta">
          <img class="author-profile-image" src="https://cdn-images-1.medium.com/fit/c/200/200/0*Rb-aDjpTtV1UZA4O.jpeg" alt="Author" />
          <span class="post-card-author"><a href="/">Hugo Di Francesco</a></span>
      </footer>
    </div>
</article>
      
      
      <article class="post-card post"> 
    
    <a class="post-card-image-link" href="https://codewithhugo.com/a-simple-javascript/node-coding-setup-on-mac-os-x/">
      <div class="post-card-image" style="background-image: url(https://codewithhugo.com/img/oskar-yildiz-unsplash.jpg)"></div>
    </a>
    

    <div class="post-card-content">
      <a class="post-card-content-link" href="https://codewithhugo.com/a-simple-javascript/node-coding-setup-on-mac-os-x/">
          <header class="post-card-header">
              <span class="post-card-tags">
              #JavaScript 
              #meta 
              #node 
              #git  </span>
              
              <h2 class="post-card-title">A simple JavaScript/Node coding setup on Mac OS X</h2>
          </header>
          <section class="post-card-excerpt">
              
                <p>Here&rsquo;s how I get productive for JavaScript/Node on Mac OS.

 ...  </p>
              
          </section>
      </a>

      <footer class="post-card-meta">
          <img class="author-profile-image" src="https://cdn-images-1.medium.com/fit/c/200/200/0*Rb-aDjpTtV1UZA4O.jpeg" alt="Author" />
          <span class="post-card-author"><a href="/">Hugo Di Francesco</a></span>
      </footer>
    </div>
</article>
      
    </div>
  </div>
</aside>

<div class="floating-header">
  <div class="floating-header-logo">
    <a href="https://codewithhugo.com/">
      
      <span>Code with Hugo</span>
    </a>
  </div>
  <span class="floating-header-divider">&mdash;</span>
  <div class="floating-header-title">Add a client-side paywall using checkoutpage.co and vanilla JavaScript</div>
  <div class="floating-header-share">
    <div class="floating-header-share-label">Share this <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
     <path d="M7.5 15.5V4a1.5 1.5 0 1 1 3 0v4.5h2a1 1 0 0 1 1 1h2a1 1 0 0 1 1 1H18a1.5 1.5 0 0 1 1.5 1.5v3.099c0 .929-.13 1.854-.385 2.748L17.5 23.5h-9c-1.5-2-5.417-8.673-5.417-8.673a1.2 1.2 0 0 1 1.76-1.605L7.5 15.5zm6-6v2m-3-3.5v3.5m6-1v2"/></svg>
    </div>

    
    <a class="floating-header-share-tw" href="https://twitter.com/share?text=%22Add%20a%20client-side%20paywall%20using%20checkoutpage.co%20and%20vanilla%20JavaScript%22%20by%20%40hugo__df&amp;url=https%3a%2f%2fcodewithhugo.com%2fadd-a-client-side-paywall-using-checkoutpage.co-and-vanilla-javascript%2f&amp"
          onclick="window.open(this.href, 'share-twitter', 'width=550,height=235');return false;">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M30.063 7.313c-.813 1.125-1.75 2.125-2.875 2.938v.75c0 1.563-.188 3.125-.688 4.625a15.088 15.088 0 0 1-2.063 4.438c-.875 1.438-2 2.688-3.25 3.813a15.015 15.015 0 0 1-4.625 2.563c-1.813.688-3.75 1-5.75 1-3.25 0-6.188-.875-8.875-2.625.438.063.875.125 1.375.125 2.688 0 5.063-.875 7.188-2.5-1.25 0-2.375-.375-3.375-1.125s-1.688-1.688-2.063-2.875c.438.063.813.125 1.125.125.5 0 1-.063 1.5-.25-1.313-.25-2.438-.938-3.313-1.938a5.673 5.673 0 0 1-1.313-3.688v-.063c.813.438 1.688.688 2.625.688a5.228 5.228 0 0 1-1.875-2c-.5-.875-.688-1.813-.688-2.75 0-1.063.25-2.063.75-2.938 1.438 1.75 3.188 3.188 5.25 4.25s4.313 1.688 6.688 1.813a5.579 5.579 0 0 1 1.5-5.438c1.125-1.125 2.5-1.688 4.125-1.688s3.063.625 4.188 1.813a11.48 11.48 0 0 0 3.688-1.375c-.438 1.375-1.313 2.438-2.563 3.188 1.125-.125 2.188-.438 3.313-.875z"/></svg>
      </a>
      <a class="floating-header-share-fb" href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fcodewithhugo.com%2fadd-a-client-side-paywall-using-checkoutpage.co-and-vanilla-javascript%2f"
          onclick="window.open(this.href, 'share-facebook','width=580,height=296');return false;">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M19 6h5V0h-5c-3.86 0-7 3.14-7 7v3H8v6h4v16h6V16h5l1-6h-6V7c0-.542.458-1 1-1z"/></svg>
      </a>
  </div>

  <progress class="progress" value="0">
    <div class="progress-container">
      <span class="progress-bar"></span>
    </div>
  </progress>
</div>



<footer class="site-footer outer">
  <div class="site-footer-content inner">
    <section class="copyright" style="line-height: 1.3em;">
      <a href="/">Code with Hugo</a>  <br>
      
    </section>
    <nav class="site-footer-nav">
        <a href="/">Latest Posts</a>
        
        <a href="https://twitter.com/hugo__df" target="_blank" rel="noopener">Twitter</a>
        <a href="https://github.com/HugoDF" target="_blank" rel="noopener">Github</a>
        
        <a href="https://medium.com/@hugo__df" target="_blank" rel="noopener">Medium</a>
    </nav>  
  </div>
</footer>

</div>

<script type="text/javascript" src="//code.jquery.com/jquery-3.2.1.min.js"></script>
<script type="text/javascript" src="https://codewithhugo.com/js/jquery.fitvids.js"></script>




  <!-- Google Analytics -->
  <script>
    var _gaq=[['_setAccount','UA-60469708-1'],['_trackPageview']];
    (function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];
    g.src=('https:'==location.protocol?'//ssl':'//www')+'.google-analytics.com/ga.js';
    s.parentNode.insertBefore(g,s)}(document,'script'));
  </script>



<script async src="//cdn.simpleanalytics.io/hello.js"></script>
<noscript><img src="//api.simpleanalytics.io/hello.gif" alt=""></noscript>





<script>
  (function (document) {
    function getLastDocumentHeight(document) {
      var body = document.body;
      var html = document.documentElement;
      return Math.max(
        body.scrollHeight, body.offsetHeight,
        html.clientHeight, html.scrollHeight,
        html.offsetHeight
      );
    }

    var $overlay = document.querySelector('.overlay-cta');
    var hiddenClass = 'overlay-cta--hidden';
    var closedClass = 'overlay-cta--closed';
    $overlay.classList.add(hiddenClass);

    
    var $overlayClose = document.querySelector('.overlay-cta__close');
    var overlayCloseListener = $overlayClose.addEventListener('click', function (e) {
      e.preventDefault();
      $overlay.classList.add(closedClass);
    });

    var $heroCtaButton = document.querySelector('.hero-cta .button');
    var $firstContentItem = document.querySelector('.post-full-content > * > *');
    var title = $heroCtaButton || $firstContentItem;

    var $subscribeBox = document.querySelector('.subscribe-form');

    var lastScrollY = window.scrollY;
    var lastWindowHeight = window.innerHeight;
    var lastDocumentHeight = getLastDocumentHeight(document);
    var ticking = false;


    function onScroll() {
      lastScrollY = window.scrollY;
      requestTick();
    }

    function onResize() {
      lastWindowHeight = window.innerHeight;
      lastDocumentHeight = getLastDocumentHeight(document);
      requestTick();
    }

    function requestTick() {
      if (!ticking) {
        requestAnimationFrame(update);
      }
      ticking = true;
    }

    function update() {
      var trigger = title.getBoundingClientRect().top + window.scrollY;
      var triggerOffset = title.offsetHeight + 35;
      var lastShowCtaBoxHeight = $subscribeBox.getBoundingClientRect().top ;
      
      if (
        lastScrollY >= trigger + triggerOffset &&
        lastShowCtaBoxHeight > lastWindowHeight
      ) {
        $overlay.classList.remove(hiddenClass);
      } else {
        $overlay.classList.add(hiddenClass);
      }

      ticking = false;
    }

    window.addEventListener('scroll', onScroll, { passive: true });
    window.addEventListener('resize', onResize, false);

    update();
  })(document);
</script>


    <script>





$(document).ready(function () {
    
    var $postContent = $(".post-full-content");
    $postContent.fitVids();
    

    var progressBar = document.querySelector('progress');
    var header = document.querySelector('.floating-header');
    var title = document.querySelector('.post-full-title');

    var lastScrollY = window.scrollY;
    var lastWindowHeight = window.innerHeight;
    var lastDocumentHeight = $(document).height();
    var ticking = false;

    function onScroll() {
        lastScrollY = window.scrollY;
        requestTick();
    }

    function onResize() {
        lastWindowHeight = window.innerHeight;
        lastDocumentHeight = $(document).height();
        requestTick();
    }

    function requestTick() {
        if (!ticking) {
            requestAnimationFrame(update);
        }
        ticking = true;
    }

    function update() {
        var trigger = title.getBoundingClientRect().top + window.scrollY;
        var triggerOffset = title.offsetHeight + 35;
        var progressMax = lastDocumentHeight - lastWindowHeight;

        
        if (lastScrollY >= trigger + triggerOffset) {
            header.classList.add('floating-active');
        } else {
            header.classList.remove('floating-active');
        }

        progressBar.setAttribute('max', progressMax);
        progressBar.setAttribute('value', lastScrollY);

        ticking = false;
    }

    window.addEventListener('scroll', onScroll, {passive: true});
    window.addEventListener('resize', onResize, false);

    update();
});
</script>
</body></html>
