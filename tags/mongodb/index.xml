<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Mongodb on Code with Hugo</title>
    <link>https://codewithhugo.com/tags/mongodb/</link>
    <description>Recent content in Mongodb on Code with Hugo</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>en-US</language>
    <lastBuildDate>Mon, 31 Dec 2018 00:00:00 +0000</lastBuildDate>
    
        <atom:link href="https://codewithhugo.com/tags/mongodb/index.xml" rel="self" type="application/rss+xml" />
    
    
    <item>
      <title>Connect to MongoDB on Dokku with your local command line or Robo3T</title>
      <link>https://codewithhugo.com/connect-to-mongodb-on-dokku-with-your-local-command-line-or-robo3t/</link>
      <pubDate>Mon, 31 Dec 2018 00:00:00 +0000</pubDate>
      
      <guid>https://codewithhugo.com/connect-to-mongodb-on-dokku-with-your-local-command-line-or-robo3t/</guid>
      <description>&lt;p&gt;The Dokku mongo plugin provides a &lt;code&gt;mongo:connect&lt;/code&gt; command, which opens a tunnelled connection to you MongoDB instance on Dokku. This is how you can connect to your database using the tool of your choice, the examples will be using Robo3T.&lt;/p&gt;

&lt;p&gt;Table of Contents:
&lt;/p&gt;

&lt;h2 id=&#34;pre-requisites&#34;&gt;Pre-requisites&lt;/h2&gt;

&lt;h3 id=&#34;dokku-mongo-is-installed&#34;&gt;dokku-mongo is installed&lt;/h3&gt;

&lt;p&gt;See &lt;a href=&#34;https://github.com/dokku/dokku-mongo&#34;&gt;github.com/dokku/dokku-mongo&lt;/a&gt;, to install it:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;ssh into the server running Dokku as root&lt;/li&gt;
&lt;li&gt;run: &lt;code&gt;sudo dokku plugin:install https://github.com/dokku/dokku-mongo.git mongo&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&#34;you-have-a-database-to-play-with&#34;&gt;You have a database to play with&lt;/h3&gt;

&lt;p&gt;Create one with: &lt;code&gt;ssh -t dokku@YOUR_INSTANCE_IP mongo:create public-database&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;You should get the following output, the bolded string is the mongo connection URI:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;    Waiting for container to be ready
=====&amp;gt; MongoDB container created: public-database
=====&amp;gt; Container Information
    Config dir:          /var/lib/dokku/services/mongo/public-database/config
    Data dir:            /var/lib/dokku/services/mongo/public-database/data
    Dsn:                 mongodb://public-database:289b4a4b32ab3182895d8aac7def0ee1@dokku-mongo-public-database:27017/public-database
    Exposed ports:       -
    Id:                  67163f2006dd9e17f8325620814bae9b881ee6465088b8b1c571fbb6c08ac801
    Internal ip:         172.17.0.11
    Links:               -
    Service root:        /var/lib/dokku/services/mongo/public-database
    Status:              running
    Version:             mongo:3.4.9
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;connect-to-your-remote-mongodb-instance-on-dokku&#34;&gt;Connect to your remote MongoDB instance on Dokku&lt;/h2&gt;

&lt;p&gt;First off, let’s check that we can connect using the included dokku-mongo &lt;code&gt;:connect&lt;/code&gt; command.
Run the following command:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;ssh -t dokku@YOUR_INSTANCE_IP mongo:connect public-database
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;It should open a MongoDB shell:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;MongoDB shell version v3.4.9
connecting to: mongodb://127.0.0.1:27017/public-database
MongoDB server version: 3.4.9
&amp;gt; 
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;dokku-s-behaviour-around-access-of-mongodb&#34;&gt;Dokku’s behaviour around access of MongoDB&lt;/h3&gt;

&lt;p&gt;If we look back at the &lt;code&gt;mongo:info&lt;/code&gt; output we’ll notice the following line:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;Exposed ports:       -
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;That means this MongoDB instance is not exposed to anything outside of Dokku, that’s good for security, bad for accessing it from your local tools.&lt;/p&gt;

&lt;h3 id=&#34;exposing-our-mongodb-instance&#34;&gt;Exposing our MongoDB instance&lt;/h3&gt;

&lt;p&gt;We’ll need to expose it, and pass some ports we want to map to (this helps with predictability/reproducibility)&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sh&#34; data-lang=&#34;sh&#34;&gt;ssh -t dokku@YOUR_INSTANCE_IP mongo:expose public-database &lt;span class=&#34;m&#34;&gt;20017&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;20018&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;20019&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;20020&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Which yields the following output:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;-----&amp;gt; Service public-database exposed on port(s) [container-&amp;gt;host]: 27017-&amp;gt;20017 27018-&amp;gt;20018 27019-&amp;gt;20019 28017-&amp;gt;20020
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Which means the MongoDB ports 27017, 27018, 27019 and 28017 were exposed at the server’s 20017, 20018, 20019, 20020 ports respectively.&lt;/p&gt;

&lt;h3 id=&#34;connecting-with-robo3t&#34;&gt;Connecting with Robo3T&lt;/h3&gt;

&lt;p&gt;In order to connect with Robo3T we’ll create a new connection to the MongoDB instance.&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Open the “Connect” menu (File &amp;gt; Connect)&lt;/li&gt;
&lt;li&gt;In the first line, click “Create”&lt;/li&gt;
&lt;li&gt;Fill out the “Connection” tab, of course, replace YOUR_SERVER_IP with your actual server IP or domain name.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;img src=&#34;https://d2mxuefqeaa7sj.cloudfront.net/s_5F4BC56CEE8442961498E30A88107FB43112E81DEC4BBA7ABD2A9A1388573B9B_1546270597650_image.png&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Fill out the “Authentication” tab, if you remember our connection string from &lt;code&gt;dokku mongo:info public-database&lt;/code&gt;, &lt;code&gt;**mongodb://public-database:289b4a4b32ab3182895d8aac7def0ee1@dokku-mongo-public-database:27017/public-database**&lt;/code&gt;

&lt;ul&gt;
&lt;li&gt;The format is &lt;code&gt;mongodb://USERNAME:PASSWORD@INTERNAL_HOSTNAME:INTERNAL_PORT/DATABASE_NAME&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;So we have&lt;/li&gt;
&lt;li&gt;Database: &lt;code&gt;public-database&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;User Name: &lt;code&gt;public-database&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Password: &lt;code&gt;289b4a4b32ab3182895d8aac7def0ee1&lt;/code&gt; (use your actual password)&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;img src=&#34;https://d2mxuefqeaa7sj.cloudfront.net/s_5F4BC56CEE8442961498E30A88107FB43112E81DEC4BBA7ABD2A9A1388573B9B_1546270788604_image.png&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;You can now hit “Test” and it should tell you everything is fine&lt;/li&gt;
&lt;li&gt;You can “Save” and “Connect” to this new database&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&#34;testing-out-the-connection&#34;&gt;Testing out the connection&lt;/h2&gt;

&lt;p&gt;Create a new collection “newest-public-spaces”&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://d2mxuefqeaa7sj.cloudfront.net/s_5F4BC56CEE8442961498E30A88107FB43112E81DEC4BBA7ABD2A9A1388573B9B_1546271101758_image.png&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://d2mxuefqeaa7sj.cloudfront.net/s_5F4BC56CEE8442961498E30A88107FB43112E81DEC4BBA7ABD2A9A1388573B9B_1546271148845_image.png&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;

&lt;p&gt;Insert some data&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://d2mxuefqeaa7sj.cloudfront.net/s_5F4BC56CEE8442961498E30A88107FB43112E81DEC4BBA7ABD2A9A1388573B9B_1546271216423_image.png&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://d2mxuefqeaa7sj.cloudfront.net/s_5F4BC56CEE8442961498E30A88107FB43112E81DEC4BBA7ABD2A9A1388573B9B_1546271218792_image.png&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;

&lt;p&gt;Let’s disconnect and go back to the dokku-mongo plugin connection and get data for the &lt;code&gt;newest-public-spaces&lt;/code&gt; collection to see if we were talking to the same database.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sh&#34; data-lang=&#34;sh&#34;&gt;ssh -t dokku@YOUR_SERVER_IP mongo:connect public-database
MongoDB shell version v3.4.9
connecting to: mongodb://127.0.0.1:27017/public-database
MongoDB server version: &lt;span class=&#34;m&#34;&gt;3&lt;/span&gt;.4.9
&amp;gt; db.getCollection&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;newest-public-spaces&amp;#39;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;.find&lt;span class=&#34;o&#34;&gt;({})&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;{&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;_id&amp;#34;&lt;/span&gt; : ObjectId&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;5c2a39e6e632f9bc24ec1a2d&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;, &lt;span class=&#34;s2&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt; : &lt;span class=&#34;s2&#34;&gt;&amp;#34;my park&amp;#34;&lt;/span&gt;, &lt;span class=&#34;s2&#34;&gt;&amp;#34;location&amp;#34;&lt;/span&gt; : &lt;span class=&#34;s2&#34;&gt;&amp;#34;next door&amp;#34;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2 id=&#34;security-concerns&#34;&gt;Security concerns&lt;/h2&gt;

&lt;p&gt;These connections are not done with TLS (transport layer security), which is fine for non-sensitive data.&lt;/p&gt;

&lt;p&gt;I would also suggest using &lt;code&gt;dokku mongo:unexpose YOUR_DATABASE_NAME&lt;/code&gt; when not actively using the connection.&lt;/p&gt;

&lt;p&gt;For more about Dokku and deployment see: &lt;a href=&#34;https://codewithhugo.com/deployment-options-netlify---dokku-on-digitalocean-vs-now.sh-github-pages-heroku-and-aws/&#34;&gt;Deployment options: Netlify + Dokku on DigitalOcean vs now.sh, GitHub Pages, Heroku and AWS&lt;/a&gt; or the &lt;a href=&#34;https://codewithhugo.com/tags/deployment&#34;&gt;“Deployment”&lt;/a&gt; category on Code with Hugo&lt;/p&gt;

&lt;p&gt;If you’re looking for a good place to host your Dokku instance, I recommend &lt;a href=&#34;https://m.do.co/c/4ee8b2d1adb4&#34;&gt;DigitalOcean&lt;/a&gt;, they have a great &lt;a href=&#34;https://www.digitalocean.com/products/one-click-apps/dokku/&#34;&gt;One-click install and deploy Dokku&lt;/a&gt;, if you use &lt;a href=&#34;https://m.do.co/c/4ee8b2d1adb4&#34;&gt;this referral link you’ll get $100 free credit&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;&lt;a style=&#34;background-color:black;color:white;text-decoration:none;padding:4px 6px;font-family:-apple-system, BlinkMacSystemFont, &amp;quot;San Francisco&amp;quot;, &amp;quot;Helvetica Neue&amp;quot;, Helvetica, Ubuntu, Roboto, Noto, &amp;quot;Segoe UI&amp;quot;, Arial, sans-serif;font-size:12px;font-weight:bold;line-height:1.2;display:inline-block;border-radius:3px&#34; href=&#34;https://unsplash.com/@ckirby?utm_medium=referral&amp;amp;utm_campaign=photographer-credit&amp;amp;utm_content=creditBadge&#34; target=&#34;_blank&#34; rel=&#34;noopener noreferrer&#34; title=&#34;Download free do whatever you want high-resolution photos from Cameron Kirby&#34;&gt;&lt;span style=&#34;display:inline-block;padding:2px 3px&#34;&gt;&lt;svg xmlns=&#34;http://www.w3.org/2000/svg&#34; style=&#34;height:12px;width:auto;position:relative;vertical-align:middle;top:-2px;fill:white&#34; viewBox=&#34;0 0 32 32&#34;&gt;&lt;title&gt;unsplash-logo&lt;/title&gt;&lt;path d=&#34;M10 9V0h12v9H10zm12 5h10v18H0V14h10v9h12v-9z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/span&gt;&lt;span style=&#34;display:inline-block;padding:2px 3px&#34;&gt;Cameron Kirby&lt;/span&gt;&lt;/a&gt;&lt;/p&gt;</description>
    </item>
    
  </channel>
</rss>
