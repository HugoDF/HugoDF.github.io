<!DOCTYPE html>
<html lang="en-US" />
<head>
    <meta http-equiv="Content-Type" content="text/html" charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="google-site-verification" content="gBfbdXRLofaOyHsbgiSiuCIHKPaviGMRVWh_qOfDHNE" />

    <title>Simple, but not too simple: how using Zeit’s `micro` improves your Node applications &middot; Code with Hugo</title>

    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="apple-touch-icon" sizes="120x120" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#00aba9">
    <meta name="theme-color" content="#090a0b">

    <link rel="shortcut icon" href="https://codewithhugo.com/favicon.ico" />
    <meta name="theme-color" content="#090a0b">
    
    <link rel="canonical" href="https://codewithhugo.com/simple-but-not-too-simple-how-using-zeits-micro-improves-your-node-applications/" /> 

     <meta name="description" content="Leave the Express comfort zone to expand how you think about Node application architecture.
 tl;dr
 using a function composition model for building HTTP servers" /> 

     
    
    <meta name="twitter:card" content="summary_large_image"/>
    <meta name="twitter:image" content="https://codewithhugo.com/img/kelly-sikkema-unsplash.jpg"/>
    
 
    <meta name="twitter:title" content="Simple, but not too simple: how using Zeit’s `micro` improves your Node applications"/>
    <meta name="twitter:description" content="Leave the Express comfort zone to expand how you think about Node application architecture.
 tl;dr
 using a function composition model for building HTTP servers"/>
    <meta name="twitter:url" content="https://codewithhugo.com/simple-but-not-too-simple-how-using-zeits-micro-improves-your-node-applications/" />
    <meta name="twitter:site" content="@hugo__df"/>

    <meta property="og:site_name" content="Code with Hugo" />
    <meta property="og:title" content="Simple, but not too simple: how using Zeit’s `micro` improves your Node applications &middot; Code with Hugo" />
    <meta property="og:url" content="https://codewithhugo.com/simple-but-not-too-simple-how-using-zeits-micro-improves-your-node-applications/" />
    

    <meta property="og:type" content="article" />
    <meta property="og:description" content="Leave the Express comfort zone to expand how you think about Node application architecture.
 tl;dr
 using a function composition model for building HTTP servers" />

    <meta property="article:published_time" content="2018-10-22T00:00:00Z" />
    <meta property="article:tag" content="JavaScript" /><meta property="article:tag" content="Node" /><meta property="article:tag" content="ES6" /><meta property="article:tag" content="architecture" />

    <meta property="og:image" content="https://codewithhugo.com/img/kelly-sikkema-unsplash.jpg"/>


    <meta name="generator" content="Hugo 0.46" />

    <!-- Stylesheets -->
    <link rel="stylesheet" type="text/css" href="https://codewithhugo.com/built/screen.css" />
    <link rel="stylesheet" type="text/css" href="https://codewithhugo.com/css/casper-two.css" />
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css" />
    
      
      <link rel="stylesheet" href="https://codewithhugo.com/overrides.min.bd35cf74c58c56c4aa8eff40730357744dec20ff31d8bae7b0618dbe30e0dbe4.css">
    
      
      <link rel="stylesheet" href="https://codewithhugo.com/syntax.min.e1646a3f88f77e1b5e7d0253633b1958013aa132890dfe4d7e15dc4718d4aecc.css">
    
      
      <link rel="stylesheet" href="https://codewithhugo.com/cta.min.612120dbcad38a206f6cc18996cd1f7d45141911bf04c86ab0c6132a55274b7b.css">
    

    

     
</head>


<body class="post-template">
  <div class="site-wrapper"> 

<header class="site-header outer">
  <div class="inner">
    <nav class="site-nav">
      <div class="site-nav-left">

        <ul class="nav" role="menu">
        
        
        
            <li class="" role="menuitem">
              <a href="/">Home</a>
            </li>
        
            <li class="" role="menuitem">
              <a href="/tags/">Categories</a>
            </li>
        
            <li class="" role="menuitem">
              <a href="/guides/">guides</a>
            </li>
        
            <li class="" role="menuitem">
              <a href="/tags/javascript/">JavaScript</a>
            </li>
        
            <li class="" role="menuitem">
              <a href="/tags/node/">Node</a>
            </li>
        
            <li class="" role="menuitem">
              <a href="/tags/sequelize/">Sequelize</a>
            </li>
        
            <li class="" role="menuitem">
              <a href="/tags/deployment/">Deployment</a>
            </li>
        
            <li class="" role="menuitem">
              <a href="/open/">#open</a>
            </li>
        
      </ul></div>

      <div class="site-nav-right">
        <div class="social-links">
                    

                    <a class="social-link social-link-tw" href="https://twitter.com/hugo__df" target="_blank" rel="noopener"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M30.063 7.313c-.813 1.125-1.75 2.125-2.875 2.938v.75c0 1.563-.188 3.125-.688 4.625a15.088 15.088 0 0 1-2.063 4.438c-.875 1.438-2 2.688-3.25 3.813a15.015 15.015 0 0 1-4.625 2.563c-1.813.688-3.75 1-5.75 1-3.25 0-6.188-.875-8.875-2.625.438.063.875.125 1.375.125 2.688 0 5.063-.875 7.188-2.5-1.25 0-2.375-.375-3.375-1.125s-1.688-1.688-2.063-2.875c.438.063.813.125 1.125.125.5 0 1-.063 1.5-.25-1.313-.25-2.438-.938-3.313-1.938a5.673 5.673 0 0 1-1.313-3.688v-.063c.813.438 1.688.688 2.625.688a5.228 5.228 0 0 1-1.875-2c-.5-.875-.688-1.813-.688-2.75 0-1.063.25-2.063.75-2.938 1.438 1.75 3.188 3.188 5.25 4.25s4.313 1.688 6.688 1.813a5.579 5.579 0 0 1 1.5-5.438c1.125-1.125 2.5-1.688 4.125-1.688s3.063.625 4.188 1.813a11.48 11.48 0 0 0 3.688-1.375c-.438 1.375-1.313 2.438-2.563 3.188 1.125-.125 2.188-.438 3.313-.875z"/></svg></a>

                    <a class="social-link" href="https://github.com/HugoDF" target="_blank" rel="noopener"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a>

                    

                    <a class="social-link" href="https://medium.com/@hugo__df" target="_blank" rel="noopener"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 195 195"><path d="M46.5340803,65.2157554 C46.6968378,63.6076572 46.0836,62.018231 44.8828198,60.93592 L32.6512605,46.2010582 L32.6512605,44 L70.6302521,44 L99.9859944,108.380952 L125.794585,44 L162,44 L162,46.2010582 L151.542017,56.2281011 C150.640424,56.9153477 150.193188,58.0448862 150.380019,59.1628454 L150.380019,132.837155 C150.193188,133.955114 150.640424,135.084652 151.542017,135.771899 L161.755369,145.798942 L161.755369,148 L110.38282,148 L110.38282,145.798942 L120.963119,135.527337 C122.002801,134.487948 122.002801,134.182246 122.002801,132.592593 L122.002801,73.0417402 L92.585901,147.755438 L88.6106443,147.755438 L54.3622782,73.0417402 L54.3622782,123.115814 C54.0767278,125.221069 54.7759199,127.3406 56.2581699,128.863022 L70.0186741,145.55438 L70.0186741,147.755438 L31,147.755438 L31,145.55438 L44.7605042,128.863022 C46.2319621,127.338076 46.8903838,125.204485 46.5340803,123.115814 L46.5340803,65.2157554 Z"/></svg></a>
        </div>  
        
        <a class="subscribe-button" href="https://codewithhugo.com/index.xml">Subscribe</a>
            
      </div>

    </nav>  

  </div>
</header>

<main id="site-main" class="site-main outer" role="main">
  <div class="inner">
    
      
<div id="codefund_ad"></div>


<article class="post-full post">
    <header class="post-full-header">
        <section class="post-full-meta">
            <time class="post-full-meta-date" datetime="2018-10-22">22 October 2018</time>
                <span class="date-divider">/</span> <a href="https://codewithhugo.com/tags/javascript/">#JavaScript</a>&nbsp;<a href="https://codewithhugo.com/tags/node/">#Node</a>&nbsp;
        </section>
        <h1 class="post-full-title">Simple, but not too simple: how using Zeit’s `micro` improves your Node applications</h1>
    </header>
    <div class="hero-container">

      
      <figure class="post-full-image" style="background-image: url(https://codewithhugo.com/img/kelly-sikkema-unsplash.jpg)">
        

      </figure>
    </div>

    <section class="post-full-content">
        <div class="kg-card-markdown">
        

<blockquote>
<p>Leave the Express comfort zone to expand how you think about Node application architecture.</p>
</blockquote>

<p><strong>tl;dr</strong></p>

<ul>
<li>using a function composition model for building HTTP servers is awesome</li>
<li>Functions as a Service are great but have some drawbacks</li>
<li><code>micro</code> has a similar, simple API to FaaS but doesn&rsquo;t have a compilation step</li>

<li><p><code>micro</code>&rsquo;s minimalism affects how you solve problems</p></li>

<li><p><a href="#functions-as-a-composition-model-for-javascript">Functions as a composition model for JavaScript</a></p></li>

<li><p><a href="#functions-as-a-service-pain-points">Functions as a Service pain points</a></p></li>

<li><p><a href="#beyond-express-micro-as-a-library-to-write-simple-node-applications">Beyond Express: <code>micro</code> as a library to write simple Node applications</a></p></li>

<li><p><a href="#how-micro-helps-your-architecture">How <code>micro</code> helps your architecture</a></p></li>

<li><p><a href="#the-micro-docs-ecosystem-and-examples">The <code>micro</code> docs, ecosystem and examples</a></p></li>

<li><p><a href="#further-information">Further information</a></p></li>
</ul>

<p>An example comparing <code>micro</code> and <code>express</code> can be found at: <a href="https://github.com/HugoDF/micro-vs-express-example">github.com/HugoDF/micro-vs-express-example</a>.</p>

<h2 id="functions-as-a-composition-model-for-javascript">Functions as a composition model for JavaScript</h2>

<p>Here are some of my application development beliefs that are relevant to this post:</p>

<ul>
<li>Functions are awesome</li>
<li>An optimal solution is simple, but not too simple</li>
<li>JavaScript’s most powerful feature is first-class functions</li>
</ul>

<p>From the above follows that in JavaScript, composing functions tends to be the a good way to build a solution that’s simple to reason about but built of standard blocks.</p>

<p>That’s one of the reasons why “Functions as a Service” (FaaS), also called “serverless” platforms are attractive for Node developers. As part of building Post Frequenc, the initial approach was to write the backend on Netlify&rsquo;s lambda platform. At the prototype stage, it worked, there were 2 transactional lambda functions:</p>

<ul>
<li>one to get a feed URL from a site URL</li>
<li>one to parse an RSS/Atom feed from a URL.</li>
</ul>

<p>Netlify Lambdas (which actually end up deployed as AWS lambdas) have a straightforward API, event in, data out (using a callback or an async function).</p>

<p>I realised that the best way to handle the <code>input is a feed URL</code>  and <code>input is a site URL</code> dichotomy was to just try fetch as both and see what errors and what doesn’t. ie. I built something like this:</p>
<div class="highlight"><pre class="chroma"><code class="language-js" data-lang="js"><span class="k">const</span> <span class="nx">coerceErrorToObjectProperty</span> <span class="o">=</span> <span class="nx">promise</span> <span class="p">=&gt;</span>
  <span class="nx">promise</span><span class="p">.</span><span class="k">catch</span><span class="p">(</span><span class="nx">error</span> <span class="p">=&gt;</span> <span class="nb">Promise</span><span class="p">.</span><span class="nx">resolve</span><span class="p">({</span> <span class="nx">error</span> <span class="p">}));</span>
  
<span class="kd">function</span> <span class="nx">handler</span> <span class="p">()</span> <span class="p">{</span>
  <span class="c1">// deal with input
</span><span class="c1"></span>  <span class="k">const</span> <span class="nx">url</span> <span class="o">=</span> <span class="s2">&#34;some-url&#34;</span><span class="p">;</span>
  <span class="nb">Promise</span><span class="p">.</span><span class="nx">all</span><span class="p">([</span>
    <span class="nx">coerceErrorToObjectProperty</span><span class="p">(</span><span class="nx">parseFeed</span><span class="p">(</span><span class="nx">url</span><span class="p">)),</span>
    <span class="nx">coerceErrorToObjectProperty</span><span class="p">(</span><span class="nx">getFeedUrl</span><span class="p">(</span><span class="nx">url</span><span class="p">))</span>
  <span class="p">])</span>
    <span class="p">.</span><span class="nx">then</span><span class="p">(([</span><span class="nx">feedOutput</span><span class="p">,</span> <span class="nx">feedUrlOutput</span><span class="p">])</span> <span class="p">=&gt;</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">feedOutput</span><span class="p">.</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">);</span>
        <span class="k">return</span> <span class="nx">feedOutput</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">feedUrlOutput</span><span class="p">.</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">);</span>
        <span class="k">return</span> <span class="nx">feedUrlOutput</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="nx">feedOutput</span><span class="p">.</span><span class="nx">error</span> <span class="o">||</span> <span class="nx">feedUrlOutput</span><span class="p">.</span><span class="nx">error</span><span class="p">);</span>
    <span class="p">})</span>
    <span class="p">.</span><span class="nx">then</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
      <span class="c1">// deal with response
</span><span class="c1"></span>    <span class="p">})</span>
    <span class="p">.</span><span class="k">catch</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
      <span class="c1">// deal with error
</span><span class="c1"></span>    <span class="p">});</span>
<span class="p">}</span>
</code></pre></div>
<h2 id="functions-as-a-service-pain-points">Functions as a Service pain points</h2>

<p>At this point I hit one of my first developer experience issues running on FaaS:</p>

<ol>
<li>my backend now needs to be bundled</li>
<li>debugging minified code is still not nice</li>
</ol>

<p>This is beyond the cold-start and timeout issues that are usually used to argue against the FaaS route.</p>

<p>With widespread support for Node 8+, there’s less and less reason to transpile your backend code (even if you want to use ES Module syntax, <a href="https://codewithhugo.com/use-es-modules-in-node-without-babel/webpack-using-esm/">see ES Modules, see Use ES Modules in Node without Babel/Webpack</a>).</p>

<h2 id="beyond-express-micro-as-a-library-to-write-simple-node-applications">Beyond Express: <code>micro</code> as a library to write simple Node applications</h2>

<blockquote>
<p>Hopefully this section doesn’t come off as too much of an “Express vs <code>micro</code>&rdquo; debate.</p>

<p>I love Express for its stability, maturity and flexibility, it’s has been and still is a true work horse for the Node.js server ecosystem.</p>

<p><code>micro</code> is more focused and built with fewer constraints (eg. it can leverage async/await support in Node)</p>
</blockquote>

<p>After writing lambdas I was looking for a backend framework that had an API as self-contained as a lambda. That library is <code>micro</code>. Which lead to the following reflections:</p>

<ul>
<li>I have experience with Express but I feel like it has a bit too much friction for tiny apps, which this would be. As most people who have used Express know, you have to install extra packages for middleware behaviour like body-parsing, this comes out of the box with <code>micro</code>.</li>
<li>To send a response in Express, you still use callback syntax: <code>res.json(data)</code> or <code>res.send(data)</code>.</li>
<li>A middleware-based extension system is cool but it’s not always as explicit as you would want it to be. The request/response handler sometimes relies on a property being set by an arbitrary middleware up the middleware stack.</li>
</ul>

<p>The above points are literally some of <code>micro</code>&rsquo;s selling points (see <a href="https://github.com/zeit/micro#features):">https://github.com/zeit/micro#features):</a></p>

<ul>
<li><strong>Easy</strong>: Designed for usage with <code>async</code> and <code>await</code> (<a href="https://zeit.co/blog/async-and-await">more</a>)</li>
<li><strong>Simple</strong>: Oriented for single purpose modules (function)</li>
<li><strong>Standard</strong>: Just HTTP!</li>
<li><strong>Explicit</strong>: No middleware - modules declare all <a href="https://github.com/amio/awesome-micro">dependencies</a></li>
</ul>

<p>It also has the following extra’s that are marginal gains for me compared to Express (again from <a href="https://github.com/zeit/micro#features):">https://github.com/zeit/micro#features):</a></p>

<ul>
<li><strong>Fast</strong>: Ultra-high performance (even JSON parsing is opt-in)</li>
<li><strong>Micro</strong>: The whole project is ~260 lines of code</li>
<li><strong>Agile</strong>: Super easy deployment and containerization</li>
<li><strong>Lightweight</strong>: With all dependencies, the package weighs less than a megabyte</li>
</ul>

<p>With the following counterpoints in my opinion:</p>

<ul>
<li>Express is “fast enough”</li>
<li>Express is “small enough” (even though sometimes running Express in Nodemon inside of Docker leads to 1s+ reload times)</li>
<li>Express is “easy enough to containerise/deploy”</li>
<li>Express is “lightweight enough” (an Express app + dependencies is seldom more than 10s of megabytes, compared to Rails or Django apps which easily hit 50-100+ megabytes)</li>
</ul>

<p>It comes with body-parsing baked in but not much else. Which is a good thing, it keeps to its name.</p>

<p>Here are equivalent apps that respond to a POST that sends a number and increments it by 1 (simple and semi-useless but hey):</p>

<ul>
<li>Express in an <code>express-app.js</code> file:</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-js" data-lang="js">    <span class="k">const</span> <span class="nx">express</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;express&#39;</span><span class="p">);</span>
    <span class="k">const</span> <span class="nx">bodyParser</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;body-parser&#39;</span><span class="p">);</span>
    <span class="k">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">express</span><span class="p">();</span>
    <span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">bodyParser</span><span class="p">.</span><span class="nx">json</span><span class="p">());</span>
    <span class="nx">app</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
      <span class="k">const</span> <span class="p">{</span> <span class="nx">value</span> <span class="o">=</span> <span class="mi">0</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">;</span>
      <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">({</span>
        <span class="nx">value</span><span class="o">:</span> <span class="nb">Number</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
      <span class="p">});</span>
    <span class="p">});</span>
    <span class="nx">app</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">PORT</span> <span class="o">||</span> <span class="mi">3000</span><span class="p">,</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Server listening on PORT&#39;</span><span class="p">,</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">PORT</span> <span class="o">||</span> <span class="mi">3000</span><span class="p">);</span>
    <span class="p">});</span>
</code></pre></div>
<ul>
<li><code>micro</code> in a <code>micro-app.js</code> file:</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-js" data-lang="js">  <span class="k">const</span> <span class="p">{</span> <span class="nx">json</span><span class="p">,</span> <span class="nx">createError</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;micro&#39;</span><span class="p">);</span>
  <span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="kr">async</span> <span class="p">(</span><span class="nx">req</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">method</span> <span class="o">!==</span> <span class="s1">&#39;POST&#39;</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">throw</span> <span class="nx">createError</span><span class="p">(</span><span class="mi">404</span><span class="p">,</span> <span class="s1">&#39;Not Found&#39;</span><span class="p">);</span>
      <span class="c1">// to have the same behaviour as the Express app
</span><span class="c1"></span>    <span class="p">}</span>
    <span class="k">const</span> <span class="p">{</span> <span class="nx">value</span> <span class="o">=</span> <span class="mi">0</span> <span class="p">}</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">json</span><span class="p">(</span><span class="nx">req</span><span class="p">);</span>
    <span class="k">return</span> <span class="p">{</span>
      <span class="nx">value</span><span class="o">:</span> <span class="nb">Number</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="p">};</span>
  <span class="p">};</span>
</code></pre></div>
<p>The <code>package.json</code> looks like the following:</p>
<div class="highlight"><pre class="chroma"><code class="language-json" data-lang="json"><span class="p">{</span>
  <span class="nt">&#34;main&#34;</span><span class="p">:</span> <span class="s2">&#34;micro-app.js&#34;</span><span class="p">,</span>
  <span class="nt">&#34;scripts&#34;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&#34;express&#34;</span><span class="p">:</span> <span class="s2">&#34;node express-app.js&#34;</span><span class="p">,</span>
    <span class="nt">&#34;micro&#34;</span><span class="p">:</span> <span class="s2">&#34;micro&#34;</span>
  <span class="p">},</span>
  <span class="nt">&#34;dependencies&#34;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&#34;body-parser&#34;</span><span class="p">:</span> <span class="s2">&#34;^1.18.3&#34;</span><span class="p">,</span>
    <span class="nt">&#34;express&#34;</span><span class="p">:</span> <span class="s2">&#34;^4.16.4&#34;</span><span class="p">,</span>
    <span class="nt">&#34;micro&#34;</span><span class="p">:</span> <span class="s2">&#34;^9.3.3&#34;</span>
  <span class="p">}</span>
<span class="p">}</span></code></pre></div>
<p>You can find this working example on GitHub: <a href="https://github.com/HugoDF/micro-vs-express-example">github.com/HugoDF/micro-vs-express-example</a>.</p>

<h2 id="how-micro-helps-your-architecture">How <code>micro</code> helps your architecture</h2>

<p>Mapping my lambdas into a micro app I used <code>[fs-router](https://github.com/jesseditson/fs-router)</code> to have 2 routes, one for <code>input is a site URL OR input is a feed URL</code> and one for <code>input is a feed URL</code>.</p>

<p>What happened when adding <code>fs-router</code> was interesting.</p>

<p>In micro, you have to put effort to have routes. This effort is similar to the effort required in Express to have body parsing. Which illustrates what each of these tools considers core to the problem they’re solving vs something that can be done but isn’t the core problem.</p>

<p><code>micro</code>&rsquo;s problem is around building simple, explicit and a large number of (micro)services. This is why routing is not in the core: with microservices, with the right interfaces a chunk of services might not require routing.</p>

<p><code>express</code> takes the opposite view, it’s designed to be flexible for any server application on Node. From building simple one-route applications to REST APIs to building fully-featured, single-deployment web applications with server-rendered templates. With this in mind it goes about solving two core problems: routing and a standardised plugin system (based on middleware).</p>

<p>For this project, this friction made me realise that having two endpoints which have duplicated functionality is crazy: <code>input is a feed URL</code> is already covered by <code>input is a site URL OR input is a feed URL</code>. So I deleted the second route, removed <code>fs-router</code> and deployed 👍.</p>

<p>Another feature of micro that I want to illustrate is the following:</p>
<div class="highlight"><pre class="chroma"><code class="language-js" data-lang="js"><span class="k">const</span> <span class="nx">applyMiddlewares</span> <span class="o">=</span> <span class="nx">handler</span> <span class="p">=&gt;</span>
  <span class="nx">health</span><span class="p">(</span>
    <span class="nx">log</span><span class="p">(</span>
      <span class="nx">cors</span><span class="p">(</span>
        <span class="nx">rateLimit</span><span class="p">(</span>
          <span class="nx">handler</span>
        <span class="p">)</span>
      <span class="p">)</span>
    <span class="p">)</span>
<span class="p">);</span>
<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">applyMiddlewares</span><span class="p">((</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">=&gt;</span> 
  <span class="s1">&#39;Service with /health, logging, CORS and rate-limiting&#39;</span>
<span class="p">);</span>
</code></pre></div>
<p>“middleware” is just a set of functions, that are composed and applied to a handler (instead of the more opaque <code>app.use(() =&gt; {})</code> or <code>app.get(</code><code>'</code><code>/path</code><code>'</code><code>, middleware1, middleware2, handler)</code>). The handler defines what augmentations is wants/needs instead of expecting the top-level app to provide them.</p>

<h2 id="the-micro-docs-ecosystem-and-examples">The <code>micro</code> docs, ecosystem and examples</h2>

<p>Micro&rsquo;s docs reflect the library’s philosophy: they’re clean and simple and showcase the few core use-cases and actions, the following is similar to what’s at <a href="https://github.com/zeit/micro#usage:">https://github.com/zeit/micro#usage:</a>
This is the hello world, <code>app.js</code></p>
<div class="highlight"><pre class="chroma"><code class="language-js" data-lang="js"><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="s1">&#39;Hello world&#39;</span><span class="p">;</span>
</code></pre></div>
<p>You can set the following <code>package.json</code>:</p>
<div class="highlight"><pre class="chroma"><code class="language-json" data-lang="json"><span class="p">{</span>
  <span class="nt">&#34;main&#34;</span><span class="p">:</span> <span class="s2">&#34;app.js&#34;</span><span class="p">,</span>
  <span class="nt">&#34;scripts&#34;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&#34;start&#34;</span><span class="p">:</span> <span class="s2">&#34;micro&#34;</span>
  <span class="p">},</span>
  <span class="nt">&#34;dependencies&#34;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&#34;micro&#34;</span><span class="p">:</span> <span class="s2">&#34;latest&#34;</span>
  <span class="p">}</span>
<span class="p">}</span></code></pre></div>
<p>Which can then be run with <code>npm start</code>.</p>

<h2 id="further-information">Further information</h2>

<p>I’ll be writing up some of the details of how I deploy my <code>micro</code> service(s) and Express apps, there’s already a teaser on that topic: <a href="https://codewithhugo.com/deployment-options-netlify---dokku-on-digitalocean-vs-now.sh-github-pages-heroku-and-aws/">Deployment options: Netlify + Dokku on DigitalOcean vs now.sh, GitHub Pages, Heroku and AWS</a>.</p>

<p>Feel free to tweet at me <a href="https://twitter.com/@hugo__df">@hugo__df</a>.</p>

<p><a style="background-color:black;color:white;text-decoration:none;padding:4px 6px;font-family:-apple-system, BlinkMacSystemFont, &quot;San Francisco&quot;, &quot;Helvetica Neue&quot;, Helvetica, Ubuntu, Roboto, Noto, &quot;Segoe UI&quot;, Arial, sans-serif;font-size:12px;font-weight:bold;line-height:1.2;display:inline-block;border-radius:3px" href="https://unsplash.com/@kellysikkema?utm_medium=referral&amp;utm_campaign=photographer-credit&amp;utm_content=creditBadge" target="_blank" rel="noopener noreferrer" title="Download free do whatever you want high-resolution photos from Kelly Sikkema"><span style="display:inline-block;padding:2px 3px"><svg xmlns="http://www.w3.org/2000/svg" style="height:12px;width:auto;position:relative;vertical-align:middle;top:-1px;fill:white" viewBox="0 0 32 32"><title>unsplash-logo</title><path d="M20.8 18.1c0 2.7-2.2 4.8-4.8 4.8s-4.8-2.1-4.8-4.8c0-2.7 2.2-4.8 4.8-4.8 2.7.1 4.8 2.2 4.8 4.8zm11.2-7.4v14.9c0 2.3-1.9 4.3-4.3 4.3h-23.4c-2.4 0-4.3-1.9-4.3-4.3v-15c0-2.3 1.9-4.3 4.3-4.3h3.7l.8-2.3c.4-1.1 1.7-2 2.9-2h8.6c1.2 0 2.5.9 2.9 2l.8 2.4h3.7c2.4 0 4.3 1.9 4.3 4.3zm-8.6 7.5c0-4.1-3.3-7.5-7.5-7.5-4.1 0-7.5 3.4-7.5 7.5s3.3 7.5 7.5 7.5c4.2-.1 7.5-3.4 7.5-7.5z"></path></svg></span><span style="display:inline-block;padding:2px 3px">Kelly Sikkema</span></a></p>

        </div>
    </section>

    <section class="subscribe-form">
        <h3 class="subscribe-form-title">Subscribe to Code with Hugo</h3>
        <p>Get all the posts of the week before anyone else in your inbox</p>
        <form
            action="https://buttondown.email/api/emails/embed-subscribe/hugo"
            method="post"
            target="popupwindow"
            onsubmit="window.open('https://buttondown.email/hugo', 'popupwindow')"
        >
            <div class="form-group">
                <input class="subscribe-email" type="email" name="email" id="bd-email" placeholder="youremail@example.com">
                <input type="hidden" value="1" name="embed"/>
            </div>
            <button class="" value="Subscribe" type="submit"><span>Subscribe</span></button>
        </form>
    </section>

    <footer class="post-full-footer">
      <section class="author-card">
        <img class="author-profile-image" src="https://cdn-images-1.medium.com/fit/c/200/200/0*Rb-aDjpTtV1UZA4O.jpeg" alt="Author" />
        <section class="author-card-content">
            <h4 class="author-card-name"><a href="https://codewithhugo.com/">Hugo Di Francesco</a></h4>
                <p>A developer, working out of London writing CSS, JavaScript and Python.</p>
        </section>
      </section>
    </footer>
</article>


  <section class="overlay-cta">
    <div class="overlay-cta__inner">
      <div class="overlay-cta__text-container">
        <h3 class="cta-title overlay-cta__title">
          Subscribe to the Code with Hugo newsletter
        </h3>
        <p class="cta-text overlay-cta__text">
          Get the best and latest articles in your inbox every week
        </p>
      </div>
      <div class="overlay-cta__button-container">
        <a href="https://buttondown.email/hugo" class="button overlay-cta__button">
          Subscribe
        </a>
        <a href="#" class="overlay-cta__close">close</a>
      </div>
    </div>
  </section>



    
    
    

  </div>
</main>


<aside class="read-next outer">
  <div class="inner">
    <div class="read-next-feed">      
      
<article class="read-next-card" 
            style="background-image: url(https://codewithhugo.com/img/cover.jpg);" >
    <header class="read-next-card-header">
        <small class="read-next-card-header-sitetitle">&mdash; Code with Hugo &mdash;</small>
        
        <h3 class="read-next-card-header-title"><a href="https://codewithhugo.com/tags/javascript/">#JavaScript</a></h3>
    </header>
    <div class="read-next-divider"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 14.5s2 3 5 3 5.5-2.463 5.5-5.5S21 6.5 18 6.5c-5 0-7 11-12 11C2.962 17.5.5 15.037.5 12S3 6.5 6 6.5s4.5 3.5 4.5 3.5"/></svg>
    </div>

    <div class="read-next-card-content">
      
        <ul>
          <li><a href="https://codewithhugo.com/ava-low-config-testing-for-javascript/">AVA, low-config testing for JavaScript</a></li>            
        
          <li><a href="https://codewithhugo.com/a-simple-javascript/node-coding-setup-on-mac-os-x/">A simple JavaScript/Node coding setup on Mac OS X</a></li>            
        
          <li><a href="https://codewithhugo.com/build-and-deploy-a-vue/react/vanilla-js-app-with-parcel-and-github-pages/">Build and deploy a Vue/React/Vanilla JS app with Parcel and GitHub pages</a></li>            
        
          <li><a href="https://codewithhugo.com/progress-and-roadblocks-a-journey-into-open-source/">Progress and roadblocks: a journey into open-source</a></li>            
        </ul>
    </div>
    <footer class="read-next-card-footer">
      
        <a href="https://codewithhugo.com/tags/javascript/">See all related posts →</a>
    </footer>
</article>


      
      <article class="post-card post"> 
    
    <a class="post-card-image-link" href="https://codewithhugo.com/a-tiny-case-study-about-migrating-to-netlify-when-disaster-strikes-at-github-featuring-cloudflare/">
      <div class="post-card-image" style="background-image: url(https://codewithhugo.com/img/anthony-cantin-unsplash.jpg)"></div>
    </a>
    

    <div class="post-card-content">
      <a class="post-card-content-link" href="https://codewithhugo.com/a-tiny-case-study-about-migrating-to-netlify-when-disaster-strikes-at-github-featuring-cloudflare/">
          <header class="post-card-header">
              <span class="post-card-tags">
              #deployment 
              #meta 
              #JavaScript  </span>
              
              <h2 class="post-card-title">A tiny case study about migrating to Netlify when disaster strikes at GitHub, featuring Cloudflare</h2>
          </header>
          <section class="post-card-excerpt">
              
                <p> Last Monday (22 October 2018) GitHub was going 💥, and scheduled content on Code with Hugo wasn’t going live.
 For context, the blog’s setup is documented in “Switching the lights on: Hugo vs Hugo config files”.
tl;dr (as is relevant to this post)
 Cloudflare DNS + CDN + proxying + HTTPS GitHub Pages Hugo as a static site generator CircleCI to deploy the site daily + on push (🤷‍♀️wasn’t in the post but that’s how I do it)  
 ...  </p>
              
          </section>
      </a>

      <footer class="post-card-meta">
          <img class="author-profile-image" src="https://cdn-images-1.medium.com/fit/c/200/200/0*Rb-aDjpTtV1UZA4O.jpeg" alt="Author" />
          <span class="post-card-author"><a href="/">Hugo Di Francesco</a></span>
      </footer>
    </div>
</article>
      
      
      <article class="post-card post"> 
    
    <a class="post-card-image-link" href="https://codewithhugo.com/abusing-jest-snapshot-tests-some-nice-use-cases-/">
      <div class="post-card-image" style="background-image: url(https://codewithhugo.com/img/ben-sauer-unsplash.jpg)"></div>
    </a>
    

    <div class="post-card-content">
      <a class="post-card-content-link" href="https://codewithhugo.com/abusing-jest-snapshot-tests-some-nice-use-cases-/">
          <header class="post-card-header">
              <span class="post-card-tags">
              #Testing 
              #JavaScript 
              #ES6  </span>
              
              <h2 class="post-card-title">When to use Jest snapshot tests: comprehensive use-cases and examples 📸</h2>
          </header>
          <section class="post-card-excerpt">
              
                <p>There&rsquo;s some nice use-cases for snapshot tests outside of the well-travelled React/Vue UI component ones.
In other words, although React and Vue testing with snapshots is pretty well documented, that&rsquo;s not the only place they&rsquo;re useful.
As a rule of thumb, you could replace a lot of unit tests that assert on with specific data with snapshot tests.
We have the following pros for snapshot tests: - the match data is stored in a separate file so it&rsquo;s harder to lose track of things, eg. ...  </p>
              
          </section>
      </a>

      <footer class="post-card-meta">
          <img class="author-profile-image" src="https://cdn-images-1.medium.com/fit/c/200/200/0*Rb-aDjpTtV1UZA4O.jpeg" alt="Author" />
          <span class="post-card-author"><a href="/">Hugo Di Francesco</a></span>
      </footer>
    </div>
</article>
      
    </div>
  </div>
</aside>

<div class="floating-header">
  <div class="floating-header-logo">
    <a href="https://codewithhugo.com/">
      
      <span>Code with Hugo</span>
    </a>
  </div>
  <span class="floating-header-divider">&mdash;</span>
  <div class="floating-header-title">Simple, but not too simple: how using Zeit’s `micro` improves your Node applications</div>
  <div class="floating-header-share">
    <div class="floating-header-share-label">Share this <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
     <path d="M7.5 15.5V4a1.5 1.5 0 1 1 3 0v4.5h2a1 1 0 0 1 1 1h2a1 1 0 0 1 1 1H18a1.5 1.5 0 0 1 1.5 1.5v3.099c0 .929-.13 1.854-.385 2.748L17.5 23.5h-9c-1.5-2-5.417-8.673-5.417-8.673a1.2 1.2 0 0 1 1.76-1.605L7.5 15.5zm6-6v2m-3-3.5v3.5m6-1v2"/></svg>
    </div>

    
    <a class="floating-header-share-tw" href="https://twitter.com/share?text=%22Simple%2c%20but%20not%20too%20simple%3a%20how%20using%20Zeit%e2%80%99s%20%60micro%60%20improves%20your%20Node%20applications%22%20by%20%40hugo__df&amp;url=https%3a%2f%2fcodewithhugo.com%2fsimple-but-not-too-simple-how-using-zeits-micro-improves-your-node-applications%2f&amp"
          onclick="window.open(this.href, 'share-twitter', 'width=550,height=235');return false;">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M30.063 7.313c-.813 1.125-1.75 2.125-2.875 2.938v.75c0 1.563-.188 3.125-.688 4.625a15.088 15.088 0 0 1-2.063 4.438c-.875 1.438-2 2.688-3.25 3.813a15.015 15.015 0 0 1-4.625 2.563c-1.813.688-3.75 1-5.75 1-3.25 0-6.188-.875-8.875-2.625.438.063.875.125 1.375.125 2.688 0 5.063-.875 7.188-2.5-1.25 0-2.375-.375-3.375-1.125s-1.688-1.688-2.063-2.875c.438.063.813.125 1.125.125.5 0 1-.063 1.5-.25-1.313-.25-2.438-.938-3.313-1.938a5.673 5.673 0 0 1-1.313-3.688v-.063c.813.438 1.688.688 2.625.688a5.228 5.228 0 0 1-1.875-2c-.5-.875-.688-1.813-.688-2.75 0-1.063.25-2.063.75-2.938 1.438 1.75 3.188 3.188 5.25 4.25s4.313 1.688 6.688 1.813a5.579 5.579 0 0 1 1.5-5.438c1.125-1.125 2.5-1.688 4.125-1.688s3.063.625 4.188 1.813a11.48 11.48 0 0 0 3.688-1.375c-.438 1.375-1.313 2.438-2.563 3.188 1.125-.125 2.188-.438 3.313-.875z"/></svg>
      </a>
      <a class="floating-header-share-fb" href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fcodewithhugo.com%2fsimple-but-not-too-simple-how-using-zeits-micro-improves-your-node-applications%2f"
          onclick="window.open(this.href, 'share-facebook','width=580,height=296');return false;">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M19 6h5V0h-5c-3.86 0-7 3.14-7 7v3H8v6h4v16h6V16h5l1-6h-6V7c0-.542.458-1 1-1z"/></svg>
      </a>
  </div>

  <progress class="progress" value="0">
    <div class="progress-container">
      <span class="progress-bar"></span>
    </div>
  </progress>
</div>



<footer class="site-footer outer">
  <div class="site-footer-content inner">
    <section class="copyright" style="line-height: 1.3em;">
      <a href="/">Code with Hugo</a>  <br>
      
    </section>
    <nav class="site-footer-nav">
        <a href="/">Latest Posts</a>
        
        <a href="https://twitter.com/hugo__df" target="_blank" rel="noopener">Twitter</a>
        <a href="https://github.com/HugoDF" target="_blank" rel="noopener">Github</a>
        
        <a href="https://medium.com/@hugo__df" target="_blank" rel="noopener">Medium</a>
    </nav>  
  </div>
</footer>

</div>

<script type="text/javascript" src="//code.jquery.com/jquery-3.2.1.min.js"></script>
<script type="text/javascript" src="https://codewithhugo.com/js/jquery.fitvids.js"></script>




  <!-- Google Analytics -->
  <script>
    var _gaq=[['_setAccount','UA-60469708-1'],['_trackPageview']];
    (function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];
    g.src=('https:'==location.protocol?'//ssl':'//www')+'.google-analytics.com/ga.js';
    s.parentNode.insertBefore(g,s)}(document,'script'));
  </script>



<script async src="//cdn.simpleanalytics.io/hello.js"></script>
<noscript><img src="//api.simpleanalytics.io/hello.gif" alt=""></noscript>





<script>
  (function (document) {
    function getLastDocumentHeight(document) {
      var body = document.body;
      var html = document.documentElement;
      return Math.max(
        body.scrollHeight, body.offsetHeight,
        html.clientHeight, html.scrollHeight,
        html.offsetHeight
      );
    }

    var $overlay = document.querySelector('.overlay-cta');
    var hiddenClass = 'overlay-cta--hidden';
    var closedClass = 'overlay-cta--closed';
    $overlay.classList.add(hiddenClass);

    
    var $overlayClose = document.querySelector('.overlay-cta__close');
    var overlayCloseListener = $overlayClose.addEventListener('click', function (e) {
      e.preventDefault();
      $overlay.classList.add(closedClass);
    });

    var $heroCtaButton = document.querySelector('.hero-cta .button');
    var $firstContentItem = document.querySelector('.post-full-content > * > *');
    var title = $heroCtaButton || $firstContentItem;

    var $subscribeBox = document.querySelector('.subscribe-form');

    var lastScrollY = window.scrollY;
    var lastWindowHeight = window.innerHeight;
    var lastDocumentHeight = getLastDocumentHeight(document);
    var ticking = false;


    function onScroll() {
      lastScrollY = window.scrollY;
      requestTick();
    }

    function onResize() {
      lastWindowHeight = window.innerHeight;
      lastDocumentHeight = getLastDocumentHeight(document);
      requestTick();
    }

    function requestTick() {
      if (!ticking) {
        requestAnimationFrame(update);
      }
      ticking = true;
    }

    function update() {
      var trigger = title.getBoundingClientRect().top + window.scrollY;
      var triggerOffset = title.offsetHeight + 35;
      var lastShowCtaBoxHeight = $subscribeBox.getBoundingClientRect().top ;
      
      if (
        lastScrollY >= trigger + triggerOffset &&
        lastShowCtaBoxHeight > lastWindowHeight
      ) {
        $overlay.classList.remove(hiddenClass);
      } else {
        $overlay.classList.add(hiddenClass);
      }

      ticking = false;
    }

    window.addEventListener('scroll', onScroll, { passive: true });
    window.addEventListener('resize', onResize, false);

    update();
  })(document);
</script>


    <script>





$(document).ready(function () {
    
    var $postContent = $(".post-full-content");
    $postContent.fitVids();
    

    var progressBar = document.querySelector('progress');
    var header = document.querySelector('.floating-header');
    var title = document.querySelector('.post-full-title');

    var lastScrollY = window.scrollY;
    var lastWindowHeight = window.innerHeight;
    var lastDocumentHeight = $(document).height();
    var ticking = false;

    function onScroll() {
        lastScrollY = window.scrollY;
        requestTick();
    }

    function onResize() {
        lastWindowHeight = window.innerHeight;
        lastDocumentHeight = $(document).height();
        requestTick();
    }

    function requestTick() {
        if (!ticking) {
            requestAnimationFrame(update);
        }
        ticking = true;
    }

    function update() {
        var trigger = title.getBoundingClientRect().top + window.scrollY;
        var triggerOffset = title.offsetHeight + 35;
        var progressMax = lastDocumentHeight - lastWindowHeight;

        
        if (lastScrollY >= trigger + triggerOffset) {
            header.classList.add('floating-active');
        } else {
            header.classList.remove('floating-active');
        }

        progressBar.setAttribute('max', progressMax);
        progressBar.setAttribute('value', lastScrollY);

        ticking = false;
    }

    window.addEventListener('scroll', onScroll, {passive: true});
    window.addEventListener('resize', onResize, false);

    update();
});
</script>
</body></html>
