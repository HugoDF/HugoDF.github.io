<!DOCTYPE html>
<html lang="en-US" />
<head>
    <meta http-equiv="Content-Type" content="text/html" charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="google-site-verification" content="gBfbdXRLofaOyHsbgiSiuCIHKPaviGMRVWh_qOfDHNE" />

    <title>Sequelize 4 ES6 Cheat Sheet &middot; Code with Hugo</title>

    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="apple-touch-icon" sizes="120x120" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#00aba9">
    <meta name="theme-color" content="#090a0b">

    <link rel="shortcut icon" href="https://codewithhugo.com/favicon.ico" />
    <meta name="theme-color" content="#090a0b">
    
    <link rel="canonical" href="https://codewithhugo.com/guides/sequelize-es6-cheatsheet/" /> 

     <meta name="description" content="&lt;p&gt;This is a cheat sheet to ramp up your &lt;strong&gt;Sequelize productivity&lt;/strong&gt;.
&lt;/p&gt;" /> 

     
    
    <meta name="twitter:card" content="summary_large_image"/>
    <meta name="twitter:image" content="https://i.imgur.com/yx2Wpse.png"/>
    
 
    <meta name="twitter:title" content="Sequelize 4 ES6 Cheat Sheet"/>
    <meta name="twitter:description" content="&lt;p&gt;This is a cheat sheet to ramp up your &lt;strong&gt;Sequelize productivity&lt;/strong&gt;.
&lt;/p&gt;"/>
    <meta name="twitter:url" content="https://codewithhugo.com/guides/sequelize-es6-cheatsheet/" />
    <meta name="twitter:site" content="@hugo__df"/>

    <meta property="og:site_name" content="Code with Hugo" />
    <meta property="og:title" content="Sequelize 4 ES6 Cheat Sheet &middot; Code with Hugo" />
    <meta property="og:url" content="https://codewithhugo.com/guides/sequelize-es6-cheatsheet/" />
    

    <meta property="og:type" content="article" />
    <meta property="og:description" content="&lt;p&gt;This is a cheat sheet to ramp up your &lt;strong&gt;Sequelize productivity&lt;/strong&gt;.
&lt;/p&gt;" />

    <meta property="article:published_time" content="0001-01-01T00:00:00Z" />
    

    <meta property="og:image" content="https://i.imgur.com/yx2Wpse.png"/>


    <meta name="generator" content="Hugo 0.46" />

    <!-- Stylesheets -->
    <link rel="stylesheet" type="text/css" href="https://codewithhugo.com/built/screen.css" />
    <link rel="stylesheet" type="text/css" href="https://codewithhugo.com/css/casper-two.css" />
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css" />
    
      
      <link rel="stylesheet" href="https://codewithhugo.com/overrides.min.d4792608561f2f90b88204f4f1f084917e02a0e781972321f2716d085725cbf2.css">
    
      
      <link rel="stylesheet" href="https://codewithhugo.com/syntax.min.e1646a3f88f77e1b5e7d0253633b1958013aa132890dfe4d7e15dc4718d4aecc.css">
    
      
      <link rel="stylesheet" href="https://codewithhugo.com/cta.min.e78c0bb9686c3a53ce9ba4c0d5c59abfa16cc34c2a616a001f7e4b473644374c.css">
    

    
      
        
        <link rel="stylesheet" href="https://codewithhugo.com/with-table-of-contents.min.8aad1f9cd1f3f63c2a9d5b1c1abe70115f6e54b6ecc269542576ea71becfbe1d.css">
      
        
        <link rel="stylesheet" href="https://codewithhugo.com/js-buy-overlay.min.dc63450d503aaa9dc31da7101cdc2d351b92b78984dc808a953f41adf9ee1c9f.css">
      
    

     
</head>
 

  <body class="page-template">
    <div class="site-wrapper js-site-wrapper">

      <header class="site-header outer">
  <div class="inner">
    <nav class="site-nav">
      <div class="site-nav-left">

        <ul class="nav" role="menu">
        
        
        
            <li class="" role="menuitem">
              <a href="/">Home</a>
            </li>
        
            <li class="" role="menuitem">
              <a href="/tags/">Categories</a>
            </li>
        
            <li class="" role="menuitem">
              <a href="/guides/">guides</a>
            </li>
        
            <li class="" role="menuitem">
              <a href="/tags/javascript/">JavaScript</a>
            </li>
        
            <li class="" role="menuitem">
              <a href="/tags/node/">Node</a>
            </li>
        
            <li class="" role="menuitem">
              <a href="/tags/sequelize/">Sequelize</a>
            </li>
        
            <li class="" role="menuitem">
              <a href="/tags/deployment/">Deployment</a>
            </li>
        
            <li class="" role="menuitem">
              <a href="/open/">#open</a>
            </li>
        
            <li class="" role="menuitem">
              <a href="https://checkoutpage.co/checkout/hugo/consulting-fee">#AMA</a>
            </li>
        
      </ul></div>

      <div class="site-nav-right">
        <div class="social-links">
                    

                    <a class="social-link social-link-tw" href="https://twitter.com/hugo__df" target="_blank" rel="noopener"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M30.063 7.313c-.813 1.125-1.75 2.125-2.875 2.938v.75c0 1.563-.188 3.125-.688 4.625a15.088 15.088 0 0 1-2.063 4.438c-.875 1.438-2 2.688-3.25 3.813a15.015 15.015 0 0 1-4.625 2.563c-1.813.688-3.75 1-5.75 1-3.25 0-6.188-.875-8.875-2.625.438.063.875.125 1.375.125 2.688 0 5.063-.875 7.188-2.5-1.25 0-2.375-.375-3.375-1.125s-1.688-1.688-2.063-2.875c.438.063.813.125 1.125.125.5 0 1-.063 1.5-.25-1.313-.25-2.438-.938-3.313-1.938a5.673 5.673 0 0 1-1.313-3.688v-.063c.813.438 1.688.688 2.625.688a5.228 5.228 0 0 1-1.875-2c-.5-.875-.688-1.813-.688-2.75 0-1.063.25-2.063.75-2.938 1.438 1.75 3.188 3.188 5.25 4.25s4.313 1.688 6.688 1.813a5.579 5.579 0 0 1 1.5-5.438c1.125-1.125 2.5-1.688 4.125-1.688s3.063.625 4.188 1.813a11.48 11.48 0 0 0 3.688-1.375c-.438 1.375-1.313 2.438-2.563 3.188 1.125-.125 2.188-.438 3.313-.875z"/></svg></a>

                    <a class="social-link" href="https://github.com/HugoDF" target="_blank" rel="noopener"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a>

                    

                    <a class="social-link" href="https://medium.com/@hugo__df" target="_blank" rel="noopener"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 195 195"><path d="M46.5340803,65.2157554 C46.6968378,63.6076572 46.0836,62.018231 44.8828198,60.93592 L32.6512605,46.2010582 L32.6512605,44 L70.6302521,44 L99.9859944,108.380952 L125.794585,44 L162,44 L162,46.2010582 L151.542017,56.2281011 C150.640424,56.9153477 150.193188,58.0448862 150.380019,59.1628454 L150.380019,132.837155 C150.193188,133.955114 150.640424,135.084652 151.542017,135.771899 L161.755369,145.798942 L161.755369,148 L110.38282,148 L110.38282,145.798942 L120.963119,135.527337 C122.002801,134.487948 122.002801,134.182246 122.002801,132.592593 L122.002801,73.0417402 L92.585901,147.755438 L88.6106443,147.755438 L54.3622782,73.0417402 L54.3622782,123.115814 C54.0767278,125.221069 54.7759199,127.3406 56.2581699,128.863022 L70.0186741,145.55438 L70.0186741,147.755438 L31,147.755438 L31,145.55438 L44.7605042,128.863022 C46.2319621,127.338076 46.8903838,125.204485 46.5340803,123.115814 L46.5340803,65.2157554 Z"/></svg></a>
        </div>  
        
        <a class="subscribe-button" href="https://codewithhugo.com/index.xml">Subscribe</a>
            
      </div>

    </nav>  

  </div>
</header>


      <main id="site-main" class="site-main outer" role="main">

        
          <aside class="js-buy-overlay">
            <h2 class="js-buy-overlay__title">Get the Sequelize ES6 cheat sheet</h2>
            <p>Use Sequelize with modern ES6+ JavaScript.<br/>Ready to use examples to increase your productivity.<br/></p>
            <button
              class="cp-button button"
              data-seller="hugo"
              data-checkout="sequelize-cheatsheet"
            >
              Buy it now
            </button>
            <p class="js-buy-overlay__already-bought">
              Already bought it?
              Check your emails or get in touch <a href="mailto:hi@codewithhugo.com">hi@codewithhugo.com</a>
            </p>
          </aside>
        


        <div class="inner inner--table-of-contents">
          <aside class="post-full__table-of-contents">
            <nav id="TableOfContents">
<ul>
<li><a href="#datatypes">DataTypes</a>
<ul>
<li><a href="#text-types">Text types</a></li>
<li><a href="#default-values">Default values</a></li>
<li><a href="#number">Number</a></li>
<li><a href="#fancy-primitive-types">Fancy primitive types</a></li>
<li><a href="#date-time">Date/Time</a></li>
<li><a href="#fancy-types">Fancy types</a></li>
<li><a href="#postgres-fancy-types">Postgres fancy types</a></li>
</ul></li>
<li><a href="#models">Models</a>
<ul>
<li><a href="#aggregate-all-models-under-a-db-module">Aggregate all models under a db module</a></li>
<li><a href="#individual-model-initialisation-method">Individual model initialisation method</a></li>
<li><a href="#running-associations">Running associations</a></li>
<li><a href="#setting-a-custom-table-name">Setting a custom table name</a></li>
<li><a href="#setting-up-a-custom-model-name">Setting up a custom model name</a></li>
</ul></li>
<li><a href="#querying">Querying</a>
<ul>
<li><a href="#create-instance-of-multiple-level-associated-model">Create instance of (multiple-level) associated model</a></li>
<li><a href="#order-by-multiple-level-nested-association-model-field">Order by (multiple-level) nested association model field</a></li>
<li><a href="#fetch-latest-of-association-by-field">Fetch latest of association by field</a></li>
<li><a href="#fetch-one-of-association">Fetch one of association</a></li>
<li><a href="#hydrate-an-association-load-without-eager-loading-it">Hydrate an association load without eager loading it</a></li>
<li><a href="#hydrate-a-1-many-association-load-without-eager-loading">Hydrate a 1-many association load without eager loading</a></li>
<li><a href="#leveraging-transactions">Leveraging transactions</a></li>
<li><a href="#select-if-association-meets-a-criteria">Select if association meets a criteria</a></li>
</ul></li>
<li><a href="#migrations-and-data-model">Migrations and data model</a>
<ul>
<li><a href="#create-model-and-add-index">Create model and add index</a></li>
<li><a href="#add-column">Add column</a></li>
<li><a href="#add-compound-unique-constraint">Add compound unique constraint</a></li>
<li><a href="#add-index-to-table">Add index to table</a></li>
</ul></li>
<li><a href="#cli">CLI</a>
<ul>
<li><a href="#create-migration">Create migration</a></li>
<li><a href="#create-model">Create model</a></li>
</ul></li>
<li><a href="#advanced-configuration">Advanced Configuration</a>
<ul>
<li><a href="#custom-path-for-models-migrations-config">Custom path for models/migrations/config</a></li>
<li><a href="#set-up-connection-config-from-a-database-url-environment-variable">Set up connection config from a database URL environment variable</a></li>
</ul></li>
</ul>
</nav>
          </aside>

          <article class="post-full post-full--table-of-contents post page no-image">
            <header class="post-full-header">
              <h1 class="post-full-title">Sequelize 4 ES6 Cheat Sheet</h1>
            </header>

            <section class="post-full-content">
              <div class="kg-card-markdown">
                <p>This is a cheat sheet to ramp up your <strong>Sequelize productivity</strong>.
</p>
<div class="highlight"><pre class="chroma"><code class="language-js" data-lang="js"><span class="k">const</span> <span class="p">{</span> <span class="nx">Model</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&#34;sequelize&#34;</span><span class="p">);</span>
<span class="k">class</span> <span class="nx">MyModel</span> <span class="k">extends</span> <span class="nx">Model</span> <span class="p">{</span>
  <span class="kr">static</span> <span class="nx">init</span><span class="p">(</span><span class="nx">sequelize</span><span class="p">,</span> <span class="nx">DataTypes</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">super</span><span class="p">.</span><span class="nx">init</span><span class="p">(</span>
      <span class="p">{</span>
        <span class="nx">myField</span><span class="o">:</span> <span class="nx">DataTypes</span><span class="p">.</span><span class="nx">STRING</span>
      <span class="p">},</span>
      <span class="p">{</span> <span class="nx">sequelize</span> <span class="p">}</span>
    <span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">MyModel</span><span class="p">;</span>
</code></pre></div>
<p>It’s like the <strong>better Sequelize docs</strong>, you&rsquo;ve never had.</p>

<p>All the examples are written using <strong>ES6 JavaScript syntax</strong>, they’re real-world snippets for Sequelize for you to use.</p>

<p>This is beyond the introductory examples for Sequelize, used in the latest version of Node (hence async/await support and other ES6+ features).</p>

<p>The best way to navigate is to use the table of contents which is on the left on desktop and which you can <strong><a href="#TableOfContents">jump to</a></strong> on mobile.</p>

<h1 id="datatypes">DataTypes</h1>

<p>DataTypes contains both the types and generators for default values: eg. <code>NOW</code>, <code>UUIDV1</code> and <code>UUIDV4</code> are special default values.</p>

<p>The places where you&rsquo;re likely to encounter DataTypes are in the model field definition and in the migration definitions. Note that for a given model and field, the data type should be the <em>same</em> in the model and in the migration.</p>

<h2 id="text-types">Text types</h2>

<ul>
<li><code>STRING</code>

<ul>
<li>A variable length string.</li>
<li>Default length 255.</li>
<li>Supports <code>BINARY</code></li>
<li>Usage: a 100 length binary string <code>DataTypes.STRING(100).BINARY</code></li>
</ul></li>
<li><code>CHAR</code>

<ul>
<li>A fixed length string.</li>
<li>Default length 255.</li>
<li>Supports <code>BINARY</code></li>
<li>Usage: a 100 length binary char <code>DataTypes.CHAR(100).BINARY</code></li>
</ul></li>
<li><code>TEXT</code>: An unlimited length text column</li>
</ul>

<h2 id="default-values">Default values</h2>

<ul>
<li><code>NOW</code>: A default value of the current timestamp</li>
<li><code>UUIDV1</code>: A default unique universal identifier generated following the UUID v1 standard</li>
<li><code>UUIDV4</code>: A default unique universal identifier generated following the UUID v2 standard</li>
</ul>

<h2 id="number">Number</h2>

<p>All the following support these properties: <code>UNSIGNED</code>, <code>ZEROFILL</code>.</p>

<p>eg.</p>
<div class="highlight"><pre class="chroma"><code class="language-js" data-lang="js"><span class="nx">DataTypes</span><span class="p">.</span><span class="nx">INTEGER</span><span class="p">.</span><span class="nx">UNSIGNED</span><span class="p">.</span><span class="nx">ZEROFILL</span>
<span class="c1">// or 
</span><span class="c1"></span><span class="nx">DataTypes</span><span class="p">.</span><span class="nx">INTEGER</span><span class="p">.</span><span class="nx">ZEROFILL</span><span class="p">.</span><span class="nx">UNSIGNED</span> 
</code></pre></div>
<p>The same can be done using <code>BIGINT.UNSIGNED</code>, <code>FLOAT.UNSIGNED</code> etc.</p>

<ul>
<li><code>INTEGER</code>: A 32 bit integer.</li>
<li><code>BIGINT</code>: A 64 bit integer.</li>
<li><code>FLOAT</code>: Floating point number (4-byte precision). Accepts one or two arguments for precision</li>
<li><code>REAL</code>: Floating point number (4-byte precision). Accepts one or two arguments for precision</li>
<li><code>DOUBLE</code>: Floating point number (8-byte precision). Accepts one or two arguments for precision</li>
<li><code>DECIMAL</code>: Decimal number. Accepts one or two arguments for precision</li>
</ul>

<h2 id="fancy-primitive-types">Fancy primitive types</h2>

<ul>
<li><code>BOOLEAN</code>: Boolean/tinyint column that gets coerced to a JavaScript Boolean.</li>
<li><code>UUID</code>: A column storing a unique universal identifier, shape is validated, use with <code>UUIDV1</code> or <code>UUIDV4</code> default values</li>
</ul>

<h2 id="date-time">Date/Time</h2>

<ul>
<li><code>TIME</code>: A time column</li>
<li><code>DATE</code>: A datetime column</li>
<li><code>DATEONLY</code>: A date only column</li>
</ul>

<h2 id="fancy-types">Fancy types</h2>

<ul>
<li><code>BLOB</code>: Binary storage. Available lengths: <code>tiny</code>, <code>medium</code>, <code>long</code> eg. <code>DataTypes.BLOG('tiny')</code></li>
<li><code>VIRTUAL</code>

<ul>
<li>A virtual value that is not stored in the DB. This could for example be useful if you want to provide a default value in your model that is returned to the user but not stored in the DB.</li>
<li><a href="https://sequelize.readthedocs.io/en/2.0/api/datatypes/#virtual">See the docs</a></li>
</ul></li>
<li><code>ENUM</code>

<ul>
<li>An enumeration.</li>
<li><code>DataTypes.ENUM('value', 'another value')</code></li>
<li>Ideally should be used with strings stored in constants
<code>js
const FIRST_ENUM_VALUE = 'FIRST_ENUM_VALUE';
const OTHER_ENUM_VALUE = 'OTHER_ENUM_VALUE';
// In migration or model definition
DataTypes.ENUM(FIRST_ENUM_VALUE, OTHER_ENUM_VALUE)
</code></li>
</ul></li>
</ul>

<h2 id="postgres-fancy-types">Postgres fancy types</h2>

<ul>
<li><code>HSTORE</code>: A key/value column</li>
<li><code>JSON</code>: A JSON string column.</li>
<li><code>JSONB</code>: A pre-processed JSON data column.</li>
<li><code>RANGE</code>: For Postgres 9.4+, range types are data types representing a range of values of some element type (called the range&rsquo;s subtype).</li>
<li><code>ARRAY</code>

<ul>
<li>An array of <code>type</code>, e.g. <code>DataTypes.ARRAY(DataTypes.DECIMAL)</code></li>
</ul></li>
</ul>

<h1 id="models">Models</h1>

<h2 id="aggregate-all-models-under-a-db-module">Aggregate all models under a db module</h2>
<div class="highlight"><pre class="chroma"><code class="language-js" data-lang="js"><span class="k">const</span> <span class="nx">Sequelize</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;sequelize&#39;</span><span class="p">);</span>

<span class="k">const</span> <span class="nx">sequelizeOptions</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">operatorsAliases</span><span class="o">:</span> <span class="nx">Sequelize</span><span class="p">.</span><span class="nx">Op</span>
<span class="p">};</span>
<span class="k">const</span> <span class="nx">sequelize</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Sequelize</span><span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">DATABASE_URL</span><span class="p">,</span> <span class="nx">sequelizeOptions</span><span class="p">);</span>

<span class="k">const</span> <span class="nx">FirstModel</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./first-model&#39;</span><span class="p">);</span>
<span class="k">const</span> <span class="nx">OtherModel</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./other-model&#39;</span><span class="p">);</span>
<span class="k">const</span> <span class="nx">AnotherAssociatedModel</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./another-associated-model&#39;</span><span class="p">);</span>

<span class="k">const</span> <span class="nx">models</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">First</span><span class="o">:</span> <span class="nx">FirstModel</span><span class="p">.</span><span class="nx">init</span><span class="p">(</span><span class="nx">sequelize</span><span class="p">,</span> <span class="nx">Sequelize</span><span class="p">),</span>
  <span class="nx">Other</span><span class="o">:</span> <span class="nx">OtherModel</span><span class="p">.</span><span class="nx">init</span><span class="p">(</span><span class="nx">sequelize</span><span class="p">,</span> <span class="nx">Sequelize</span><span class="p">),</span>
  <span class="nx">AnotherAssociated</span><span class="o">:</span> <span class="nx">AnotherAssociatedModel</span><span class="p">.</span><span class="nx">init</span><span class="p">(</span><span class="nx">sequelize</span><span class="p">,</span> <span class="nx">Sequelize</span><span class="p">)</span>
<span class="p">};</span>

<span class="c1">// Run .associate if it exists, this creates the ORM&#39;s relationships
</span><span class="c1"></span><span class="nb">Object</span><span class="p">.</span><span class="nx">values</span><span class="p">(</span><span class="nx">models</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">model</span> <span class="p">=&gt;</span> <span class="k">typeof</span> <span class="nx">model</span><span class="p">.</span><span class="nx">associate</span> <span class="o">===</span> <span class="s1">&#39;function&#39;</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">model</span> <span class="p">=&gt;</span> <span class="nx">model</span><span class="p">.</span><span class="nx">associate</span><span class="p">(</span><span class="nx">models</span><span class="p">));</span>

<span class="k">const</span> <span class="nx">db</span> <span class="o">=</span> <span class="p">{</span>
  <span class="p">...</span><span class="nx">models</span><span class="p">,</span>
  <span class="nx">sequelize</span>
<span class="p">};</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">db</span><span class="p">;</span>
</code></pre></div>
<p>About this approach:</p>

<p><code>models</code> are imported &ldquo;manually&rdquo; and explicitly, this means a bit more wiring work whenever you add a new model. This cost is offset by the increased readability of regular <code>import</code> statements.</p>

<h2 id="individual-model-initialisation-method">Individual model initialisation method</h2>
<div class="highlight"><pre class="chroma"><code class="language-js" data-lang="js"><span class="k">const</span> <span class="p">{</span> <span class="nx">Model</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&#34;sequelize&#34;</span><span class="p">);</span>
<span class="k">class</span> <span class="nx">MyModel</span> <span class="k">extends</span> <span class="nx">Model</span> <span class="p">{</span>
  <span class="kr">static</span> <span class="nx">init</span><span class="p">(</span><span class="nx">sequelize</span><span class="p">,</span> <span class="nx">DataTypes</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">super</span><span class="p">.</span><span class="nx">init</span><span class="p">(</span>
      <span class="p">{</span>
        <span class="nx">myField</span><span class="o">:</span> <span class="nx">DataTypes</span><span class="p">.</span><span class="nx">STRING</span>
      <span class="p">},</span>
      <span class="p">{</span> <span class="nx">sequelize</span> <span class="p">}</span>
    <span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">MyModel</span><span class="p">;</span>
</code></pre></div>
<h2 id="running-associations">Running associations</h2>

<p>Assuming your models are setup like in <a href="#aggregate-all-models-under-a-db-module">Aggregate all models under a db module</a>.</p>
<div class="highlight"><pre class="chroma"><code class="language-js" data-lang="js"><span class="k">const</span> <span class="p">{</span> <span class="nx">Model</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&#34;sequelize&#34;</span><span class="p">);</span>
<span class="k">class</span> <span class="nx">MyModel</span> <span class="k">extends</span> <span class="nx">Model</span> <span class="p">{</span>
  <span class="kr">static</span> <span class="nx">associate</span> <span class="p">(</span><span class="nx">models</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// associations can be defined here
</span><span class="c1"></span>    <span class="k">this</span><span class="p">.</span><span class="nx">association</span> <span class="o">=</span> <span class="nx">models</span><span class="p">.</span><span class="nx">MyModel</span><span class="p">.</span><span class="nx">hasMany</span><span class="p">(</span><span class="nx">models</span><span class="p">.</span><span class="nx">Associated</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">other</span> <span class="o">=</span> <span class="nx">models</span><span class="p">.</span><span class="nx">MyModel</span><span class="p">.</span><span class="nx">belongsTo</span><span class="p">(</span><span class="nx">models</span><span class="p">.</span><span class="nx">Other</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h2 id="setting-a-custom-table-name">Setting a custom table name</h2>
<div class="highlight"><pre class="chroma"><code class="language-js" data-lang="js"><span class="k">const</span> <span class="p">{</span> <span class="nx">Model</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;sequelize&#39;</span><span class="p">);</span>

<span class="k">const</span> <span class="nx">tableName</span> <span class="o">=</span> <span class="s1">&#39;myModelTableName&#39;</span><span class="p">;</span>

<span class="k">class</span> <span class="nx">MyModel</span> <span class="k">extends</span> <span class="nx">Model</span> <span class="p">{</span>
  <span class="kr">static</span> <span class="nx">init</span> <span class="p">(</span><span class="nx">sequelize</span><span class="p">,</span> <span class="nx">DataTypes</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">super</span><span class="p">.</span><span class="nx">init</span><span class="p">(</span>
      <span class="p">{},</span>
      <span class="p">{</span>
        <span class="nx">sequelize</span><span class="p">,</span>
        <span class="nx">tableName</span>
      <span class="p">}</span>
    <span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">MyModel</span><span class="p">;</span>
</code></pre></div>
<p>About this approach:</p>

<ul>
<li><code>{ tableName }</code> is using ES6 shorthand object notation.</li>
<li>Having the <code>tableName</code> be a <code>const</code> outside of the <code>init</code> method</li>
</ul>

<h2 id="setting-up-a-custom-model-name">Setting up a custom model name</h2>
<div class="highlight"><pre class="chroma"><code class="language-js" data-lang="js"><span class="k">const</span> <span class="p">{</span> <span class="nx">Model</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;sequelize&#39;</span><span class="p">);</span>

<span class="k">const</span> <span class="nx">modelName</span> <span class="o">=</span> <span class="s1">&#39;myCustomerModelName&#39;</span><span class="p">;</span>

<span class="k">class</span> <span class="nx">MyModel</span> <span class="k">extends</span> <span class="nx">Model</span> <span class="p">{</span>
  <span class="kr">static</span> <span class="nx">init</span> <span class="p">(</span><span class="nx">sequelize</span><span class="p">,</span> <span class="nx">DataTypes</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">super</span><span class="p">.</span><span class="nx">init</span><span class="p">(</span>
      <span class="p">{},</span>
      <span class="p">{</span>
        <span class="nx">sequelize</span><span class="p">,</span>
        <span class="nx">modelName</span>
      <span class="p">}</span>
    <span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">MyModel</span><span class="p">;</span>
</code></pre></div>
<p>About this approach: see <a href="#setting-a-custom-table-name">Setting a custom table name</a>.</p>

<h1 id="querying">Querying</h1>

<h2 id="create-instance-of-multiple-level-associated-model">Create instance of (multiple-level) associated model</h2>

<p><code>create{NestedModelName}</code> like so:</p>
<div class="highlight"><pre class="chroma"><code class="language-js" data-lang="js"><span class="k">const</span> <span class="nx">model</span> <span class="o">=</span> <span class="nx">MyModel</span><span class="p">.</span><span class="nx">findOne</span><span class="p">({</span>
  <span class="nx">where</span><span class="o">:</span> <span class="p">{</span> <span class="nx">id</span><span class="o">:</span> <span class="s1">&#39;my-id&#39;</span> <span class="p">}</span>
<span class="p">});</span>
<span class="kr">await</span> <span class="nx">model</span><span class="p">.</span><span class="nx">createNestedModel</span><span class="p">({</span> <span class="cm">/* some attributes */</span> <span class="p">});</span>

<span class="c1">// or
</span><span class="c1"></span>
<span class="k">const</span> <span class="nx">model</span> <span class="o">=</span> <span class="nx">MyModel</span><span class="p">.</span><span class="nx">findOne</span><span class="p">({</span>
  <span class="nx">where</span><span class="o">:</span> <span class="p">{</span> <span class="nx">id</span><span class="o">:</span> <span class="s1">&#39;my-id&#39;</span> <span class="p">},</span>
  <span class="c1">// This next line is quite important
</span><span class="c1"></span>  <span class="nx">models</span><span class="o">:</span> <span class="p">[</span> <span class="nx">models</span><span class="p">.</span><span class="nx">NestedModel</span> <span class="p">]</span>
<span class="p">});</span>
<span class="kr">await</span> <span class="nx">model</span><span class="p">.</span><span class="nx">nestedModel</span><span class="p">.</span><span class="nx">createDoublyNestedModel</span><span class="p">({</span> <span class="cm">/* some attributes */</span> <span class="p">});</span>

<span class="c1">// associations setup
</span><span class="c1"></span><span class="k">class</span> <span class="nx">DoublyNestedModel</span> <span class="k">extends</span> <span class="nx">Model</span> <span class="p">{</span>
  <span class="kr">static</span> <span class="nx">associate</span> <span class="p">(</span><span class="nx">models</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">nestedModel</span> <span class="o">=</span> <span class="nx">models</span><span class="p">.</span><span class="nx">DoublyNestedModel</span><span class="p">.</span><span class="nx">belongsTo</span><span class="p">(</span><span class="nx">models</span><span class="p">.</span><span class="nx">NestedModel</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="k">class</span> <span class="nx">NestedModel</span> <span class="k">extends</span> <span class="nx">Model</span> <span class="p">{</span>
  <span class="kr">static</span> <span class="nx">associate</span> <span class="p">(</span><span class="nx">models</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">myModel</span> <span class="o">=</span> <span class="nx">models</span><span class="p">.</span><span class="nx">NestedModel</span><span class="p">.</span><span class="nx">hasOne</span><span class="p">(</span><span class="nx">models</span><span class="p">.</span><span class="nx">MyModel</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">doublyNestedModel</span> <span class="o">=</span> <span class="nx">models</span><span class="p">.</span><span class="nx">NestedModel</span><span class="p">.</span><span class="nx">hasMany</span><span class="p">(</span><span class="nx">models</span><span class="p">.</span><span class="nx">DoubleNestedModel</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="k">class</span> <span class="nx">MyModel</span> <span class="k">extends</span> <span class="nx">Model</span> <span class="p">{</span>
  <span class="kr">static</span> <span class="nx">associate</span> <span class="p">(</span><span class="nx">models</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">nestedModel</span> <span class="o">=</span> <span class="nx">models</span><span class="p">.</span><span class="nx">MyModel</span><span class="p">.</span><span class="nx">belongsTo</span><span class="p">(</span><span class="nx">models</span><span class="p">.</span><span class="nx">NestedModel</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h2 id="order-by-multiple-level-nested-association-model-field">Order by (multiple-level) nested association model field</h2>

<p>Remember to fill out <code>attributes</code> and any further <code>include</code>s.</p>
<div class="highlight"><pre class="chroma"><code class="language-js" data-lang="js"><span class="k">class</span> <span class="nx">MyModel</span> <span class="k">extends</span> <span class="nx">Model</span> <span class="p">{</span>
  <span class="kr">static</span> <span class="nx">getNotificationsDesc</span><span class="p">(</span><span class="nx">where</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">getAssociation</span><span class="p">({</span>
       <span class="nx">where</span><span class="p">,</span>
       <span class="c1">// attributes: [],
</span><span class="c1"></span>       <span class="nx">order</span><span class="o">:</span> <span class="p">[</span> <span class="p">[</span> <span class="nx">models</span><span class="p">.</span><span class="nx">Relation</span><span class="p">,</span> <span class="nx">models</span><span class="p">.</span><span class="nx">NestedRelation</span><span class="p">,</span> <span class="s1">&#39;createdAt&#39;</span><span class="p">,</span> <span class="s1">&#39;DESC&#39;</span> <span class="p">]]</span>
       <span class="nx">include</span><span class="o">:</span> <span class="p">{</span>
         <span class="nx">model</span><span class="o">:</span> <span class="nx">models</span><span class="p">.</span><span class="nx">Relation</span><span class="p">,</span>
         <span class="c1">// attributes: [],
</span><span class="c1"></span>         <span class="nx">include</span><span class="o">:</span> <span class="p">{</span>
           <span class="nx">model</span><span class="o">:</span> <span class="nx">models</span><span class="p">.</span><span class="nx">NestedRelation</span><span class="p">,</span>
           <span class="c1">// attributes: [],
</span><span class="c1"></span>           <span class="c1">// include: {
</span><span class="c1"></span>           <span class="c1">//   model: models.TwoNestedRelation,
</span><span class="c1"></span>           <span class="c1">//   attributes: []
</span><span class="c1"></span>           <span class="c1">// }
</span><span class="c1"></span>         <span class="p">}</span>
       <span class="p">}</span>
    <span class="p">});</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h2 id="fetch-latest-of-association-by-field">Fetch latest of association by field</h2>

<p>The following gets the most recently created association (using <code>createdAt</code>).</p>

<p>To do something similar for most recently updated association would necessitate replacing <code>createdAt</code> with <code>updatedAt</code>.</p>

<p>This also assumes the model at hand has <code>createdAt</code> and <code>updatedAt</code> fields.</p>
<div class="highlight"><pre class="chroma"><code class="language-js" data-lang="js"><span class="k">class</span> <span class="nx">MyModel</span> <span class="k">extends</span> <span class="nx">Model</span> <span class="p">{</span>
  <span class="kr">async</span> <span class="nx">getLatestAssocationRecord</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">const</span> <span class="p">[</span> <span class="nx">firstRecord</span> <span class="p">]</span> <span class="o">=</span> <span class="kr">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">getAssociations</span><span class="p">({</span>
      <span class="nx">order</span><span class="o">:</span> <span class="p">[</span> <span class="p">[</span> <span class="s1">&#39;createdAt&#39;</span><span class="p">,</span> <span class="s1">&#39;DESC&#39;</span><span class="p">]</span> <span class="p">],</span>
      <span class="nx">limit</span><span class="o">:</span> <span class="mi">1</span>
    <span class="p">});</span>
    <span class="k">return</span> <span class="nx">firstRecord</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h2 id="fetch-one-of-association">Fetch one of association</h2>

<p>This approach should usually be complemented by an <code>order</code> clause, see <a href="#fetch-latest-of-association-by-field">Fetch latest of association by field</a></p>
<div class="highlight"><pre class="chroma"><code class="language-js" data-lang="js"><span class="k">class</span> <span class="nx">MyModel</span> <span class="k">extends</span> <span class="nx">Model</span> <span class="p">{</span>
  <span class="kr">async</span> <span class="nx">first</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">const</span> <span class="p">[</span> <span class="nx">firstRecord</span> <span class="p">]</span> <span class="o">=</span> <span class="kr">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">getAssociations</span><span class="p">({</span>
      <span class="c1">// order: [],
</span><span class="c1"></span>      <span class="nx">limit</span><span class="o">:</span> <span class="mi">1</span>
    <span class="p">});</span>
    <span class="k">return</span> <span class="nx">firstRecord</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h2 id="hydrate-an-association-load-without-eager-loading-it">Hydrate an association load without eager loading it</h2>
<div class="highlight"><pre class="chroma"><code class="language-js" data-lang="js"><span class="k">class</span> <span class="nx">MyModel</span> <span class="k">extends</span> <span class="nx">Model</span> <span class="p">{</span>
  <span class="kr">static</span> <span class="nx">associate</span> <span class="p">(</span><span class="nx">models</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">association</span> <span class="o">=</span> <span class="nx">models</span><span class="p">.</span><span class="nx">MyModel</span><span class="p">.</span><span class="nx">belongsTo</span><span class="p">(</span><span class="nx">models</span><span class="p">.</span><span class="nx">Association</span><span class="p">);</span>
    <span class="c1">// or
</span><span class="c1"></span>    <span class="k">this</span><span class="p">.</span><span class="nx">association</span> <span class="o">=</span> <span class="nx">models</span><span class="p">.</span><span class="nx">MyModel</span><span class="p">.</span><span class="nx">hasOne</span><span class="p">(</span><span class="nx">models</span><span class="p">.</span><span class="nx">Association</span><span class="p">);</span>
<span class="p">}</span>

<span class="nx">myModelInstance</span><span class="p">.</span><span class="nx">association</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">myModelInstance</span><span class="p">.</span><span class="nx">getAssociation</span><span class="p">();</span>
</code></pre></div>
<h2 id="hydrate-a-1-many-association-load-without-eager-loading">Hydrate a 1-many association load without eager loading</h2>
<div class="highlight"><pre class="chroma"><code class="language-js" data-lang="js"><span class="k">class</span> <span class="nx">MyModel</span> <span class="k">extends</span> <span class="nx">Model</span> <span class="p">{</span>
  <span class="kr">static</span> <span class="nx">associate</span> <span class="p">(</span><span class="nx">models</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">associations</span> <span class="o">=</span> <span class="nx">models</span><span class="p">.</span><span class="nx">MyModel</span><span class="p">.</span><span class="nx">hasMany</span><span class="p">(</span><span class="nx">models</span><span class="p">.</span><span class="nx">Association</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="nx">myModelInstance</span><span class="p">.</span><span class="nx">associations</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">myModelInstance</span><span class="p">.</span><span class="nx">getAssociations</span><span class="p">();</span>
</code></pre></div>
<h2 id="leveraging-transactions">Leveraging transactions</h2>

<p>Transactions are crucial to making sure your database doesn&rsquo;t end up in a weird state where part of an action has been done (eg. a user has been created) but other fields that are required for correct operation aren&rsquo;t (eg. <code>shooter</code> isn&rsquo;t set), here&rsquo;s how to write ES6 with transactions:</p>
<div class="highlight"><pre class="chroma"><code class="language-js" data-lang="js"><span class="nx">sequelize</span><span class="p">.</span><span class="nx">transaction</span><span class="p">(</span><span class="kr">async</span> <span class="nx">transaction</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="k">const</span> <span class="nx">user</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">User</span><span class="p">.</span><span class="nx">create</span><span class="p">({</span>
    <span class="nx">firstName</span><span class="o">:</span> <span class="s1">&#39;Abraham&#39;</span><span class="p">,</span>
    <span class="nx">lastName</span><span class="o">:</span> <span class="s1">&#39;Lincoln&#39;</span>
  <span class="p">},</span> <span class="p">{</span> <span class="nx">transaction</span> <span class="p">});</span>
  <span class="k">return</span> <span class="nx">user</span><span class="p">.</span><span class="nx">setShooter</span><span class="p">({</span>
    <span class="nx">firstName</span><span class="o">:</span> <span class="s1">&#39;John&#39;</span><span class="p">,</span>
    <span class="nx">lastName</span><span class="o">:</span> <span class="s1">&#39;Boothe&#39;</span>
  <span class="p">},</span> <span class="p">{</span> <span class="nx">transaction</span> <span class="p">});</span>
<span class="p">});</span>
</code></pre></div>
<h2 id="select-if-association-meets-a-criteria">Select if association meets a criteria</h2>

<p><code>required: true</code> is the key, if that wasn’t present, the instances could contain <code>{ association: null }</code>. For the full list of operators, see the <a href="http://docs.sequelizejs.com/manual/tutorial/querying.html#operators">Sequelize documentation for operators</a></p>
<div class="highlight"><pre class="chroma"><code class="language-js" data-lang="js"><span class="k">const</span> <span class="nx">someCriteria</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">data</span><span class="o">:</span> <span class="p">{</span>
        <span class="p">[</span><span class="nx">Op</span><span class="p">.</span><span class="nx">not</span><span class="p">]</span><span class="o">:</span> <span class="kc">null</span>
    <span class="p">}</span>
<span class="p">};</span>
<span class="k">const</span> <span class="nx">someOtherCriteria</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">id</span><span class="o">:</span> <span class="p">{</span>
        <span class="p">[</span><span class="nx">Op</span><span class="p">.</span><span class="nx">gt</span><span class="p">]</span><span class="o">:</span> <span class="mi">5</span>
    <span class="p">}</span>
<span class="p">};</span>

<span class="k">const</span> <span class="nx">myModels</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">db</span><span class="p">.</span><span class="nx">MyModel</span><span class="p">.</span><span class="nx">findAll</span><span class="p">({</span>
    <span class="nx">attributes</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;associationId&#39;</span> <span class="p">],</span>
    <span class="nx">include</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">association</span><span class="o">:</span> <span class="nx">db</span><span class="p">.</span><span class="nx">MyModel</span><span class="p">.</span><span class="nx">association</span><span class="p">,</span>
      <span class="nx">attributes</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">],</span>
      <span class="nx">required</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
      <span class="nx">include</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">association</span><span class="o">:</span> <span class="nx">db</span><span class="p">.</span><span class="nx">Association</span><span class="p">.</span><span class="nx">nestedAssociations</span><span class="p">,</span>
        <span class="nx">attributes</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span> <span class="p">],</span>
        <span class="nx">where</span><span class="o">:</span> <span class="p">{</span>
          <span class="p">[</span><span class="nx">Op</span><span class="p">.</span><span class="nx">and</span><span class="p">]</span><span class="o">:</span> <span class="p">[</span>
            <span class="nx">someCriteria</span><span class="p">,</span>
            <span class="nx">someOtherCriteria</span><span class="p">,</span>
          <span class="p">]</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">});</span>
</code></pre></div>
<h1 id="migrations-and-data-model">Migrations and data model</h1>

<h2 id="create-model-and-add-index">Create model and add index</h2>

<p>With a foreign key constraint set to <code>CASCADE</code>.</p>
<div class="highlight"><pre class="chroma"><code class="language-js" data-lang="js"><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
  <span class="kr">async</span> <span class="nx">up</span> <span class="p">(</span><span class="nx">sequelize</span><span class="p">,</span> <span class="nx">DataTypes</span><span class="p">)</span> <span class="p">{</span>
    <span class="kr">await</span> <span class="nx">sequelize</span><span class="p">.</span><span class="nx">createTable</span><span class="p">(</span><span class="s1">&#39;myModelPlural&#39;</span><span class="p">,</span> <span class="p">{</span>
      <span class="nx">id</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">allowNull</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
        <span class="nx">primaryKey</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
        
        <span class="nx">autoIncrement</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
        <span class="nx">type</span><span class="o">:</span> <span class="nx">DataTypes</span><span class="p">.</span><span class="nx">INTEGER</span>
        <span class="c1">// or 
</span><span class="c1"></span>        <span class="nx">type</span><span class="o">:</span> <span class="nx">DataTypes</span><span class="p">.</span><span class="nx">UUID</span><span class="p">,</span>
        <span class="nx">defaultValue</span><span class="o">:</span> <span class="nx">DataTypes</span><span class="p">.</span><span class="nx">UUIDV4</span>
      <span class="p">},</span>
      <span class="nx">relationId</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">allowNull</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
        <span class="nx">type</span><span class="o">:</span> <span class="nx">DataTypes</span><span class="p">.</span><span class="nx">INTEGER</span><span class="p">,</span>
        <span class="nx">references</span><span class="o">:</span> <span class="p">{</span>
          <span class="nx">model</span><span class="o">:</span> <span class="s1">&#39;relationPlural&#39;</span><span class="p">,</span>
          <span class="nx">key</span><span class="o">:</span> <span class="s1">&#39;id&#39;</span>
        <span class="p">},</span>
        <span class="nx">onDelete</span><span class="o">:</span> <span class="s1">&#39;CASCADE&#39;</span>
      <span class="p">},</span>
      <span class="nx">createdAt</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">allowNull</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
        <span class="nx">type</span><span class="o">:</span> <span class="nx">DataTypes</span><span class="p">.</span><span class="nx">DATE</span>
      <span class="p">},</span>
      <span class="nx">updatedAt</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">allowNull</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
        <span class="nx">type</span><span class="o">:</span> <span class="nx">DataTypes</span><span class="p">.</span><span class="nx">DATE</span>
      <span class="p">}</span>
    <span class="p">});</span>
    <span class="k">return</span> <span class="nx">sequelize</span><span class="p">.</span><span class="nx">addIndex</span><span class="p">(</span><span class="s1">&#39;myModelPlural&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;relationId&#39;</span><span class="p">]);</span>
  <span class="p">},</span>
  <span class="nx">down</span> <span class="p">(</span><span class="nx">sequelize</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">sequelize</span><span class="p">.</span><span class="nx">dropTable</span><span class="p">(</span><span class="s1">&#39;myModelPlural&#39;</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">};</span>
</code></pre></div>
<h2 id="add-column">Add column</h2>
<div class="highlight"><pre class="chroma"><code class="language-js" data-lang="js"><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">up</span> <span class="p">(</span><span class="nx">sequelize</span><span class="p">,</span> <span class="nx">DataTypes</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">sequelize</span><span class="p">.</span><span class="nx">addColumn</span><span class="p">(</span><span class="s1">&#39;myModelPlural&#39;</span><span class="p">,</span> <span class="s1">&#39;columnName&#39;</span><span class="p">,</span> <span class="p">{</span>
      <span class="nx">type</span><span class="o">:</span> <span class="nx">DataTypes</span><span class="p">.</span><span class="nx">STRING</span><span class="p">,</span>
      <span class="nx">allowNull</span><span class="o">:</span> <span class="kc">false</span>
    <span class="p">});</span>
  <span class="p">},</span>
  <span class="nx">down</span> <span class="p">(</span><span class="nx">sequelize</span><span class="p">,</span> <span class="nx">DataTypes</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">sequelize</span><span class="p">.</span><span class="nx">removeColumn</span><span class="p">(</span><span class="s1">&#39;myModelPlural&#39;</span><span class="p">,</span> <span class="s1">&#39;columnName&#39;</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">};</span>
</code></pre></div>
<h2 id="add-compound-unique-constraint">Add compound unique constraint</h2>

<p>A compound unique constraint is a constraint that an entity can&rsquo;t have the same value for all the fields in the constraint at the same time.</p>
<div class="highlight"><pre class="chroma"><code class="language-js" data-lang="js"><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">up</span> <span class="p">(</span><span class="nx">sequelize</span><span class="p">,</span> <span class="nx">DataTypes</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">sequelize</span><span class="p">.</span><span class="nx">addConstraint</span><span class="p">(</span><span class="s1">&#39;myModelPlural&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;relatedId&#39;</span><span class="p">,</span> <span class="s1">&#39;otherRelatedId&#39;</span><span class="p">],</span> <span class="p">{</span>
      <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;unique&#39;</span><span class="p">,</span>
      <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;my_model_plural_related_id_other_related_id_unique_constraint&#39;</span>
    <span class="p">});</span>
  <span class="p">},</span>
  <span class="nx">down</span> <span class="p">(</span><span class="nx">sequelize</span><span class="p">,</span> <span class="nx">DataTypes</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">sequelize</span><span class="p">.</span><span class="nx">removeConstraint</span><span class="p">(</span>
      <span class="s1">&#39;myModelPlural&#39;</span><span class="p">,</span>
      <span class="s1">&#39;my_model_plural_related_id_other_related_id_unique_constraint&#39;</span>
    <span class="p">);</span>
  <span class="p">}</span>
<span class="p">};</span>
</code></pre></div>
<h2 id="add-index-to-table">Add index to table</h2>
<div class="highlight"><pre class="chroma"><code class="language-js" data-lang="js"><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">up</span> <span class="p">(</span><span class="nx">sequelize</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">sequelize</span><span class="p">.</span><span class="nx">addIndex</span><span class="p">(</span><span class="s1">&#39;myModelPlural&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;relatedId&#39;</span><span class="p">],</span> <span class="cm">/* options */</span><span class="p">);</span>
  <span class="p">},</span>
  <span class="nx">down</span> <span class="p">(</span><span class="nx">sequelize</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">sequelize</span><span class="p">.</span><span class="nx">removeIndex</span><span class="p">(</span><span class="s1">&#39;myModelPlural&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;relatedId&#39;</span><span class="p">],</span> <span class="cm">/* options */</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">};</span>
</code></pre></div>
<h1 id="cli">CLI</h1>

<p>For the following examples to make sense/work, install <a href="https://www.npmjs.com/package/@hugodf/sequelize-cli">my fork of the sequelize CLI</a> with:</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">npm i --save @hugodf/sequelize-cli</code></pre></div>
<blockquote>
<p>You can read about what extras are in the fork in <a href="https://codewithhugo.com/progress-and-roadblocks-a-journey-into-open-source/">&ldquo;Progress and roadblocks: a journey into open source&rdquo;</a></p>
</blockquote>

<h2 id="create-migration">Create migration</h2>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">npx sequelize migration:create --name my-migration-name</code></pre></div>
<ul>
<li><code>--name</code> is <strong>required</strong></li>
</ul>

<h2 id="create-model">Create model</h2>

<pre><code>npx sequelize model:create --name MyModel --attributes foo:string --class
</code></pre>

<ul>
<li><code>--name</code> and <code>--attributes</code> are <strong>required</strong></li>
<li><code>--class</code> will create ES6 class models instead of <code>sequelize.define()</code>-type ones</li>
</ul>

<h1 id="advanced-configuration">Advanced Configuration</h1>

<h2 id="custom-path-for-models-migrations-config">Custom path for models/migrations/config</h2>

<p><code>.sequelizerc</code>, for this to work, you need a <code>src</code> directory with <code>models</code> and <code>migrations</code> subdirectories, as well as a <code>config/database.js</code> file (see <a href="#set-up-connection-config-from-a-database-url-environment-variable">Set up connection config from a database URL environment variable</a>)</p>
<div class="highlight"><pre class="chroma"><code class="language-js" data-lang="js"><span class="k">const</span> <span class="nx">path</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;path&#39;</span><span class="p">);</span>
<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
  <span class="s1">&#39;config&#39;</span><span class="o">:</span> <span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="s1">&#39;config&#39;</span><span class="p">,</span> <span class="s1">&#39;database.js&#39;</span><span class="p">),</span>
  <span class="s1">&#39;models-path&#39;</span><span class="o">:</span> <span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="s1">&#39;src&#39;</span><span class="p">,</span> <span class="s1">&#39;models&#39;</span><span class="p">),</span>
  <span class="s1">&#39;migrations-path&#39;</span><span class="o">:</span> <span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="s1">&#39;src&#39;</span><span class="p">,</span> <span class="s1">&#39;migrations&#39;</span><span class="p">)</span>
<span class="p">};</span>
</code></pre></div>
<h2 id="set-up-connection-config-from-a-database-url-environment-variable">Set up connection config from a database URL environment variable</h2>

<p><code>config/database.js</code></p>
<div class="highlight"><pre class="chroma"><code class="language-js" data-lang="js"><span class="k">const</span> <span class="nx">url</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;url&#39;</span><span class="p">);</span>

<span class="kd">function</span> <span class="nx">extractSequelizeDatabaseConfigFromUrl</span> <span class="p">(</span><span class="nx">databaseUrl</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">databaseUrl</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">&#39;No DATABASE_URL environment variable is set&#39;</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">const</span> <span class="nx">parsedUrl</span> <span class="o">=</span> <span class="nx">url</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">databaseUrl</span><span class="p">);</span>
  <span class="k">const</span> <span class="p">[</span><span class="nx">username</span><span class="p">,</span> <span class="nx">password</span><span class="p">]</span> <span class="o">=</span> <span class="nx">parsedUrl</span><span class="p">.</span><span class="nx">auth</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">);</span>
  <span class="k">const</span> <span class="p">{</span> <span class="nx">hostname</span><span class="o">:</span> <span class="nx">host</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">parsedUrl</span><span class="p">;</span> <span class="c1">// hostname doesn&#39;t contain the port
</span><span class="c1"></span>  <span class="k">const</span> <span class="nx">database</span> <span class="o">=</span> <span class="nx">parsedUrl</span><span class="p">.</span><span class="nx">path</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\//g</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">);</span>
  <span class="k">const</span> <span class="nx">dialect</span> <span class="o">=</span> <span class="nx">parsedUrl</span><span class="p">.</span><span class="nx">protocol</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">);</span> <span class="c1">// this should be postgres
</span><span class="c1"></span>  <span class="k">return</span> <span class="p">{</span>
    <span class="nx">username</span><span class="p">,</span>
    <span class="nx">password</span><span class="p">,</span>
    <span class="nx">database</span><span class="p">,</span>
    <span class="nx">host</span><span class="p">,</span>
    <span class="nx">dialect</span>
  <span class="p">};</span>
<span class="p">}</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">extractSequelizeDatabaseConfigFromUrl</span><span class="p">(</span>
  <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">DATABASE_URL</span>
<span class="p">);</span>
</code></pre></div>
              </div>
            </section>
          </article>

          <a href="#TableOfContents" class="post-full__table-of-contents--mobile-link">Jump to table of contents</a>
        </div>
      </main>

      <footer class="site-footer outer">
  <div class="site-footer-content inner">
    <section class="copyright" style="line-height: 1.3em;">
      <a href="/">Code with Hugo</a>  <br>
      
    </section>
    <nav class="site-footer-nav">
        <a href="/">Latest Posts</a>
        
        <a href="https://twitter.com/hugo__df" target="_blank" rel="noopener">Twitter</a>
        <a href="https://github.com/HugoDF" target="_blank" rel="noopener">Github</a>
        
        <a href="https://medium.com/@hugo__df" target="_blank" rel="noopener">Medium</a>
    </nav>  
  </div>
</footer>

    </div>

    
<script type="text/javascript" src="//code.jquery.com/jquery-3.2.1.min.js"></script>
<script type="text/javascript" src="https://codewithhugo.com/js/jquery.fitvids.js"></script>




  <!-- Google Analytics -->
  <script>
    var _gaq=[['_setAccount','UA-60469708-1'],['_trackPageview']];
    (function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];
    g.src=('https:'==location.protocol?'//ssl':'//www')+'.google-analytics.com/ga.js';
    s.parentNode.insertBefore(g,s)}(document,'script'));
  </script>



<script async defer src="https://infra.codewithhugo.com/app.js"></script>
<noscript><img src="https://infra.codewithhugo.com/image.gif" alt=""></noscript>





    
      <script src="https://cdn.polyfill.io/v2/polyfill.min.js?features=es6"></script>
      <script type="text/javascript" src="https://checkoutpage.co/js/overlay.js"></script>
      <script>
        window.checkoutPageOverlay = (function (document) {
          const checkoutPageOverlayFrame = document.getElementById('cp-frame')
          const checkoutButton = document.querySelector('.cp-button')
          let wasOpened = false
          return {
            open: function () {
              checkoutPageOverlayFrame.onload = function() {
                if (!wasOpened) {
                  checkoutButton.click()
                  wasOpened = true
                }
              }
            }
          }
        })(document)
      </script>
      <script>
        (function (document, navigator, window) {
          const PAID_QUERY_PARAMS = JSON.parse("[{\"key\":\"veryrelational\"},{\"key\":\"mailing-list\"}]");


          const PAID_LOCALSTORAGE_KEY = "sequelize-cheatsheet";
          const PAID_LOCALSTORAGE_VALUE = "so relational";

          
          
          const crawlerPattern = "(Googlebot\/|Googlebot-Mobile|Googlebot-Image|Googlebot-News|Googlebot-Video|AdsBot-Google([^-]|$)|AdsBot-Google-Mobile|Feedfetcher-Google|Mediapartners-Google|Mediapartners \(Googlebot\)|APIs-Google|bingbot|Slurp|[wW]get|curl|LinkedInBot|Python-urllib|python-requests|libwww|httpunit|nutch|Go-http-client|phpcrawl|msnbot|jyxobot|FAST-WebCrawler|FAST Enterprise Crawler|BIGLOTRON|Teoma|convera|seekbot|Gigabot|Gigablast|exabot|ia_archiver|GingerCrawler|webmon |HTTrack|grub.org|UsineNouvelleCrawler|antibot|netresearchserver|speedy|fluffy|bibnum.bnf|findlink|msrbot|panscient|yacybot|AISearchBot|ips-agent|tagoobot|MJ12bot|woriobot|yanga|buzzbot|mlbot|YandexBot|yandex.com\/bots|purebot|Linguee Bot|CyberPatrol|voilabot|Baiduspider|citeseerxbot|spbot|twengabot|postrank|turnitinbot|scribdbot|page2rss|sitebot|linkdex|Adidxbot|blekkobot|ezooms|dotbot|Mail.RU_Bot|discobot|heritrix|findthatfile|europarchive.org|NerdByNature.Bot|sistrix crawler|Ahrefs(Bot|SiteAudit)|fuelbot|CrunchBot|centurybot9|IndeedBot|mappydata|woobot|ZoominfoBot|PrivacyAwareBot|Multiviewbot|SWIMGBot|Grobbot|eright|Apercite|semanticbot|Aboundex|domaincrawler|wbsearchbot|summify|CCBot|edisterbot|seznambot|ec2linkfinder|gslfbot|aiHitBot|intelium_bot|facebookexternalhit|Yeti|RetrevoPageAnalyzer|lb-spider|Sogou|lssbot|careerbot|wotbox|wocbot|ichiro|DuckDuckBot|lssrocketcrawler|drupact|webcompanycrawler|acoonbot|openindexspider|gnam gnam spider|web-archive-net.com.bot|backlinkcrawler|coccoc|integromedb|content crawler spider|toplistbot|it2media-domain-crawler|ip-web-crawler.com|siteexplorer.info|elisabot|proximic|changedetection|arabot|WeSEE:Search|niki-bot|CrystalSemanticsBot|rogerbot|360Spider|psbot|InterfaxScanBot|CC Metadata Scaper|g00g1e.net|GrapeshotCrawler|urlappendbot|brainobot|fr-crawler|binlar|SimpleCrawler|Twitterbot|cXensebot|smtbot|bnf.fr_bot|A6-Indexer|ADmantX|Facebot|OrangeBot\/|memorybot|AdvBot|MegaIndex|SemanticScholarBot|ltx71|nerdybot|xovibot|BUbiNG|Qwantify|archive.org_bot|Applebot|TweetmemeBot|crawler4j|findxbot|S[eE][mM]rushBot|yoozBot|lipperhey|Y!J|Domain Re-Animator Bot|AddThis|Screaming Frog SEO Spider|MetaURI|Scrapy|Livelap[bB]ot|OpenHoseBot|CapsuleChecker|collection@infegy.com|IstellaBot|DeuSu\/|betaBot|Cliqzbot\/|MojeekBot\/|netEstate NE Crawler|SafeSearch microdata crawler|Gluten Free Crawler\/|Sonic|Sysomos|Trove|deadlinkchecker|Slack-ImgProxy|Embedly|RankActiveLinkBot|iskanie|SafeDNSBot|SkypeUriPreview|Veoozbot|Slackbot|redditbot|datagnionbot|Google-Adwords-Instant|adbeat_bot|WhatsApp|contxbot|pinterest|electricmonk|GarlikCrawler|BingPreview\/|vebidoobot|FemtosearchBot|Yahoo Link Preview|MetaJobBot|DomainStatsBot|mindUpBot|Daum\/|Jugendschutzprogramm-Crawler|Xenu Link Sleuth|Pcore-HTTP|moatbot|KosmioBot|pingdom|PhantomJS|Gowikibot|PiplBot|Discordbot|TelegramBot|Jetslide|newsharecounts|James BOT|Barkrowler|TinEye|SocialRankIOBot|trendictionbot|Ocarinabot|epicbot|Primalbot|DuckDuckGo-Favicons-Bot|GnowitNewsbot|Leikibot|LinkArchiver|YaK\/|PaperLiBot|Digg Deeper|dcrawl|Snacktory|AndersPinkBot|Fyrebot|EveryoneSocialBot|Mediatoolkitbot|Luminator-robots|ExtLinksBot|SurveyBot|NING\/|okhttp|Nuzzel|omgili|PocketParser|YisouSpider|um-LN|ToutiaoSpider|MuckRack|Jamie's Spider|AHC\/|NetcraftSurveyAgent|Laserlikebot|Apache-HttpClient|AppEngine-Google|Jetty|Upflow|Thinklab|Traackr.com|Twurly|Mastodon|http_get|DnyzBot|botify|007ac9 Crawler|BehloolBot|BrandVerity|check_http|BDCbot|ZumBot|EZID|ICC-Crawler|ArchiveBot|^LCC |filterdb.iss.net\/crawler|BLP_bbot|BomboraBot|Buck\/|Companybook-Crawler|Genieo|magpie-crawler|MeltwaterNews|Moreover|newspaper\/|ScoutJet|(^| )sentry\/|StorygizeBot|UptimeRobot|OutclicksBot|seoscanners|Hatena|Google Web Preview|MauiBot|AlphaBot|SBL-BOT|IAS crawler|adscanner|Netvibes|acapbot|Baidu-YunGuanCe|bitlybot|blogmuraBot|Bot.AraTurka.com|bot-pge.chlooe.com|BoxcarBot|BTWebClient|ContextAd Bot|Digincore bot|Disqus|Feedly|Fetch\/|Fever|Flamingo_SearchEngine|FlipboardProxy|g2reader-bot|imrbot|K7MLWCBot|Kemvibot|Landau-Media-Spider|linkapediabot|vkShare|Siteimprove.com|BLEXBot\/|DareBoost|ZuperlistBot\/|Miniflux\/|Feedspot|Diffbot\/|SEOkicks|tracemyfile|Nimbostratus-Bot|zgrab|PR-CY.RU|AdsTxtCrawler|Datafeedwatch|Zabbix|TangibleeBot|google-xrawler|axios|Amazon CloudFront|Pulsepoint|CloudFlare-AlwaysOnline|Google-Structured-Data-Testing-Tool|WordupInfoSearch|WebDataStats|HttpUrlConnection|Seekport Crawler|ZoomBot|VelenPublicWebCrawler|MoodleBot|jpg-newsbot|outbrain|W3C_Validator|Validator\.nu|W3C-checklink|W3C-mobileOK|W3C_I18n-Checker|FeedValidator|W3C_CSS_Validator|W3C_Unicorn|Google-PhysicalWeb|Blackboard|ICBot\/|BazQux|Twingly|Rivva|Experibot)";
          const crawlerRegEx = new RegExp(crawlerPattern, 'i');

          const SITE_WRAPPER_SELECTOR = '.js-site-wrapper';
          const SITE_WRAPPER_NO_SCROLL_CLASS = 'js-site-wrapper--no-scroll';
          const BUY_OVERLAY_SELECTOR = '.js-buy-overlay';
          const BUY_OVERLAY_ACTIVE_CLASS = 'js-buy-overlay--active';

          $siteWrapper = document.querySelector(SITE_WRAPPER_SELECTOR);
          $buyOverlay = document.querySelector(BUY_OVERLAY_SELECTOR);

          const persist = {
            set: function(key, value) {
              return window.localStorage.setItem(key, value);
            },
            get: function(key) {
              return window.localStorage.getItem(key);
            }
          }

          function isCrawler(userAgent) {
            return crawlerRegEx.test(userAgent);
          }

          function getQueryObject(window) {
            return window.location.search
              .replace(/^\?/, "")
              .split('&')
              .map(function(keyValue) { return keyValue.split('='); })
              .reduce(function(acc, keyValue) {
                const k = keyValue[0];
                const v = keyValue[1];
                acc[k] = v;
                return acc;
              }, {});
          }

          function didBuy () {
            if (typeof navigator === "undefined" || typeof window === "undefined") {
              return true;
            }
            if (isCrawler(navigator.userAgent)) {
              return true;
            }
            if (persist.get(PAID_LOCALSTORAGE_KEY) === PAID_LOCALSTORAGE_VALUE) {
              return true;
            }
            const query = getQueryObject(window);
            const bought = PAID_QUERY_PARAMS.some(function (queryParams) {
              return Object.entries(queryParams).every(function(keyValue) {
                const key = keyValue[0];
                const value = keyValue[1];
                return query[key] === value;
              });
            });
            if (bought) {
              persist.set(PAID_LOCALSTORAGE_KEY, PAID_LOCALSTORAGE_VALUE);
            }
            return bought;
          }

          function init() {
            if(!didBuy()) {
              $siteWrapper.classList.add(SITE_WRAPPER_NO_SCROLL_CLASS);
              $buyOverlay.classList.add(BUY_OVERLAY_ACTIVE_CLASS);
              checkoutPageOverlay.open()
            } else {
              window.history.replaceState({}, document.title, window.location.pathname);
            }
          }
          init();
        }) (document, navigator, window);
      </script>
    
  </body>

  </html>
