<!DOCTYPE html>
<html lang="en-US" />
<head>
    <meta http-equiv="Content-Type" content="text/html" charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="google-site-verification" content="gBfbdXRLofaOyHsbgiSiuCIHKPaviGMRVWh_qOfDHNE" />

    <title>Testing an Express app with SuperTest, moxios and Jest &middot; Code with Hugo</title>

    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="shortcut icon" href="https://codewithhugo.com/favicon.ico" />
    <meta name="theme-color" content="#090a0b">
    
    <link rel="canonical" href="https://codewithhugo.com/testing-an-express-app-with-supertest-moxios-and-jest/" /> 

     <meta name="description" content="Testing is a crucial part of the software development process. It helps to catch bugs, avoid regressions and to document the behaviour of a piece of software.
E" /> 

     
    
    <meta name="twitter:card" content="summary_large_image"/>
    <meta name="twitter:image" content="https://codewithhugo.com/img/bekir-donmez-unsplash.jpg"/>
    
 
    <meta name="twitter:title" content="Testing an Express app with SuperTest, moxios and Jest"/>
    <meta name="twitter:description" content="Testing is a crucial part of the software development process. It helps to catch bugs, avoid regressions and to document the behaviour of a piece of software.
E"/>
    <meta name="twitter:url" content="https://codewithhugo.com/testing-an-express-app-with-supertest-moxios-and-jest/" />
    <meta name="twitter:site" content="@hugo__df"/>

    <meta property="og:site_name" content="Code with Hugo" />
    <meta property="og:title" content="Testing an Express app with SuperTest, moxios and Jest &middot; Code with Hugo" />
    <meta property="og:url" content="https://codewithhugo.com/testing-an-express-app-with-supertest-moxios-and-jest/" />
    

    <meta property="og:type" content="article" />
    <meta property="og:description" content="Testing is a crucial part of the software development process. It helps to catch bugs, avoid regressions and to document the behaviour of a piece of software.
E" />

    <meta property="article:published_time" content="2018-06-27T00:00:00Z" />
    <meta property="article:tag" content="JavaScript" /><meta property="article:tag" content="Node" /><meta property="article:tag" content="Testing" />

    <meta property="og:image" content="https://codewithhugo.com/img/bekir-donmez-unsplash.jpg"/>


    <meta name="generator" content="Hugo 0.46" />

    <!-- Stylesheets -->
    <link rel="stylesheet" type="text/css" href="https://codewithhugo.com/built/screen.css" />
    <link rel="stylesheet" type="text/css" href="https://codewithhugo.com/css/casper-two.css" />
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css" />
    
      
      <link rel="stylesheet" href="https://codewithhugo.com/overrides.min.bd35cf74c58c56c4aa8eff40730357744dec20ff31d8bae7b0618dbe30e0dbe4.css">
    
      
      <link rel="stylesheet" href="https://codewithhugo.com/syntax.min.e1646a3f88f77e1b5e7d0253633b1958013aa132890dfe4d7e15dc4718d4aecc.css">
    

    

     
</head>


<body class="post-template">
  <div class="site-wrapper"> 

<header class="site-header outer">
  <div class="inner">
    <nav class="site-nav">
      <div class="site-nav-left">

        <ul class="nav" role="menu">
        
        
        
            <li class="" role="menuitem">
              <a href="/">Home</a>
            </li>
        
            <li class="" role="menuitem">
              <a href="/tags/javascript/">JavaScript</a>
            </li>
        
            <li class="" role="menuitem">
              <a href="/tags/node/">Node</a>
            </li>
        
            <li class="" role="menuitem">
              <a href="/tags/css/">CSS</a>
            </li>
        
            <li class="" role="menuitem">
              <a href="/tags/tip/">tips</a>
            </li>
        
      </ul></div>

      <div class="site-nav-right">
        <div class="social-links">
                    

                    <a class="social-link social-link-tw" href="https://twitter.com/hugo__df" target="_blank" rel="noopener"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M30.063 7.313c-.813 1.125-1.75 2.125-2.875 2.938v.75c0 1.563-.188 3.125-.688 4.625a15.088 15.088 0 0 1-2.063 4.438c-.875 1.438-2 2.688-3.25 3.813a15.015 15.015 0 0 1-4.625 2.563c-1.813.688-3.75 1-5.75 1-3.25 0-6.188-.875-8.875-2.625.438.063.875.125 1.375.125 2.688 0 5.063-.875 7.188-2.5-1.25 0-2.375-.375-3.375-1.125s-1.688-1.688-2.063-2.875c.438.063.813.125 1.125.125.5 0 1-.063 1.5-.25-1.313-.25-2.438-.938-3.313-1.938a5.673 5.673 0 0 1-1.313-3.688v-.063c.813.438 1.688.688 2.625.688a5.228 5.228 0 0 1-1.875-2c-.5-.875-.688-1.813-.688-2.75 0-1.063.25-2.063.75-2.938 1.438 1.75 3.188 3.188 5.25 4.25s4.313 1.688 6.688 1.813a5.579 5.579 0 0 1 1.5-5.438c1.125-1.125 2.5-1.688 4.125-1.688s3.063.625 4.188 1.813a11.48 11.48 0 0 0 3.688-1.375c-.438 1.375-1.313 2.438-2.563 3.188 1.125-.125 2.188-.438 3.313-.875z"/></svg></a>

                    <a class="social-link" href="https://github.com/HugoDF" target="_blank" rel="noopener"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a>

                    

                    <a class="social-link" href="https://medium.com/@hugo__df" target="_blank" rel="noopener"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 195 195"><path d="M46.5340803,65.2157554 C46.6968378,63.6076572 46.0836,62.018231 44.8828198,60.93592 L32.6512605,46.2010582 L32.6512605,44 L70.6302521,44 L99.9859944,108.380952 L125.794585,44 L162,44 L162,46.2010582 L151.542017,56.2281011 C150.640424,56.9153477 150.193188,58.0448862 150.380019,59.1628454 L150.380019,132.837155 C150.193188,133.955114 150.640424,135.084652 151.542017,135.771899 L161.755369,145.798942 L161.755369,148 L110.38282,148 L110.38282,145.798942 L120.963119,135.527337 C122.002801,134.487948 122.002801,134.182246 122.002801,132.592593 L122.002801,73.0417402 L92.585901,147.755438 L88.6106443,147.755438 L54.3622782,73.0417402 L54.3622782,123.115814 C54.0767278,125.221069 54.7759199,127.3406 56.2581699,128.863022 L70.0186741,145.55438 L70.0186741,147.755438 L31,147.755438 L31,145.55438 L44.7605042,128.863022 C46.2319621,127.338076 46.8903838,125.204485 46.5340803,123.115814 L46.5340803,65.2157554 Z"/></svg></a>
        </div>  
        
        <a class="subscribe-button" href="https://codewithhugo.com/index.xml">Subscribe</a>
            
      </div>

    </nav>  

  </div>
</header>

<main id="site-main" class="site-main outer" role="main">
  <div class="inner">
    
      <article class="post-full post">
    <header class="post-full-header">
        <section class="post-full-meta">
            <time class="post-full-meta-date" datetime="2018-06-27">27 June 2018</time>
                <span class="date-divider">/</span> <a href="https://codewithhugo.com/tags/javascript/">#JavaScript</a>&nbsp;<a href="https://codewithhugo.com/tags/node/">#Node</a>&nbsp;
        </section>
        <h1 class="post-full-title">Testing an Express app with SuperTest, moxios and Jest</h1>
    </header>
    <div class="hero-container">

      
      <figure class="post-full-image" style="background-image: url(https://codewithhugo.com/img/bekir-donmez-unsplash.jpg)">
        

      </figure>
    </div>

    <section class="post-full-content">
        <div class="kg-card-markdown">
        

<p>Testing is a crucial part of the software development process.
It helps to catch bugs, avoid regressions and to document the behaviour of a piece of software.</p>

<p>Express is one of the most widespread libraries for building backend applications in JavaScript.
What follows is a summary of how to set up an efficient unit testing strategy for such an application as well as
a couple of situations you may be faced with when attempting to test.</p>

<p>Full code example can be found at <a href="https://github.com/HugoDF/express-supertest-moxios">https://github.com/HugoDF/express-supertest-moxios</a>.</p>

<ul>
<li><a href="#a-simple-express-app">A simple Express app 🎁</a>

<ul>
<li><a href="#testing-strategy">Testing strategy 🕵️‍</a></li>
</ul></li>
<li><a href="#testing-a-less-simple-express-app">Testing a less simple Express app 📚</a>

<ul>
<li><a href="#testing-strategy">Testing strategy 🛠</a></li>
<li><a href="#where-redis-gets-mocked">Where Redis gets mocked 🤡</a></li>
</ul></li>
<li><a href="#parting-thoughts">Parting thoughts 🦋</a></li>
</ul>

<p>This was sent out on the <a href="https://buttondown.email/hugo">Code with Hugo newsletter</a> on Monday.
<a href="https://buttondown.email/hugo">Subscribe</a> to get the latest posts right in your inbox (before anyone else).</p>

<h1 id="a-simple-express-app">A simple Express app 🎁</h1>

<p>Say we have an Express set of route handlers like the following:</p>

<p><code>hugo.js</code>:</p>
<div class="highlight"><pre class="chroma"><code class="language-js" data-lang="js"><span class="k">const</span> <span class="p">{</span><span class="nx">Router</span><span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;express&#39;</span><span class="p">);</span>
<span class="k">const</span> <span class="nx">axios</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;axios&#39;</span><span class="p">);</span>
<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">(</span><span class="nx">router</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Router</span><span class="p">())</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="nx">router</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/hugo&#39;</span><span class="p">,</span> <span class="kr">async</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="k">const</span> <span class="p">{</span> <span class="nx">data</span><span class="o">:</span> <span class="nx">userData</span> <span class="p">}</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">axios</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span>
      <span class="s1">&#39;https://api.github.com/users/HugoDF&#39;</span>
    <span class="p">);</span>
    <span class="k">const</span> <span class="p">{</span>
      <span class="nx">blog</span><span class="p">,</span>
      <span class="nx">location</span><span class="p">,</span>
      <span class="nx">bio</span><span class="p">,</span>
      <span class="nx">public_repos</span><span class="p">,</span>
    <span class="p">}</span> <span class="o">=</span> <span class="nx">userData</span>
    <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">({</span>
      <span class="nx">blog</span><span class="p">,</span>
      <span class="nx">location</span><span class="p">,</span>
      <span class="nx">bio</span><span class="p">,</span>
      <span class="nx">publicRepos</span><span class="o">:</span> <span class="nx">public_repos</span><span class="p">,</span>
    <span class="p">});</span>
  <span class="p">});</span>
  <span class="k">return</span> <span class="nx">router</span><span class="p">;</span>
<span class="p">};</span>
</code></pre></div>
<p>This would be consumed in a main <code>server.js</code> like so:</p>
<div class="highlight"><pre class="chroma"><code class="language-js" data-lang="js"><span class="k">const</span> <span class="nx">express</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;express&#39;</span><span class="p">);</span>
<span class="k">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">express</span><span class="p">();</span>
<span class="k">const</span> <span class="nx">hugo</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./hugo&#39;</span><span class="p">);</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">hugo</span><span class="p">());</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="mi">3000</span><span class="p">,</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`Server listening on port 3000`</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div>
<p>For this to run, the following dependencies are required:</p>
<div class="highlight"><pre class="chroma"><code class="language-js" data-lang="js"><span class="nx">npm</span> <span class="nx">i</span> <span class="o">--</span><span class="nx">save</span> <span class="nx">express</span> <span class="nx">axios</span>
</code></pre></div>
<p>And it can be run using:</p>
<div class="highlight"><pre class="chroma"><code class="language-js" data-lang="js"><span class="nx">node</span> <span class="nx">server</span><span class="p">.</span><span class="nx">js</span>
</code></pre></div>
<p>Hitting <code>/hugo</code> will return some JSON data pulled from my GitHub profile:</p>

<pre><code>curl http://localhost:3000/hugo
{&quot;blog&quot;:&quot;https://codewithhugo.com&quot;,&quot;location&quot;:&quot;London&quot;,&quot;bio&quot;:&quot;Developer, JavaScript.&quot;,&quot;publicRepos&quot;:39}
</code></pre>

<h2 id="testing-strategy">Testing strategy 🕵️‍</h2>

<p>Testing is about defining some inputs and asserting on the outputs.</p>

<p>Now if we skip the chat about what a unit of test is, what we really care about with this API is that
when we hit <code>/hugo</code> we get the right response, using <code>jest</code> here&rsquo;s what a test suite might look like:</p>

<p><code>hugo.test.js</code></p>
<div class="highlight"><pre class="chroma"><code class="language-js" data-lang="js"><span class="k">const</span> <span class="nx">hugo</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./hugo&#39;</span><span class="p">);</span>
<span class="k">const</span> <span class="nx">express</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;express&#39;</span><span class="p">);</span>
<span class="k">const</span> <span class="nx">moxios</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;moxios&#39;</span><span class="p">);</span>
<span class="k">const</span> <span class="nx">request</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;supertest&#39;</span><span class="p">);</span>

<span class="k">const</span> <span class="nx">initHugo</span> <span class="o">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="k">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">express</span><span class="p">();</span>
  <span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">hugo</span><span class="p">());</span>
  <span class="k">return</span> <span class="nx">app</span><span class="p">;</span>
<span class="p">}</span>

<span class="nx">describe</span><span class="p">(</span><span class="s1">&#39;GET /hugo&#39;</span><span class="p">,</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="nx">beforeEach</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="nx">moxios</span><span class="p">.</span><span class="nx">install</span><span class="p">();</span>
  <span class="p">});</span>
  <span class="nx">afterEach</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="nx">moxios</span><span class="p">.</span><span class="nx">uninstall</span><span class="p">();</span>
  <span class="p">});</span>
  <span class="nx">test</span><span class="p">(</span><span class="s1">&#39;It should fetch HugoDF from GitHub&#39;</span><span class="p">,</span> <span class="kr">async</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="nx">moxios</span><span class="p">.</span><span class="nx">stubRequest</span><span class="p">(</span><span class="sr">/api.github.com\/users/</span><span class="p">,</span> <span class="p">{</span>
      <span class="nx">status</span><span class="o">:</span> <span class="mi">200</span><span class="p">,</span>
      <span class="nx">response</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">blog</span><span class="o">:</span> <span class="s1">&#39;https://codewithhugo.com&#39;</span><span class="p">,</span>
        <span class="nx">location</span><span class="o">:</span> <span class="s1">&#39;London&#39;</span><span class="p">,</span>
        <span class="nx">bio</span><span class="o">:</span> <span class="s1">&#39;Developer, JavaScript&#39;</span><span class="p">,</span>
        <span class="nx">public_repos</span><span class="o">:</span> <span class="mi">39</span><span class="p">,</span>
      <span class="p">}</span>
    <span class="p">});</span>
    <span class="k">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">initHugo</span><span class="p">();</span>
    <span class="kr">await</span> <span class="nx">request</span><span class="p">(</span><span class="nx">app</span><span class="p">).</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/hugo&#39;</span><span class="p">);</span>
    <span class="nx">expect</span><span class="p">(</span><span class="nx">moxios</span><span class="p">.</span><span class="nx">requests</span><span class="p">.</span><span class="nx">mostRecent</span><span class="p">().</span><span class="nx">url</span><span class="p">).</span><span class="nx">toBe</span><span class="p">(</span><span class="s1">&#39;https://api.github.com/users/HugoDF&#39;</span><span class="p">);</span>
  <span class="p">});</span>
  <span class="nx">test</span><span class="p">(</span><span class="s1">&#39;It should 200 and return a transformed version of GitHub response&#39;</span><span class="p">,</span> <span class="kr">async</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="nx">moxios</span><span class="p">.</span><span class="nx">stubRequest</span><span class="p">(</span><span class="sr">/api.github.com\/users/</span><span class="p">,</span> <span class="p">{</span>
      <span class="nx">status</span><span class="o">:</span> <span class="mi">200</span><span class="p">,</span>
      <span class="nx">response</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">blog</span><span class="o">:</span> <span class="s1">&#39;https://codewithhugo.com&#39;</span><span class="p">,</span>
        <span class="nx">location</span><span class="o">:</span> <span class="s1">&#39;London&#39;</span><span class="p">,</span>
        <span class="nx">bio</span><span class="o">:</span> <span class="s1">&#39;Developer, JavaScript&#39;</span><span class="p">,</span>
        <span class="nx">public_repos</span><span class="o">:</span> <span class="mi">39</span><span class="p">,</span>
      <span class="p">}</span>
    <span class="p">});</span>
    <span class="k">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">initHugo</span><span class="p">();</span>
    <span class="k">const</span> <span class="nx">res</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">request</span><span class="p">(</span><span class="nx">app</span><span class="p">).</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/hugo&#39;</span><span class="p">);</span>
    <span class="nx">expect</span><span class="p">(</span><span class="nx">res</span><span class="p">.</span><span class="nx">body</span><span class="p">).</span><span class="nx">toEqual</span><span class="p">({</span>
      <span class="nx">blog</span><span class="o">:</span> <span class="s1">&#39;https://codewithhugo.com&#39;</span><span class="p">,</span>
        <span class="nx">location</span><span class="o">:</span> <span class="s1">&#39;London&#39;</span><span class="p">,</span>
        <span class="nx">bio</span><span class="o">:</span> <span class="s1">&#39;Developer, JavaScript&#39;</span><span class="p">,</span>
        <span class="nx">publicRepos</span><span class="o">:</span> <span class="mi">39</span><span class="p">,</span>
    <span class="p">});</span>
  <span class="p">});</span>
<span class="p">});</span>
</code></pre></div>
<p>To run the above, first of all, add the required dependencies:</p>

<pre><code>npm install --save-dev jest moxios supertest
</code></pre>

<p>Run tests with:</p>

<pre><code>npx jest
</code></pre>

<p>We&rsquo;re leveraging <a href="https://github.com/visionmedia/supertest">SuperTest</a> and passing the express app to it.
SuperTest&rsquo;s fetch-like API is familiar and is <code>await</code>-able.</p>

<p><a href="https://github.com/axios/moxios">moxios</a> is a package to &ldquo;mock axios requests for testing&rdquo;.
We&rsquo;re able to run our unit tests in watch mode without flooding the upstream REST API.
<code>moxios</code> needs to be installed and uninstalled, we do this before and after each test respectively.
This is to avoid an edge case where one failing test can make others fail due to moxios isn&rsquo;t torn down and re-set up properly if
the error occurs before <code>moxios.uninstall</code> is called.</p>

<p>The <code>stubRequest</code> method should be passed 2 parameters:</p>

<ul>
<li>The first is what is going to be intercepted, this can be a string (which will need to be a full URL),
or a Regular Expression.</li>
<li>The second parameter is a response config object, the main keys we use are <code>status</code> and <code>response</code>.
Status will be the status in the <code>axios</code> fetch response and <code>response</code> will be the <code>data</code> in the <code>axios</code> fetch response.</li>
</ul>

<h1 id="testing-a-less-simple-express-app">Testing a less simple Express app 📚</h1>

<p>Let&rsquo;s say we have an app that&rsquo;s a blob store, backed by Redis (a simple key-value store amongst other things):</p>

<p><code>blob-store.js</code>:</p>
<div class="highlight"><pre class="chroma"><code class="language-js" data-lang="js"><span class="k">const</span> <span class="p">{</span><span class="nx">Router</span><span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;router&#39;</span><span class="p">);</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">(</span><span class="nx">redisClient</span><span class="p">,</span> <span class="nx">router</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Router</span><span class="p">())</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="nx">router</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/store/:key&#39;</span><span class="p">,</span> <span class="kr">async</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="k">const</span> <span class="p">{</span> <span class="nx">key</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">;</span>
    <span class="k">const</span> <span class="nx">value</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">query</span><span class="p">;</span>
    <span class="kr">await</span> <span class="nx">redisClient</span><span class="p">.</span><span class="nx">setAsync</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">value</span><span class="p">));</span>
    <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="s1">&#39;Success&#39;</span><span class="p">);</span>
  <span class="p">});</span>
  <span class="nx">router</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/:key&#39;</span><span class="p">,</span> <span class="kr">async</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="k">const</span> <span class="p">{</span> <span class="nx">key</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">;</span>
    <span class="k">const</span> <span class="nx">rawData</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">redisClient</span><span class="p">.</span><span class="nx">getAsync</span><span class="p">(</span><span class="nx">key</span><span class="p">);</span>
    <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">(</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">rawData</span><span class="p">));</span>
  <span class="p">});</span>
  <span class="k">return</span> <span class="nx">router</span><span class="p">;</span>
<span class="p">};</span>
</code></pre></div>
<p><code>server.js</code>:</p>
<div class="highlight"><pre class="chroma"><code class="language-js" data-lang="js"><span class="k">const</span> <span class="nx">express</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;express&#39;</span><span class="p">);</span>
<span class="k">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">express</span><span class="p">();</span>

<span class="c1">// For the sake of simplicity, 
</span><span class="c1">// redisClient isn&#39;t in another module
</span><span class="c1"></span><span class="k">const</span> <span class="nx">redis</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;redis&#39;</span><span class="p">);</span>
<span class="k">const</span> <span class="p">{</span><span class="nx">promisify</span><span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;util&#39;</span><span class="p">);</span>
<span class="k">const</span> <span class="nx">client</span> <span class="o">=</span> <span class="nx">redis</span><span class="p">.</span><span class="nx">createClient</span><span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">REDIS_URL</span><span class="p">);</span>

<span class="k">const</span> <span class="nx">redisClient</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">getAsync</span><span class="o">:</span> <span class="nx">promisify</span><span class="p">(</span><span class="nx">client</span><span class="p">.</span><span class="nx">get</span><span class="p">).</span><span class="nx">bind</span><span class="p">(</span><span class="nx">client</span><span class="p">),</span>
  <span class="nx">setAsync</span><span class="o">:</span> <span class="nx">promisify</span><span class="p">(</span><span class="nx">client</span><span class="p">.</span><span class="nx">set</span><span class="p">).</span><span class="nx">bind</span><span class="p">(</span><span class="nx">client</span><span class="p">)</span>
<span class="p">};</span>

<span class="k">const</span> <span class="nx">hugo</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./hugo&#39;</span><span class="p">);</span>
<span class="k">const</span> <span class="nx">blobStore</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./blob-store&#39;</span><span class="p">);</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">hugo</span><span class="p">());</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">blobStore</span><span class="p">(</span><span class="nx">redisClient</span><span class="p">));</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="mi">3000</span><span class="p">,</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`Server listening on port 3000`</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div>
<p>For a walkthrough of the example of the above, see <a href="/setting-up-express-and-redis-with-docker-compose#creating-a-blob-store">Setting up Express and Redis with Docker compose</a>.</p>

<p>To get it up and running:</p>

<ul>
<li>clone <a href="https://github.com/HugoDF/express-supertest-moxios">https://github.com/HugoDF/express-supertest-moxios</a></li>
<li>have <a href="https://www.docker.com/community-edition">Docker Community Edition</a> running</li>
<li>run <code>docker-compose up</code></li>
</ul>

<p>Once the app is running, we can do the following:</p>

<ol>
<li>Store some data:
<code>
curl http://localhost:3000/store/my-key\?some\=value\&amp;some-other\=other-value
Success
</code></li>
<li>Retrieve that data:
<code>
curl http://localhost:3000/my-key
{
&quot;some&quot;: &quot;value&quot;,
&quot;some-other&quot;: &quot;other-value&quot;
}
</code></li>
</ol>

<h2 id="testing-strategy-1">Testing strategy 🛠</h2>

<p>We have a decision to make here:</p>

<ol>
<li>Mock Redis</li>
<li>Don&rsquo;t mock Redis</li>
</ol>

<p>To not mock Redis would mean running a full Redis instance and setting up some test data before each test suite.
This means you&rsquo;re relying on some sort of ordering of tests and you can&rsquo;t parallelise without running multiple Redis instances to avoid data issues.</p>

<p>For unit(ish) tests, that we want to be running the whole time we&rsquo;re developing, this is an issue.
The alternative is to mock Redis, specifically, <code>redisClient</code>.</p>

<h2 id="where-redis-gets-mocked">Where Redis gets mocked 🤡</h2>

<p><code>blob-store.test.js</code></p>
<div class="highlight"><pre class="chroma"><code class="language-js" data-lang="js"><span class="k">const</span> <span class="nx">blobStore</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./blob-store&#39;</span><span class="p">);</span>
<span class="k">const</span> <span class="nx">express</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;express&#39;</span><span class="p">);</span>
<span class="k">const</span> <span class="nx">moxios</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;moxios&#39;</span><span class="p">);</span>
<span class="k">const</span> <span class="nx">request</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;supertest&#39;</span><span class="p">);</span>

<span class="k">const</span> <span class="nx">initBlobStore</span> <span class="o">=</span> <span class="p">(</span>
  <span class="nx">mockRedisClient</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">getAsync</span><span class="o">:</span> <span class="nx">jest</span><span class="p">.</span><span class="nx">fn</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="nb">Promise</span><span class="p">.</span><span class="nx">resolve</span><span class="p">()),</span>
    <span class="nx">setAsync</span><span class="o">:</span> <span class="nx">jest</span><span class="p">.</span><span class="nx">fn</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="nb">Promise</span><span class="p">.</span><span class="nx">resolve</span><span class="p">())</span>
  <span class="p">}</span>
<span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="k">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">express</span><span class="p">();</span>
  <span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">blobStore</span><span class="p">(</span><span class="nx">mockRedisClient</span><span class="p">));</span>
  <span class="k">return</span> <span class="nx">app</span><span class="p">;</span>
<span class="p">}</span>

<span class="nx">describe</span><span class="p">(</span><span class="s1">&#39;GET /store/:key with params&#39;</span><span class="p">,</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="nx">test</span><span class="p">(</span><span class="s1">&#39;It should call redisClient.setAsync with key route parameter as key and stringified params as value&#39;</span><span class="p">,</span> <span class="kr">async</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="k">const</span> <span class="nx">mockRedisClient</span> <span class="o">=</span> <span class="p">{</span>
      <span class="nx">setAsync</span><span class="o">:</span> <span class="nx">jest</span><span class="p">.</span><span class="nx">fn</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="nb">Promise</span><span class="p">.</span><span class="nx">resolve</span><span class="p">())</span>
    <span class="p">};</span>
    <span class="k">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">initBlobStore</span><span class="p">(</span><span class="nx">mockRedisClient</span><span class="p">);</span>
    <span class="kr">await</span> <span class="nx">request</span><span class="p">(</span><span class="nx">app</span><span class="p">).</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/store/my-key?hello=world&amp;foo=bar&#39;</span><span class="p">);</span>
    <span class="nx">expect</span><span class="p">(</span><span class="nx">mockRedisClient</span><span class="p">.</span><span class="nx">setAsync</span><span class="p">).</span><span class="nx">toHaveBeenCalledWith</span><span class="p">(</span>
      <span class="s1">&#39;my-key&#39;</span><span class="p">,</span>
      <span class="s1">&#39;{\&#34;hello\&#34;:\&#34;world\&#34;,\&#34;foo\&#34;:\&#34;bar\&#34;}&#39;</span>
    <span class="p">);</span>
  <span class="p">});</span>
<span class="p">});</span>

<span class="nx">describe</span><span class="p">(</span><span class="s1">&#39;GET /:key&#39;</span><span class="p">,</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="nx">test</span><span class="p">(</span><span class="s1">&#39;It should call redisClient.getAsync with key route parameter as key&#39;</span><span class="p">,</span> <span class="kr">async</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="k">const</span> <span class="nx">mockRedisClient</span> <span class="o">=</span> <span class="p">{</span>
      <span class="nx">getAsync</span><span class="o">:</span> <span class="nx">jest</span><span class="p">.</span><span class="nx">fn</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="nb">Promise</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="s1">&#39;{}&#39;</span><span class="p">))</span>
    <span class="p">};</span>
    <span class="k">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">initBlobStore</span><span class="p">(</span><span class="nx">mockRedisClient</span><span class="p">);</span>
    <span class="kr">await</span> <span class="nx">request</span><span class="p">(</span><span class="nx">app</span><span class="p">).</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/my-key&#39;</span><span class="p">);</span>
    <span class="nx">expect</span><span class="p">(</span><span class="nx">mockRedisClient</span><span class="p">.</span><span class="nx">setAsync</span><span class="p">).</span><span class="nx">toHaveBeenCalledWith</span><span class="p">(</span>
      <span class="s1">&#39;my-key&#39;</span><span class="p">,</span>
    <span class="p">);</span>
  <span class="p">});</span>
  <span class="nx">test</span><span class="p">(</span><span class="s1">&#39;It should return output of redisClient.getAsync with key route parameter as key&#39;</span><span class="p">,</span> <span class="kr">async</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="k">const</span> <span class="nx">mockRedisClient</span> <span class="o">=</span> <span class="p">{</span>
      <span class="nx">getAsync</span><span class="o">:</span> <span class="nx">jest</span><span class="p">.</span><span class="nx">fn</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="nb">Promise</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="s1">&#39;{}&#39;</span><span class="p">))</span>
    <span class="p">};</span>
    <span class="k">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">initBlobStore</span><span class="p">(</span><span class="nx">mockRedisClient</span><span class="p">);</span>
    <span class="k">const</span> <span class="nx">response</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">request</span><span class="p">(</span><span class="nx">app</span><span class="p">).</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/my-key&#39;</span><span class="p">);</span>
    <span class="nx">expect</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">body</span><span class="p">).</span><span class="nx">toEqual</span><span class="p">({});</span>
  <span class="p">});</span>
<span class="p">});</span>
</code></pre></div>
<p>In short we set up our tests so we can pass an arbitrary <code>redisClient</code> object where we can mock the methods themselves.</p>

<h1 id="parting-thoughts">Parting thoughts 🦋</h1>

<p>Testing an Express app is all about finding the boundary at which the mocking starts and where it stops.</p>

<p>This is an excercise in API design, how to test things in as large a unit as it makes sense to (eg. the whole endpoint),
without having to carry around the baggage of a full database/persistence layer.</p>

<p>For example, another approach to the Redis client tests would have been to create a mock client that maintains the
state somehow (ie writes to an object internally), and to inject/inspect that state (before and after the code under test respectively).</p>

<p>For the full code example, see <a href="https://github.com/HugoDF/express-supertest-moxios">https://github.com/HugoDF/express-supertest-moxios</a>.</p>

<p>Cover photo <a href="https://unsplash.com/photos/eofm5R5f9Kw?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText">Bekir Dönmez</a> on <a href="https://unsplash.com/search/photos/clowns?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText">Unsplash</a></p>

        </div>
    </section>

    <section class="subscribe-form">
        <h3 class="subscribe-form-title">Subscribe to Code with Hugo</h3>
        <p>Get all the posts of the week before anyone else in your inbox</p>
        <form
            action="https://buttondown.email/api/emails/embed-subscribe/hugo"
            method="post"
            target="popupwindow"
            onsubmit="window.open('https://buttondown.email/hugo', 'popupwindow')"
        >
            <div class="form-group">
                <input class="subscribe-email" type="email" name="email" id="bd-email" placeholder="youremail@example.com">
                <input type="hidden" value="1" name="embed"/>
            </div>
            <button class="" value="Subscribe" type="submit"><span>Subscribe</span></button>
        </form>
    </section>

    <footer class="post-full-footer">
      <section class="author-card">
        <img class="author-profile-image" src="https://cdn-images-1.medium.com/fit/c/200/200/0*Rb-aDjpTtV1UZA4O.jpeg" alt="Author" />
        <section class="author-card-content">
            <h4 class="author-card-name"><a href="https://codewithhugo.com/">Hugo Di Francesco</a></h4>
                <p>A developer, working out of London writing CSS, JavaScript and Python.</p>
        </section>
      </section>
    </footer>
</article>




    
    
    

  </div>
</main>


<aside class="read-next outer">
  <div class="inner">
    <div class="read-next-feed">      
      
<article class="read-next-card" 
            style="background-image: url(https://codewithhugo.com/img/cover.jpg);" >
    <header class="read-next-card-header">
        <small class="read-next-card-header-sitetitle">&mdash; Code with Hugo &mdash;</small>
        
        <h3 class="read-next-card-header-title"><a href="https://codewithhugo.com/tags/javascript/">#JavaScript</a></h3>
    </header>
    <div class="read-next-divider"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 14.5s2 3 5 3 5.5-2.463 5.5-5.5S21 6.5 18 6.5c-5 0-7 11-12 11C2.962 17.5.5 15.037.5 12S3 6.5 6 6.5s4.5 3.5 4.5 3.5"/></svg>
    </div>

    <div class="read-next-card-content">
      
        <ul>
          <li><a href="https://codewithhugo.com/learn-git-even-if-you-dont-code/">Learn git even if you don’t code</a></li>            
        
          <li><a href="https://codewithhugo.com/closures-partial-application-and-currying-effective-functional-javascript/">Closures, Partial Application and Currying: Effective Functional JavaScript</a></li>            
        
          <li><a href="https://codewithhugo.com/a-gentle-introduction-to-graphql-api-integrations/">A gentle introduction to GraphQL API integrations</a></li>            
        
          <li><a href="https://codewithhugo.com/python-graphql-client-requests-example-using-gql/">Python GraphQL client requests example using gql</a></li>            
        </ul>
    </div>
    <footer class="read-next-card-footer">
      
        <a href="https://codewithhugo.com/tags/javascript/">See all related posts →</a>
    </footer>
</article>


      
      <article class="post-card post"> 
    
    <a class="post-card-image-link" href="https://codewithhugo.com/detecting-object-vs-array-in-javascript-by-example/">
      <div class="post-card-image" style="background-image: url(https://codewithhugo.com/img/20180704-array-types.jpg)"></div>
    </a>
    

    <div class="post-card-content">
      <a class="post-card-content-link" href="https://codewithhugo.com/detecting-object-vs-array-in-javascript-by-example/">
          <header class="post-card-header">
              <span class="post-card-tags">
              #JavaScript 
              #tip  </span>
              
              <h2 class="post-card-title">Detecting Object vs Array in JavaScript by example</h2>
          </header>
          <section class="post-card-excerpt">
              
                <p>Let’s say we want to measure the depth of we have an object with mixed nested arrays/objects like so:

 ...  </p>
              
          </section>
      </a>

      <footer class="post-card-meta">
          <img class="author-profile-image" src="https://cdn-images-1.medium.com/fit/c/200/200/0*Rb-aDjpTtV1UZA4O.jpeg" alt="Author" />
          <span class="post-card-author"><a href="/">Hugo Di Francesco</a></span>
      </footer>
    </div>
</article>
      
      
      <article class="post-card post"> 
    
    <a class="post-card-image-link" href="https://codewithhugo.com/how-to-make-beautiful-simple-cli-apps-with-node/">
      <div class="post-card-image" style="background-image: url(https://codewithhugo.com/img/cli-screenshot.jpeg)"></div>
    </a>
    

    <div class="post-card-content">
      <a class="post-card-content-link" href="https://codewithhugo.com/how-to-make-beautiful-simple-cli-apps-with-node/">
          <header class="post-card-header">
              <span class="post-card-tags">
              #JavaScript 
              #Node 
              #CLI  </span>
              
              <h2 class="post-card-title">How to make beautiful, simple CLI apps with Node</h2>
          </header>
          <section class="post-card-excerpt">
              
                <p>Channel your inner Sindre Sohrus and ship a beautifully simple CLI app using Node.
Command line apps are a neat way to package repetitive tasks. This will walk you through some tools that are useful to build CLI apps.
 The idea 💡 Piping to the command line 🚇 Dealing with sequential actions ✨ Executable JavaScript files 🦅 Adding package binaries 📦 Publishing to npm 🚀  The idea 💡 When merging/rebasing, the file that always seems to cause trouble is the package-lock. ...  </p>
              
          </section>
      </a>

      <footer class="post-card-meta">
          <img class="author-profile-image" src="https://cdn-images-1.medium.com/fit/c/200/200/0*Rb-aDjpTtV1UZA4O.jpeg" alt="Author" />
          <span class="post-card-author"><a href="/">Hugo Di Francesco</a></span>
      </footer>
    </div>
</article>
      
    </div>
  </div>
</aside>

<div class="floating-header">
  <div class="floating-header-logo">
    <a href="https://codewithhugo.com/">
      
      <span>Code with Hugo</span>
    </a>
  </div>
  <span class="floating-header-divider">&mdash;</span>
  <div class="floating-header-title">Testing an Express app with SuperTest, moxios and Jest</div>
  <div class="floating-header-share">
    <div class="floating-header-share-label">Share this <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
     <path d="M7.5 15.5V4a1.5 1.5 0 1 1 3 0v4.5h2a1 1 0 0 1 1 1h2a1 1 0 0 1 1 1H18a1.5 1.5 0 0 1 1.5 1.5v3.099c0 .929-.13 1.854-.385 2.748L17.5 23.5h-9c-1.5-2-5.417-8.673-5.417-8.673a1.2 1.2 0 0 1 1.76-1.605L7.5 15.5zm6-6v2m-3-3.5v3.5m6-1v2"/></svg>
    </div>

    
    <a class="floating-header-share-tw" href="https://twitter.com/share?text=%22Testing%20an%20Express%20app%20with%20SuperTest%2c%20moxios%20and%20Jest%22%20by%20%40hugo__df&amp;url=https%3a%2f%2fcodewithhugo.com%2ftesting-an-express-app-with-supertest-moxios-and-jest%2f&amp"
          onclick="window.open(this.href, 'share-twitter', 'width=550,height=235');return false;">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M30.063 7.313c-.813 1.125-1.75 2.125-2.875 2.938v.75c0 1.563-.188 3.125-.688 4.625a15.088 15.088 0 0 1-2.063 4.438c-.875 1.438-2 2.688-3.25 3.813a15.015 15.015 0 0 1-4.625 2.563c-1.813.688-3.75 1-5.75 1-3.25 0-6.188-.875-8.875-2.625.438.063.875.125 1.375.125 2.688 0 5.063-.875 7.188-2.5-1.25 0-2.375-.375-3.375-1.125s-1.688-1.688-2.063-2.875c.438.063.813.125 1.125.125.5 0 1-.063 1.5-.25-1.313-.25-2.438-.938-3.313-1.938a5.673 5.673 0 0 1-1.313-3.688v-.063c.813.438 1.688.688 2.625.688a5.228 5.228 0 0 1-1.875-2c-.5-.875-.688-1.813-.688-2.75 0-1.063.25-2.063.75-2.938 1.438 1.75 3.188 3.188 5.25 4.25s4.313 1.688 6.688 1.813a5.579 5.579 0 0 1 1.5-5.438c1.125-1.125 2.5-1.688 4.125-1.688s3.063.625 4.188 1.813a11.48 11.48 0 0 0 3.688-1.375c-.438 1.375-1.313 2.438-2.563 3.188 1.125-.125 2.188-.438 3.313-.875z"/></svg>
      </a>
      <a class="floating-header-share-fb" href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fcodewithhugo.com%2ftesting-an-express-app-with-supertest-moxios-and-jest%2f"
          onclick="window.open(this.href, 'share-facebook','width=580,height=296');return false;">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M19 6h5V0h-5c-3.86 0-7 3.14-7 7v3H8v6h4v16h6V16h5l1-6h-6V7c0-.542.458-1 1-1z"/></svg>
      </a>
  </div>

  <progress class="progress" value="0">
    <div class="progress-container">
      <span class="progress-bar"></span>
    </div>
  </progress>
</div>



<footer class="site-footer outer">
  <div class="site-footer-content inner">
    <section class="copyright" style="line-height: 1.3em;">
      <a href="/">Code with Hugo</a>  <br>
      
    </section>
    <nav class="site-footer-nav">
        <a href="/">Latest Posts</a>
        
        <a href="https://twitter.com/hugo__df" target="_blank" rel="noopener">Twitter</a>
        <a href="https://github.com/HugoDF" target="_blank" rel="noopener">Github</a>
        
        <a href="https://medium.com/@hugo__df" target="_blank" rel="noopener">Medium</a>
    </nav>  
  </div>
</footer>

</div>

<script type="text/javascript" src="//code.jquery.com/jquery-3.2.1.min.js"></script>
<script type="text/javascript" src="https://codewithhugo.com/js/jquery.fitvids.js"></script>




  <!-- Google Analytics -->
  <script>
    var _gaq=[['_setAccount','UA-60469708-1'],['_trackPageview']];
    (function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];
    g.src=('https:'==location.protocol?'//ssl':'//www')+'.google-analytics.com/ga.js';
    s.parentNode.insertBefore(g,s)}(document,'script'));
  </script>



<script async src="//cdn.simpleanalytics.io/hello.js"></script> 
<noscript><img src="//api.simpleanalytics.io/hello.gif" alt=""></noscript>

    <script>





$(document).ready(function () {
    
    var $postContent = $(".post-full-content");
    $postContent.fitVids();
    

    var progressBar = document.querySelector('progress');
    var header = document.querySelector('.floating-header');
    var title = document.querySelector('.post-full-title');

    var lastScrollY = window.scrollY;
    var lastWindowHeight = window.innerHeight;
    var lastDocumentHeight = $(document).height();
    var ticking = false;

    function onScroll() {
        lastScrollY = window.scrollY;
        requestTick();
    }

    function onResize() {
        lastWindowHeight = window.innerHeight;
        lastDocumentHeight = $(document).height();
        requestTick();
    }

    function requestTick() {
        if (!ticking) {
            requestAnimationFrame(update);
        }
        ticking = true;
    }

    function update() {
        var trigger = title.getBoundingClientRect().top + window.scrollY;
        var triggerOffset = title.offsetHeight + 35;
        var progressMax = lastDocumentHeight - lastWindowHeight;

        
        if (lastScrollY >= trigger + triggerOffset) {
            header.classList.add('floating-active');
        } else {
            header.classList.remove('floating-active');
        }

        progressBar.setAttribute('max', progressMax);
        progressBar.setAttribute('value', lastScrollY);

        ticking = false;
    }

    window.addEventListener('scroll', onScroll, {passive: true});
    window.addEventListener('resize', onResize, false);

    update();
});
</script>
</body></html>
