<!DOCTYPE html>
<html lang="en-US" />
<head>
    <meta http-equiv="Content-Type" content="text/html" charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="google-site-verification" content="gBfbdXRLofaOyHsbgiSiuCIHKPaviGMRVWh_qOfDHNE" />

    <title>From AngularJS to Vue.js, CommonJS and Jest &middot; Code with Hugo</title>

    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="apple-touch-icon" sizes="120x120" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#00aba9">
    <meta name="theme-color" content="#090a0b">

    <link rel="shortcut icon" href="https://codewithhugo.com/favicon.ico" />
    <meta name="theme-color" content="#090a0b">
    
    <link rel="canonical" href="https://codewithhugo.com/from-angularjs-to-vue.js-commonjs-and-jest/" /> 

     <meta name="description" content="The trials and tribulations of kicking off an AngularJS -&amp;gt; Vue.js migration
 AngularJS was pretty groundbreaking. It’s still impressive to this day, packed w" /> 

     
    
    <meta name="twitter:card" content="summary_large_image"/>
    <meta name="twitter:image" content="https://codewithhugo.com/img/justyn-warner-unsplash.jpg"/>
    
 
    <meta name="twitter:title" content="From AngularJS to Vue.js, CommonJS and Jest"/>
    <meta name="twitter:description" content="The trials and tribulations of kicking off an AngularJS -&amp;gt; Vue.js migration
 AngularJS was pretty groundbreaking. It’s still impressive to this day, packed w"/>
    <meta name="twitter:url" content="https://codewithhugo.com/from-angularjs-to-vue.js-commonjs-and-jest/" />
    <meta name="twitter:site" content="@hugo__df"/>

    <meta property="og:site_name" content="Code with Hugo" />
    <meta property="og:title" content="From AngularJS to Vue.js, CommonJS and Jest &middot; Code with Hugo" />
    <meta property="og:url" content="https://codewithhugo.com/from-angularjs-to-vue.js-commonjs-and-jest/" />
    

    <meta property="og:type" content="article" />
    <meta property="og:description" content="The trials and tribulations of kicking off an AngularJS -&amp;gt; Vue.js migration
 AngularJS was pretty groundbreaking. It’s still impressive to this day, packed w" />

    <meta property="article:published_time" content="2018-05-30T00:00:00Z" />
    <meta property="article:tag" content="VueJS" /><meta property="article:tag" content="testing" /><meta property="article:tag" content="JavaScript" />

    <meta property="og:image" content="https://codewithhugo.com/img/justyn-warner-unsplash.jpg"/>


    <meta name="generator" content="Hugo 0.46" />

    <!-- Stylesheets -->
    <link rel="stylesheet" type="text/css" href="https://codewithhugo.com/built/screen.css" />
    <link rel="stylesheet" type="text/css" href="https://codewithhugo.com/css/casper-two.css" />
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css" />
    
      
      <link rel="stylesheet" href="https://codewithhugo.com/overrides.min.bd35cf74c58c56c4aa8eff40730357744dec20ff31d8bae7b0618dbe30e0dbe4.css">
    
      
      <link rel="stylesheet" href="https://codewithhugo.com/syntax.min.e1646a3f88f77e1b5e7d0253633b1958013aa132890dfe4d7e15dc4718d4aecc.css">
    
      
      <link rel="stylesheet" href="https://codewithhugo.com/cta.min.2a90f41cf8cf23510a102e013116d80ad7ed31824b86f0862a21f69386ec9a51.css">
    

    

     
</head>


<body class="post-template">
  <div class="site-wrapper"> 

<header class="site-header outer">
  <div class="inner">
    <nav class="site-nav">
      <div class="site-nav-left">

        <ul class="nav" role="menu">
        
        
        
            <li class="" role="menuitem">
              <a href="/">Home</a>
            </li>
        
            <li class="" role="menuitem">
              <a href="/guides/">guides</a>
            </li>
        
            <li class="" role="menuitem">
              <a href="/tags/javascript/">JavaScript</a>
            </li>
        
            <li class="" role="menuitem">
              <a href="/tags/node/">Node</a>
            </li>
        
            <li class="" role="menuitem">
              <a href="/tags/css/">CSS</a>
            </li>
        
            <li class="" role="menuitem">
              <a href="/open/">#open</a>
            </li>
        
      </ul></div>

      <div class="site-nav-right">
        <div class="social-links">
                    

                    <a class="social-link social-link-tw" href="https://twitter.com/hugo__df" target="_blank" rel="noopener"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M30.063 7.313c-.813 1.125-1.75 2.125-2.875 2.938v.75c0 1.563-.188 3.125-.688 4.625a15.088 15.088 0 0 1-2.063 4.438c-.875 1.438-2 2.688-3.25 3.813a15.015 15.015 0 0 1-4.625 2.563c-1.813.688-3.75 1-5.75 1-3.25 0-6.188-.875-8.875-2.625.438.063.875.125 1.375.125 2.688 0 5.063-.875 7.188-2.5-1.25 0-2.375-.375-3.375-1.125s-1.688-1.688-2.063-2.875c.438.063.813.125 1.125.125.5 0 1-.063 1.5-.25-1.313-.25-2.438-.938-3.313-1.938a5.673 5.673 0 0 1-1.313-3.688v-.063c.813.438 1.688.688 2.625.688a5.228 5.228 0 0 1-1.875-2c-.5-.875-.688-1.813-.688-2.75 0-1.063.25-2.063.75-2.938 1.438 1.75 3.188 3.188 5.25 4.25s4.313 1.688 6.688 1.813a5.579 5.579 0 0 1 1.5-5.438c1.125-1.125 2.5-1.688 4.125-1.688s3.063.625 4.188 1.813a11.48 11.48 0 0 0 3.688-1.375c-.438 1.375-1.313 2.438-2.563 3.188 1.125-.125 2.188-.438 3.313-.875z"/></svg></a>

                    <a class="social-link" href="https://github.com/HugoDF" target="_blank" rel="noopener"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a>

                    

                    <a class="social-link" href="https://medium.com/@hugo__df" target="_blank" rel="noopener"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 195 195"><path d="M46.5340803,65.2157554 C46.6968378,63.6076572 46.0836,62.018231 44.8828198,60.93592 L32.6512605,46.2010582 L32.6512605,44 L70.6302521,44 L99.9859944,108.380952 L125.794585,44 L162,44 L162,46.2010582 L151.542017,56.2281011 C150.640424,56.9153477 150.193188,58.0448862 150.380019,59.1628454 L150.380019,132.837155 C150.193188,133.955114 150.640424,135.084652 151.542017,135.771899 L161.755369,145.798942 L161.755369,148 L110.38282,148 L110.38282,145.798942 L120.963119,135.527337 C122.002801,134.487948 122.002801,134.182246 122.002801,132.592593 L122.002801,73.0417402 L92.585901,147.755438 L88.6106443,147.755438 L54.3622782,73.0417402 L54.3622782,123.115814 C54.0767278,125.221069 54.7759199,127.3406 56.2581699,128.863022 L70.0186741,145.55438 L70.0186741,147.755438 L31,147.755438 L31,145.55438 L44.7605042,128.863022 C46.2319621,127.338076 46.8903838,125.204485 46.5340803,123.115814 L46.5340803,65.2157554 Z"/></svg></a>
        </div>  
        
        <a class="subscribe-button" href="https://codewithhugo.com/index.xml">Subscribe</a>
            
      </div>

    </nav>  

  </div>
</header>

<main id="site-main" class="site-main outer" role="main">
  <div class="inner">
    
      <article class="post-full post">
    <header class="post-full-header">
        <section class="post-full-meta">
            <time class="post-full-meta-date" datetime="2018-05-30">30 May 2018</time>
                <span class="date-divider">/</span> <a href="https://codewithhugo.com/tags/vuejs/">#VueJS</a>&nbsp;<a href="https://codewithhugo.com/tags/testing/">#testing</a>&nbsp;
        </section>
        <h1 class="post-full-title">From AngularJS to Vue.js, CommonJS and Jest</h1>
    </header>
    <div class="hero-container">

      
      <figure class="post-full-image" style="background-image: url(https://codewithhugo.com/img/justyn-warner-unsplash.jpg)">
        

      </figure>
    </div>

    <section class="post-full-content">
        <div class="kg-card-markdown">
        

<blockquote>
<p>The trials and tribulations of kicking off an AngularJS -&gt; Vue.js migration</p>
</blockquote>

<p>AngularJS was pretty groundbreaking. It’s still impressive to this day, packed with a router, an HTTP client, a dependency injection system and a bunch of other things I haven’t necessarily had the pleasure of dealing with. It also wraps most browser APIs as injectable services, that’s pretty cool. The downside is that it’s complicated: services, filters, injectors, directives, controllers, apps, components.</p>

<p>With the tools we have today, AngularJS isn’t as strong a way to do things <em>any more</em>. The fact that it’s in maintenance mode says it all. For a new application or new features, ie. for a project that <em>not</em> in maintenance mode, it’s doesn’t have the same niceties as other frameworks and libraries like Angular 2+, React or Vue. There should be a way <em>not</em> to rewrite the whole AngularJS application at once, here&rsquo;s how I went about doing it:</p>

<ul>
<li><a href="#shipping-some-bundles">Shipping some bundles 📦</a>

<ul>
<li><a href="#why-commonjs-instead-of-es-modules">Why CommonJS instead of ES modules?</a></li>
</ul></li>
<li><a href="#adding-vue">Adding Vue 🖼️</a></li>
<li><a href="#setting-up-jest">Setting up Jest 🔧</a>

<ul>
<li><a href="#mock-assets">Mock assets</a></li>
<li><a href="#commonjs--webpack-and-vue-jest-woes">CommonJS, Webpack and <code>vue-jest</code> woes</a></li>
<li><a href="#some-solutions">Some solutions 🤔</a></li>
<li><a href="#fixing-vue-jest-webpack-commonjs-handling-with-a-jest-preprocessor">Fixing <code>vue-jest</code>/Webpack CommonJS handling with a Jest preprocessor</a></li>
</ul></li>
<li><a href="#thoughts-on-running-vue-inside-angularjs">Thoughts on running Vue inside AngularJS 🏃‍</a></li>
</ul>

<h1 id="shipping-some-bundles">Shipping some bundles 📦</h1>

<p>Bundling the AngularJS app allows you to send a few files with everything needed to run the single page application.
Includes using <code>script</code> are reduced to a few bundles of JavaScript (depending on having eg. a vendor bundle) and possibly a few of CSS.</p>

<p>Modernising the codebase using ES6 and beyond becomes possible with a transpilation step, and some bundlers even allow for loading of non-JS files into the JavaScript bundle which means templates and even assets can be sent down in the same payload.</p>

<p>Loading of JavaScript functionality not tied to browser APIs in a test environment using Node (+ JSDOM) becomes possible,
giving you the ability to leverage tools such as Jest, AVA or Mocha (instead of Jasmine + Karma or even Protractor).</p>

<p>This means the controllers look more like the following:</p>
<div class="highlight"><pre class="chroma"><code class="language-js" data-lang="js"><span class="k">const</span> <span class="nx">angular</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;angular&#39;</span><span class="p">);</span>
<span class="kd">function</span> <span class="nx">homeController</span><span class="p">(</span>
  <span class="nx">$location</span><span class="p">,</span>
  <span class="nx">otherService</span>
<span class="p">)</span> <span class="p">{</span>
  <span class="k">const</span> <span class="nx">ctrl</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
  <span class="c1">// attach methods to ctrl
</span><span class="c1"></span>  <span class="k">return</span> <span class="nx">ctrl</span><span class="p">;</span>
<span class="p">}</span>
<span class="nx">angular</span><span class="p">.</span><span class="nx">module</span><span class="p">(</span><span class="s1">&#39;myApp&#39;</span><span class="p">)</span>
<span class="p">.</span><span class="nx">controller</span><span class="p">(</span><span class="s1">&#39;HomeController&#39;</span><span class="p">,</span> <span class="p">[</span>
  <span class="s1">&#39;$location&#39;</span><span class="p">,</span>
  <span class="s1">&#39;otherService&#39;</span><span class="p">,</span>
  <span class="nx">homeController</span>
<span class="p">]);</span>
<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">homeController</span>
<span class="p">};</span>
</code></pre></div>
<p>The above snippet leverages CommonJS which is Node’s default module system, its hallmarks are the use of  <code>require()</code> and <code>module.exports =</code>.</p>

<p>To bundle the application, Webpack allows us to take the AngularJS codebase that leverages CommonJS and output a few application bundles.
Templates can be <code>require</code>-ed using the right webpack loaders (<code>html-loader</code>). SCSS stylesheets and even Handlebar templates can also be compiled.</p>

<h2 id="why-commonjs-instead-of-es-modules">Why CommonJS instead of ES modules?</h2>

<p>ES modules are the module format defined in the ECMAScript spec. They look like the following:</p>
<div class="highlight"><pre class="chroma"><code class="language-js" data-lang="js"><span class="k">import</span> <span class="nx">angular</span> <span class="nx">from</span> <span class="s1">&#39;angular&#39;</span>
<span class="k">export</span> <span class="kd">function</span> <span class="nx">homeController</span><span class="p">()</span> <span class="p">{}</span>
</code></pre></div>
<p>The issue with ES modules are that they are static imports, ideally they shouldn’t have side-effects.
Including something that does <code>angular.module('some-name')</code> seems pretty side-effectful, so CommonJS reflects this a bit more: <code>require('./this-script-that-adds-something-to-angular')</code>.</p>

<h1 id="adding-vue">Adding Vue 🖼️</h1>

<p>This part was surprisingly straightforward, to add Vue components to an AngularJS app ngVue is available (<a href="https://github.com/ngVue/ngVue">https://github.com/ngVue/ngVue</a>).
<code>ngVue</code> exposes functionality to wrap Vue components as an AngularJS directives.</p>

<p>The checklist goes like this:</p>

<ul>
<li><code>npm i --save ngVue vue vue-loader</code> (vue-loader is to load/compile <code>.vue</code> single file components)</li>
<li>add <code>ngVue</code> to the bundle: have <code>require('ngVue')</code> somewhere</li>
<li>Register <code>ngVue</code>  with AngularJS <code>angular.module('myApp', ['ngVue'])</code></li>
<li>Create a Vue component that is registered on the global Vue instance as a component
<code>js
const myComponent = {
template: '&lt;div&gt;My Component&lt;/div&gt;'
};
const MyVueComponent = Vue.component(
'my-component',
MyComponent
);
</code></li>
<li>Register the component as an AngularJS directive
<code>js
angular
.module('myApp')
.directive('myComponent', [
'createVueComponent' ,
createVueComponent =&gt; createVueComponent(MyVueComponent)
]);
</code></li>
<li>In an AngularJS template you can now use: <code>&lt;my-component v-props-my-data=&quot;ctrl.myData&quot;&gt;&lt;/my-component&gt;</code> (<code>vprops-*</code> allows you to pass data and functions from AngularJS to Vue as props)</li>
</ul>

<p>Full snippet that leverages webpack to load a single file component:</p>
<div class="highlight"><pre class="chroma"><code class="language-js" data-lang="js"><span class="k">const</span> <span class="nx">angular</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;angular&#39;</span><span class="p">);</span>
<span class="k">const</span> <span class="p">{</span> <span class="k">default</span><span class="o">:</span> <span class="nx">Vue</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;vue&#39;</span><span class="p">);</span>
<span class="k">const</span> <span class="p">{</span> <span class="k">default</span><span class="o">:</span> <span class="nx">MyComponent</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./my-component.vue&#39;</span><span class="p">);</span>
<span class="k">const</span> <span class="nx">MyVueComponent</span> <span class="o">=</span> <span class="nx">Vue</span><span class="p">.</span><span class="nx">component</span><span class="p">(</span><span class="s1">&#39;my-component&#39;</span><span class="p">,</span> <span class="nx">MyComponent</span><span class="p">)</span>
<span class="nx">angular</span>
<span class="p">.</span><span class="nx">module</span><span class="p">(</span><span class="s1">&#39;myApp&#39;</span><span class="p">)</span>
<span class="p">.</span><span class="nx">directive</span><span class="p">(</span><span class="s1">&#39;myComponent&#39;</span><span class="p">,</span> <span class="p">[</span>
  <span class="s1">&#39;createVueComponent&#39;</span> <span class="p">,</span>
  <span class="nx">createVueComponent</span> <span class="p">=&gt;</span> <span class="nx">createVueComponent</span><span class="p">(</span><span class="nx">MyVueComponent</span><span class="p">)</span>
<span class="p">]);</span>
</code></pre></div>
<p>In order to load single file components like in the above example, <code>vue-loader</code> is required (see <a href="https://github.com/vuejs/vue-loader">https://github.com/vuejs/vue-loader</a>),
depending on how webpack is set up in a project, it can also affect how you process CSS (since single file components contain CSS as well as JavaScript and templates).</p>

<h1 id="setting-up-jest">Setting up Jest 🔧</h1>

<h2 id="mock-assets">Mock assets</h2>

<p><code>.html</code>, <code>.scss</code>, <code>.svg</code> needs to be dummied in your Jest config:</p>
<div class="highlight"><pre class="chroma"><code class="language-json" data-lang="json"><span class="p">{</span>
    <span class="nt">&#34;testRegex&#34;</span><span class="p">:</span> <span class="s2">&#34;.*spec.js$&#34;</span><span class="p">,</span>
    <span class="nt">&#34;moduleFileExtensions&#34;</span><span class="p">:</span> <span class="p">[</span>
      <span class="s2">&#34;js&#34;</span><span class="p">,</span>
      <span class="s2">&#34;vue&#34;</span>
    <span class="p">],</span>
    <span class="nt">&#34;moduleNameMapper&#34;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&#34;\\.(html)$&#34;</span><span class="p">:</span> <span class="s2">&#34;&lt;rootDir&gt;/src/mocks/template-mock.js&#34;</span>
    <span class="p">},</span>
    <span class="nt">&#34;transform&#34;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&#34;.*\\.js$&#34;</span><span class="p">:</span> <span class="s2">&#34;&lt;rootDir&gt;/node_modules/babel-jest&#34;</span><span class="p">,</span>
      <span class="nt">&#34;.*\\.(vue)$&#34;</span><span class="p">:</span> <span class="s2">&#34;&lt;rootDir&gt;/node_modules/vue-jest&#34;</span>
    <span class="p">},</span>
    <span class="nt">&#34;collectCoverageFrom&#34;</span><span class="p">:</span> <span class="p">[</span>
      <span class="s2">&#34;src/**/*.{js,vue}&#34;</span>
    <span class="p">]</span>
<span class="p">}</span></code></pre></div>
<h2 id="commonjs-webpack-and-vue-jest-woes">CommonJS, Webpack and <code>vue-jest</code> woes</h2>

<p>Webpack doesn’t care about CommonJS vs ESM,  for all intents and purposes, Webpack treats them as the same thing. Here’s the catch: the recommended Jest plugin for Vue (<code>vue-jest</code>) handles <code>require</code> vs <code>import</code> of <code>.vue</code> files differently to Webpack.
This is some sample code in a Vue component that imports another Vue single file component in CommonJS:</p>
<div class="highlight"><pre class="chroma"><code class="language-js" data-lang="js"><span class="k">const</span> <span class="nx">MyOtherComponent</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./my-other-component.vue&#39;</span><span class="p">).</span><span class="k">default</span><span class="p">;</span>

<span class="k">export</span><span class="p">.</span><span class="k">default</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">components</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">MyOtherComponent</span>
  <span class="p">}</span>
<span class="p">};</span>
</code></pre></div>
<p>The issue is the following:</p>

<ul>
<li>For the Webpack build to work, you need to use <code>const MyComponent = require('./my-component.vue').default</code> or <code>import MyComponent from './my-component.vue'</code>.</li>
<li>For tests to pass, you need to do <code>const MyComponent = require('./my-component.vue')</code> or use <code>import</code> and transpile the modules using Babel</li>
<li>AngularJS controllers love <code>this</code> … transpiling ES modules through Babel breaks <code>this</code> somehow</li>
</ul>

<h2 id="some-solutions">Some solutions 🤔</h2>

<ol>
<li><p>Use ES6 import/export for the Vue components and tests, add a specific extension (<code>.mjs</code>, <code>.module.js</code>), disable <code>babel-jest</code> on CommonJS files.<br />
<strong>Drawback</strong>: Coverage breaks due to the following issue (that is fixed now): <a href="https://github.com/istanbuljs/babel-plugin-istanbul/pull/141">https://github.com/istanbuljs/babel-plugin-istanbul/pull/141</a></p></li>

<li><p>Monkey-patch using Jest inside your test: <code>jest.setMock('./my-component.vue', { default: MyComponent });</code>.<br />
<strong>Drawback</strong>: this is not a real fix, it makes the developer have to think about Vue vs bundled JavaScript vs JavaScript in test, which should appear the same in most situations.</p></li>

<li><p>Rewrite the transformed code, using a custom pre-processor, so it behaves the same under Webpack and <code>vue-jest</code>.</p></li>
</ol>

<h2 id="fixing-vue-jest-webpack-commonjs-handling-with-a-jest-preprocessor">Fixing <code>vue-jest</code>/Webpack CommonJS handling with a Jest preprocessor</h2>

<p>The following preprocessor takes <code>require('./relative-path').default</code> and converts it to <code>require('./relative-path')</code> (which is what Webpack seems to do under the hood).
To use the following preprocessor, replace the <code>.vue</code>-matching line in <code>&quot;transform&quot;</code> of Jest config with <code>&quot;.*\\.(vue)$&quot;: &quot;&lt;rootDir&gt;/vue-preprocessor&quot;</code>.
Here is the full code for the preprocessor, walkthrough of the code/approach follows:</p>
<div class="highlight"><pre class="chroma"><code class="language-js" data-lang="js"><span class="c1">// vue-preprocessor.js
</span><span class="c1"></span><span class="k">const</span> <span class="nx">vueJest</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;vue-jest&#39;</span><span class="p">);</span>

<span class="k">const</span> <span class="nx">requireNonVendorDefaultRegex</span> <span class="o">=</span> <span class="sr">/(require)\(&#39;\..*&#39;\).default/g</span><span class="p">;</span>

<span class="k">const</span> <span class="nx">rewriteNonVendorRequireDefault</span> <span class="o">=</span> <span class="nx">code</span> <span class="p">=&gt;</span>
  <span class="nx">code</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="nx">requireNonVendorDefaultRegex</span><span class="p">,</span> <span class="nx">match</span> <span class="p">=&gt;</span>
    <span class="nx">match</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="s1">&#39;.default&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
  <span class="p">);</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">process</span> <span class="p">(</span><span class="nx">src</span><span class="p">,</span> <span class="nx">filename</span><span class="p">,</span> <span class="nx">config</span><span class="p">,</span> <span class="nx">transformOptions</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">const</span> <span class="p">{</span> <span class="nx">code</span><span class="o">:</span> <span class="nx">rawCode</span><span class="p">,</span> <span class="nx">map</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">vueJest</span><span class="p">.</span><span class="nx">process</span><span class="p">(</span>
      <span class="nx">src</span><span class="p">,</span>
      <span class="nx">filename</span><span class="p">,</span>
      <span class="nx">config</span><span class="p">,</span>
      <span class="nx">transformOptions</span>
    <span class="p">);</span>
    <span class="k">const</span> <span class="nx">code</span> <span class="o">=</span> <span class="nx">rewriteNonVendorRequireDefault</span><span class="p">(</span><span class="nx">rawCode</span><span class="p">);</span>
    <span class="k">return</span> <span class="p">{</span>
      <span class="nx">code</span><span class="p">,</span>
      <span class="nx">map</span>
    <span class="p">};</span>
  <span class="p">}</span>
<span class="p">};</span>
</code></pre></div>
<p>At a high level, we process the code through <code>vue-jest</code> and then rewrite <code>require('./relative-path').default</code> to <code>require('./relative-path')</code>.
This is done with the following:</p>

<ul>
<li><code>/(require)\('\..*'\).default/g</code> matches any <code>require</code> where the string arg starts with <code>.</code> ie it will match local <code>require('./something-here')</code> but not <code>require</code> of node modules (eg. <code>required('vue')</code>). A caveat is that this RegEx only works for single-quote requires… but that’s trivial to fix if the code uses double quotes.</li>
<li><code>String.replace</code> with a function argument is leveraged to run a custom replace on each match of the previous RegEx. That’s done with <code>match.replace('.default', '')</code>.</li>
</ul>

<h1 id="thoughts-on-running-vue-inside-angularjs">Thoughts on running Vue inside AngularJS 🏃‍</h1>

<p>AngularJS is from a time before bundlers and a JavaScript module system.
The only contemporary bundling tool to AngularJS target JavaScript applications is the Google Closure Compiler.
For reference Browserify was released in 2011, webpack in 2012. AngularJS’ initial release was in 2010.</p>

<p>That’s why we ended up with things like <code>script</code> includes for each controller and each template (<code>script type=&quot;ng-template&quot;</code>).</p>

<p>Each <code>script</code> will call <code>angular.module('app').{controller, directive, service}</code>and each of those calls will register something on the global <code>angular</code>  instance and can then be consumed elsewhere.
This is brittle since code that should be co-located gets spread across the codebase and gets referenced with strings like <code>'HomeController'</code>.
All it takes is 1 typo and we&rsquo;ve got a bug that won’t be detected until we get the app in a certain state…</p>

<p>With Vue.js, Webpack and Jest, we can bundle, test and build with more confidence.
AngularJS was and still is great. What’s also great that we can migrate off it progressively, thanks to the <code>ngVue</code> team.</p>

<p>That means we get to keep the solid AngularJS working alongside new features written in Vue.</p>

<p>Cover photo by <a href="https://unsplash.com/photos/TzQZTfkanPA?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText">Justyn Warner</a> on <a href="https://unsplash.com/?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText">Unsplash</a></p>

        </div>
    </section>

    <section class="subscribe-form">
        <h3 class="subscribe-form-title">Subscribe to Code with Hugo</h3>
        <p>Get all the posts of the week before anyone else in your inbox</p>
        <form
            action="https://buttondown.email/api/emails/embed-subscribe/hugo"
            method="post"
            target="popupwindow"
            onsubmit="window.open('https://buttondown.email/hugo', 'popupwindow')"
        >
            <div class="form-group">
                <input class="subscribe-email" type="email" name="email" id="bd-email" placeholder="youremail@example.com">
                <input type="hidden" value="1" name="embed"/>
            </div>
            <button class="" value="Subscribe" type="submit"><span>Subscribe</span></button>
        </form>
    </section>

    <footer class="post-full-footer">
      <section class="author-card">
        <img class="author-profile-image" src="https://cdn-images-1.medium.com/fit/c/200/200/0*Rb-aDjpTtV1UZA4O.jpeg" alt="Author" />
        <section class="author-card-content">
            <h4 class="author-card-name"><a href="https://codewithhugo.com/">Hugo Di Francesco</a></h4>
                <p>A developer, working out of London writing CSS, JavaScript and Python.</p>
        </section>
      </section>
    </footer>
</article>


  <section class="overlay-cta">
    <div class="overlay-cta__inner">
      <div class="overlay-cta__text-container">
        <h3 class="cta-title overlay-cta__title">
          Subscribe to the Code with Hugo newsletter
        </h3>
        <p class="cta-text overlay-cta__text">
          Get the latest articles in your inbox every 2 weeks
        </p>
      </div>
      <div class="overlay-cta__button-container">
        <a href="https://buttondown.email/hugo" class="button overlay-cta__button">
          Subscribe
        </a>
        <a href="#" class="overlay-cta__close">close</a>
      </div>
    </div>
  </section>



    
    
    

  </div>
</main>


<aside class="read-next outer">
  <div class="inner">
    <div class="read-next-feed">      
      
<article class="read-next-card" 
            style="background-image: url(https://codewithhugo.com/img/cover.jpg);" >
    <header class="read-next-card-header">
        <small class="read-next-card-header-sitetitle">&mdash; Code with Hugo &mdash;</small>
        
        <h3 class="read-next-card-header-title"><a href="https://codewithhugo.com/tags/vuejs/">#VueJS</a></h3>
    </header>
    <div class="read-next-divider"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 14.5s2 3 5 3 5.5-2.463 5.5-5.5S21 6.5 18 6.5c-5 0-7 11-12 11C2.962 17.5.5 15.037.5 12S3 6.5 6 6.5s4.5 3.5 4.5 3.5"/></svg>
    </div>

    <div class="read-next-card-content">
      
        <ul>
          <li><a href="https://codewithhugo.com/deployment-options-netlify---dokku-on-digitalocean-vs-now.sh-github-pages-heroku-and-aws/">Deployment options: Netlify &#43; Dokku on DigitalOcean vs now.sh, GitHub Pages, Heroku and AWS</a></li>            
        
          <li><a href="https://codewithhugo.com/impress-interviewers-with-recursion-in-javascript-with-es6-features/">Impress interviewers with recursion in JavaScript with ES6 features</a></li>            
        
          <li><a href="https://codewithhugo.com/progress-and-roadblocks-a-journey-into-open-source/">Progress and roadblocks: a journey into open-source</a></li>            
        
          <li><a href="https://codewithhugo.com/mocking-the-current-date-in-jest-tests/">Mocking the current Date in Jest tests</a></li>            
        </ul>
    </div>
    <footer class="read-next-card-footer">
      
        <a href="https://codewithhugo.com/tags/vuejs/">See all related posts →</a>
    </footer>
</article>


      
      <article class="post-card post"> 
    
    <a class="post-card-image-link" href="https://codewithhugo.com/setting-up-express-and-redis-with-docker-compose/">
      <div class="post-card-image" style="background-image: url(https://codewithhugo.com/img/ben-koorengevel-unsplash.jpg)"></div>
    </a>
    

    <div class="post-card-content">
      <a class="post-card-content-link" href="https://codewithhugo.com/setting-up-express-and-redis-with-docker-compose/">
          <header class="post-card-header">
              <span class="post-card-tags">
              #JavaScript 
              #Node 
              #Docker 
              #redis  </span>
              
              <h2 class="post-card-title">Setting up Express and Redis with Docker compose</h2>
          </header>
          <section class="post-card-excerpt">
              
                <p>Redis and Express are tools that provide a simple and clean approach to their problem domains.
The repo is available at: https://github.com/HugoDF/express-redis-docker.
Redis is “an open source, in-memory data structure store, used as a database, cache and message broker”. It’s as simple and unopinionated as a database as it gets, it’s known for its performance and simplicity as a key-value store. It has great flexibility and can also be used as a message queue, circular buffer (and pretty much anything else a developer can come up with short of a relational database). ...  </p>
              
          </section>
      </a>

      <footer class="post-card-meta">
          <img class="author-profile-image" src="https://cdn-images-1.medium.com/fit/c/200/200/0*Rb-aDjpTtV1UZA4O.jpeg" alt="Author" />
          <span class="post-card-author"><a href="/">Hugo Di Francesco</a></span>
      </footer>
    </div>
</article>
      
      
      <article class="post-card post"> 
    
    <a class="post-card-image-link" href="https://codewithhugo.com/split-an-existing-git-commit/">
      <div class="post-card-image" style="background-image: url(https://codewithhugo.com/img/markus-spiske-unsplash.jpg)"></div>
    </a>
    

    <div class="post-card-content">
      <a class="post-card-content-link" href="https://codewithhugo.com/split-an-existing-git-commit/">
          <header class="post-card-header">
              <span class="post-card-tags">
              #git 
              #web development 
              #productivity  </span>
              
              <h2 class="post-card-title">Split an existing git commit</h2>
          </header>
          <section class="post-card-excerpt">
              
                <p>One of git&rsquo;s main differences when compared to other version control systems is that it lets the user rewrite the history. The main way to do this is to use git rebase, usually followed by a git push --force to overwrite history the remote with the local history.
Here’s a look at how to split existing commits using rebase, reset and commit.
Say you have two files edited in a commit (A and B) and you would like to get the changes from one of those files (A) into your current branch but not those from the other (B). ...  </p>
              
          </section>
      </a>

      <footer class="post-card-meta">
          <img class="author-profile-image" src="https://cdn-images-1.medium.com/fit/c/200/200/0*Rb-aDjpTtV1UZA4O.jpeg" alt="Author" />
          <span class="post-card-author"><a href="/">Hugo Di Francesco</a></span>
      </footer>
    </div>
</article>
      
    </div>
  </div>
</aside>

<div class="floating-header">
  <div class="floating-header-logo">
    <a href="https://codewithhugo.com/">
      
      <span>Code with Hugo</span>
    </a>
  </div>
  <span class="floating-header-divider">&mdash;</span>
  <div class="floating-header-title">From AngularJS to Vue.js, CommonJS and Jest</div>
  <div class="floating-header-share">
    <div class="floating-header-share-label">Share this <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
     <path d="M7.5 15.5V4a1.5 1.5 0 1 1 3 0v4.5h2a1 1 0 0 1 1 1h2a1 1 0 0 1 1 1H18a1.5 1.5 0 0 1 1.5 1.5v3.099c0 .929-.13 1.854-.385 2.748L17.5 23.5h-9c-1.5-2-5.417-8.673-5.417-8.673a1.2 1.2 0 0 1 1.76-1.605L7.5 15.5zm6-6v2m-3-3.5v3.5m6-1v2"/></svg>
    </div>

    
    <a class="floating-header-share-tw" href="https://twitter.com/share?text=%22From%20AngularJS%20to%20Vue.js%2c%20CommonJS%20and%20Jest%22%20by%20%40hugo__df&amp;url=https%3a%2f%2fcodewithhugo.com%2ffrom-angularjs-to-vue.js-commonjs-and-jest%2f&amp"
          onclick="window.open(this.href, 'share-twitter', 'width=550,height=235');return false;">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M30.063 7.313c-.813 1.125-1.75 2.125-2.875 2.938v.75c0 1.563-.188 3.125-.688 4.625a15.088 15.088 0 0 1-2.063 4.438c-.875 1.438-2 2.688-3.25 3.813a15.015 15.015 0 0 1-4.625 2.563c-1.813.688-3.75 1-5.75 1-3.25 0-6.188-.875-8.875-2.625.438.063.875.125 1.375.125 2.688 0 5.063-.875 7.188-2.5-1.25 0-2.375-.375-3.375-1.125s-1.688-1.688-2.063-2.875c.438.063.813.125 1.125.125.5 0 1-.063 1.5-.25-1.313-.25-2.438-.938-3.313-1.938a5.673 5.673 0 0 1-1.313-3.688v-.063c.813.438 1.688.688 2.625.688a5.228 5.228 0 0 1-1.875-2c-.5-.875-.688-1.813-.688-2.75 0-1.063.25-2.063.75-2.938 1.438 1.75 3.188 3.188 5.25 4.25s4.313 1.688 6.688 1.813a5.579 5.579 0 0 1 1.5-5.438c1.125-1.125 2.5-1.688 4.125-1.688s3.063.625 4.188 1.813a11.48 11.48 0 0 0 3.688-1.375c-.438 1.375-1.313 2.438-2.563 3.188 1.125-.125 2.188-.438 3.313-.875z"/></svg>
      </a>
      <a class="floating-header-share-fb" href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fcodewithhugo.com%2ffrom-angularjs-to-vue.js-commonjs-and-jest%2f"
          onclick="window.open(this.href, 'share-facebook','width=580,height=296');return false;">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M19 6h5V0h-5c-3.86 0-7 3.14-7 7v3H8v6h4v16h6V16h5l1-6h-6V7c0-.542.458-1 1-1z"/></svg>
      </a>
  </div>

  <progress class="progress" value="0">
    <div class="progress-container">
      <span class="progress-bar"></span>
    </div>
  </progress>
</div>



<footer class="site-footer outer">
  <div class="site-footer-content inner">
    <section class="copyright" style="line-height: 1.3em;">
      <a href="/">Code with Hugo</a>  <br>
      
    </section>
    <nav class="site-footer-nav">
        <a href="/">Latest Posts</a>
        
        <a href="https://twitter.com/hugo__df" target="_blank" rel="noopener">Twitter</a>
        <a href="https://github.com/HugoDF" target="_blank" rel="noopener">Github</a>
        
        <a href="https://medium.com/@hugo__df" target="_blank" rel="noopener">Medium</a>
    </nav>  
  </div>
</footer>

</div>

<script type="text/javascript" src="//code.jquery.com/jquery-3.2.1.min.js"></script>
<script type="text/javascript" src="https://codewithhugo.com/js/jquery.fitvids.js"></script>




  <!-- Google Analytics -->
  <script>
    var _gaq=[['_setAccount','UA-60469708-1'],['_trackPageview']];
    (function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];
    g.src=('https:'==location.protocol?'//ssl':'//www')+'.google-analytics.com/ga.js';
    s.parentNode.insertBefore(g,s)}(document,'script'));
  </script>



<script async src="//cdn.simpleanalytics.io/hello.js"></script>
<noscript><img src="//api.simpleanalytics.io/hello.gif" alt=""></noscript>





<script>
  (function (document) {
    function getLastDocumentHeight(document) {
      var body = document.body;
      var html = document.documentElement;
      return Math.max(
        body.scrollHeight, body.offsetHeight,
        html.clientHeight, html.scrollHeight,
        html.offsetHeight
      );
    }

    var $overlay = document.querySelector('.overlay-cta');
    var hiddenClass = 'overlay-cta--hidden';
    var closedClass = 'overlay-cta--closed';
    $overlay.classList.add(hiddenClass);

    
    var $overlayClose = document.querySelector('.overlay-cta__close');
    var overlayCloseListener = $overlayClose.addEventListener('click', function (e) {
      e.preventDefault();
      $overlay.classList.add(closedClass);
    });

    var $heroCtaButton = document.querySelector('.hero-cta .button');
    var $firstContentItem = document.querySelector('.post-full-content > * > *');
    var title = $heroCtaButton || $firstContentItem;

    var $subscribeBox = document.querySelector('.subscribe-form');

    var lastScrollY = window.scrollY;
    var lastWindowHeight = window.innerHeight;
    var lastDocumentHeight = getLastDocumentHeight(document);
    var ticking = false;


    function onScroll() {
      lastScrollY = window.scrollY;
      requestTick();
    }

    function onResize() {
      lastWindowHeight = window.innerHeight;
      lastDocumentHeight = getLastDocumentHeight(document);
      requestTick();
    }

    function requestTick() {
      if (!ticking) {
        requestAnimationFrame(update);
      }
      ticking = true;
    }

    function update() {
      var trigger = title.getBoundingClientRect().top + window.scrollY;
      var triggerOffset = title.offsetHeight + 35;
      var lastShowCtaBoxHeight = $subscribeBox.getBoundingClientRect().top ;
      
      if (
        lastScrollY >= trigger + triggerOffset &&
        lastShowCtaBoxHeight > lastWindowHeight
      ) {
        $overlay.classList.remove(hiddenClass);
      } else {
        $overlay.classList.add(hiddenClass);
      }

      ticking = false;
    }

    window.addEventListener('scroll', onScroll, { passive: true });
    window.addEventListener('resize', onResize, false);

    update();
  })(document);
</script>


    <script>





$(document).ready(function () {
    
    var $postContent = $(".post-full-content");
    $postContent.fitVids();
    

    var progressBar = document.querySelector('progress');
    var header = document.querySelector('.floating-header');
    var title = document.querySelector('.post-full-title');

    var lastScrollY = window.scrollY;
    var lastWindowHeight = window.innerHeight;
    var lastDocumentHeight = $(document).height();
    var ticking = false;

    function onScroll() {
        lastScrollY = window.scrollY;
        requestTick();
    }

    function onResize() {
        lastWindowHeight = window.innerHeight;
        lastDocumentHeight = $(document).height();
        requestTick();
    }

    function requestTick() {
        if (!ticking) {
            requestAnimationFrame(update);
        }
        ticking = true;
    }

    function update() {
        var trigger = title.getBoundingClientRect().top + window.scrollY;
        var triggerOffset = title.offsetHeight + 35;
        var progressMax = lastDocumentHeight - lastWindowHeight;

        
        if (lastScrollY >= trigger + triggerOffset) {
            header.classList.add('floating-active');
        } else {
            header.classList.remove('floating-active');
        }

        progressBar.setAttribute('max', progressMax);
        progressBar.setAttribute('value', lastScrollY);

        ticking = false;
    }

    window.addEventListener('scroll', onScroll, {passive: true});
    window.addEventListener('resize', onResize, false);

    update();
});
</script>
</body></html>
