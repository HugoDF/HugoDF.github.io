<!DOCTYPE html>
<html lang="en-US" />
<head>
    <meta http-equiv="Content-Type" content="text/html" charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="google-site-verification" content="gBfbdXRLofaOyHsbgiSiuCIHKPaviGMRVWh_qOfDHNE" />

    <title>A simple, real-world Vue.js directive &middot; Code with Hugo</title>

    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="shortcut icon" href="https://codewithhugo.com/favicon.ico" />
    <meta name="theme-color" content="#090a0b">
    
    <link rel="canonical" href="https://codewithhugo.com/a-simple-real-world-vue.js-directive/" /> 

     <meta name="description" content="Vue.js is &amp;ldquo;The Progressive JavaScript Framework&amp;rdquo;. It takes inspiration from all prior art in the view library and frontend framework world, includin" /> 

     
    
    <meta name="twitter:card" content="summary_large_image"/>
    <meta name="twitter:image" content="https://codewithhugo.com/img/frank-mckenna-unsplash.jpg"/>
    
 
    <meta name="twitter:title" content="A simple, real-world Vue.js directive"/>
    <meta name="twitter:description" content="Vue.js is &amp;ldquo;The Progressive JavaScript Framework&amp;rdquo;. It takes inspiration from all prior art in the view library and frontend framework world, includin"/>
    <meta name="twitter:url" content="https://codewithhugo.com/a-simple-real-world-vue.js-directive/" />
    <meta name="twitter:site" content="@hugo__df"/>

    <meta property="og:site_name" content="Code with Hugo" />
    <meta property="og:title" content="A simple, real-world Vue.js directive &middot; Code with Hugo" />
    <meta property="og:url" content="https://codewithhugo.com/a-simple-real-world-vue.js-directive/" />
    

    <meta property="og:type" content="article" />
    <meta property="og:description" content="Vue.js is &amp;ldquo;The Progressive JavaScript Framework&amp;rdquo;. It takes inspiration from all prior art in the view library and frontend framework world, includin" />

    <meta property="article:published_time" content="2018-05-15T00:00:00Z" />
    <meta property="article:tag" content="JavaScript" /><meta property="article:tag" content="VueJS" /><meta property="article:tag" content="web development" />

    <meta property="og:image" content="https://codewithhugo.com/img/frank-mckenna-unsplash.jpg"/>


    <meta name="generator" content="Hugo 0.46" />

    <!-- Stylesheets -->
    <link rel="stylesheet" type="text/css" href="https://codewithhugo.com/built/screen.css" /> 
    <link rel="stylesheet" type="text/css" href="https://codewithhugo.com/css/casper-two.css" /> 
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css" />
     <link rel="stylesheet" href="https://codewithhugo.com/overrides.min.css" />  <link rel="stylesheet" href="https://codewithhugo.com/syntax.min.css" /> 

    <link href="https://buttondown.email/hugo" rel="alternate" title="Code with Hugo" /> 
</head>


<body class="post-template">
  <div class="site-wrapper"> 

<header class="site-header outer">
  <div class="inner">
    <nav class="site-nav">
      <div class="site-nav-left">

        <ul class="nav" role="menu">
        
        
        
            <li class="" role="menuitem">
              <a href="/">Home</a>
            </li>
        
            <li class="" role="menuitem">
              <a href="/tags/javascript/">JavaScript</a>
            </li>
        
            <li class="" role="menuitem">
              <a href="/tags/node/">Node</a>
            </li>
        
            <li class="" role="menuitem">
              <a href="/tags/css/">CSS</a>
            </li>
        
            <li class="" role="menuitem">
              <a href="/tags/tip/">tips</a>
            </li>
        
      </ul></div>

      <div class="site-nav-right">
        <div class="social-links">
                    

                    <a class="social-link social-link-tw" href="https://twitter.com/hugo__df" target="_blank" rel="noopener"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M30.063 7.313c-.813 1.125-1.75 2.125-2.875 2.938v.75c0 1.563-.188 3.125-.688 4.625a15.088 15.088 0 0 1-2.063 4.438c-.875 1.438-2 2.688-3.25 3.813a15.015 15.015 0 0 1-4.625 2.563c-1.813.688-3.75 1-5.75 1-3.25 0-6.188-.875-8.875-2.625.438.063.875.125 1.375.125 2.688 0 5.063-.875 7.188-2.5-1.25 0-2.375-.375-3.375-1.125s-1.688-1.688-2.063-2.875c.438.063.813.125 1.125.125.5 0 1-.063 1.5-.25-1.313-.25-2.438-.938-3.313-1.938a5.673 5.673 0 0 1-1.313-3.688v-.063c.813.438 1.688.688 2.625.688a5.228 5.228 0 0 1-1.875-2c-.5-.875-.688-1.813-.688-2.75 0-1.063.25-2.063.75-2.938 1.438 1.75 3.188 3.188 5.25 4.25s4.313 1.688 6.688 1.813a5.579 5.579 0 0 1 1.5-5.438c1.125-1.125 2.5-1.688 4.125-1.688s3.063.625 4.188 1.813a11.48 11.48 0 0 0 3.688-1.375c-.438 1.375-1.313 2.438-2.563 3.188 1.125-.125 2.188-.438 3.313-.875z"/></svg></a>

                    <a class="social-link" href="https://github.com/HugoDF" target="_blank" rel="noopener"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a>

                    

                    <a class="social-link" href="https://medium.com/@hugo__df" target="_blank" rel="noopener"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 195 195"><path d="M46.5340803,65.2157554 C46.6968378,63.6076572 46.0836,62.018231 44.8828198,60.93592 L32.6512605,46.2010582 L32.6512605,44 L70.6302521,44 L99.9859944,108.380952 L125.794585,44 L162,44 L162,46.2010582 L151.542017,56.2281011 C150.640424,56.9153477 150.193188,58.0448862 150.380019,59.1628454 L150.380019,132.837155 C150.193188,133.955114 150.640424,135.084652 151.542017,135.771899 L161.755369,145.798942 L161.755369,148 L110.38282,148 L110.38282,145.798942 L120.963119,135.527337 C122.002801,134.487948 122.002801,134.182246 122.002801,132.592593 L122.002801,73.0417402 L92.585901,147.755438 L88.6106443,147.755438 L54.3622782,73.0417402 L54.3622782,123.115814 C54.0767278,125.221069 54.7759199,127.3406 56.2581699,128.863022 L70.0186741,145.55438 L70.0186741,147.755438 L31,147.755438 L31,145.55438 L44.7605042,128.863022 C46.2319621,127.338076 46.8903838,125.204485 46.5340803,123.115814 L46.5340803,65.2157554 Z"/></svg></a>
        </div>  
        
        <a class="subscribe-button" href="https://buttondown.email/hugo">Subscribe</a> </div>
            
      </div>

    </nav>  

  </div>
</header>

<main id="site-main" class="site-main outer" role="main">
  <div class="inner">
    
      <article class="post-full post"> 
    <header class="post-full-header">
        <section class="post-full-meta">
            <time class="post-full-meta-date" datetime="2018-05-15">15 May 2018</time>
                <span class="date-divider">/</span> <a href="https://codewithhugo.com/tags/javascript/">#JavaScript</a>&nbsp;<a href="https://codewithhugo.com/tags/vuejs/">#VueJS</a>&nbsp;
        </section>
        <h1 class="post-full-title">A simple, real-world Vue.js directive</h1>
    </header>
    
    <figure class="post-full-image" style="background-image: url(https://codewithhugo.com/img/frank-mckenna-unsplash.jpg)">
    </figure>

    <section class="post-full-content">
        <div class="kg-card-markdown">
        

<p><a href="https://vuejs.org/">Vue.js</a> is &ldquo;The Progressive JavaScript Framework&rdquo;. It takes inspiration from all prior art in the view library and frontend framework world, including AngularJS, React, Angular, Ember, Knockout and Polymer.
In Vue (and Angular/AngularJS), a directive is a way to wrap functionality that usually applies to DOM elements. The example in Vue&rsquo;s documentation is a <code>focus</code> directive.</p>

<p>When running Vue.js inside of AngularJS, an issue occured whereby the AngularJS router would try to resolve
normal anchors&rsquo; <code>href</code> on click.
The <code>href</code>s weren&rsquo;t AngularJS URLs so it would fall back to the default page.
One solution could have leveraged components to update <code>window.location</code> directly, but here&rsquo;s a nifty directive to do the same:</p>
<div class="highlight"><pre class="chroma"><code class="language-html" data-lang="html"><span class="p">&lt;</span><span class="nt">a</span> <span class="na">v-href</span><span class="o">=</span><span class="s">&#34;&#39;/my-url&#39;&#34;</span><span class="p">&gt;</span>Go<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span></code></pre></div>
<p>That&rsquo;s a pretty cool API, and it&rsquo;s probably more idiomatic Vue than:</p>
<div class="highlight"><pre class="chroma"><code class="language-html" data-lang="html"><span class="p">&lt;</span><span class="nt">MyAnchor</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;/my-url&#34;</span><span class="p">&gt;</span>
  Go
<span class="p">&lt;/</span><span class="nt">MyAnchor</span><span class="p">&gt;</span></code></pre></div>
<p>There were a couple of gotchas:</p>

<ul>
<li><a href="#local-global">Local vs global directive registration üåê</a></li>
<li><a href="#minimal-directive">A minimal directive API üëå</a></li>
<li><a href="#hooks-and-remove">Vue directive hooks and <code>removeEventListener</code> üÜì</a></li>
<li><a href="#handling-clicks">Handling clicks properly üñ±</a></li>
<li><a href="#parting-thoughts">Parting thoughts üìö</a></li>
</ul>

<h1 id="local-global">Local vs global directive registration üåê</h1>

<p>A global Vue directive can be defined like so:</p>
<div class="highlight"><pre class="chroma"><code class="language-js" data-lang="js"><span class="nx">Vue</span><span class="p">.</span><span class="nx">directive</span><span class="p">(</span><span class="s2">&#34;non-angular-link&#34;</span><span class="p">,</span> <span class="p">{</span>
  <span class="c1">// directive definition
</span><span class="c1"></span><span class="p">});</span>
</code></pre></div>
<p>It can also be defined locally as follows:</p>
<div class="highlight"><pre class="chroma"><code class="language-js" data-lang="js"><span class="nx">Vue</span><span class="p">.</span><span class="nx">component</span><span class="p">(</span><span class="s2">&#34;my-component&#34;</span><span class="p">,</span> <span class="p">{</span>
  <span class="nx">directives</span><span class="o">:</span> <span class="p">{</span>
    <span class="s2">&#34;non-angular-link&#34;</span><span class="o">:</span> <span class="nx">nonAngularLinkDirective</span>
  <span class="p">}</span>
<span class="p">});</span>
</code></pre></div>
<p>Where <code>nonAngularLinkDirective</code> would be a JavaScript object that defines the directive, eg.</p>
<div class="highlight"><pre class="chroma"><code class="language-js" data-lang="js"><span class="k">const</span> <span class="nx">nonAngularLinkDirective</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">bind</span><span class="p">(</span><span class="nx">el</span><span class="p">,</span> <span class="nx">binding</span><span class="p">)</span> <span class="p">{},</span>
  <span class="nx">unbind</span><span class="p">(</span><span class="nx">el</span><span class="p">)</span> <span class="p">{}</span>
<span class="p">};</span>
</code></pre></div>
<p>This allows for flexibility if using a bundler like webpack and single file components:</p>
<div class="highlight"><pre class="chroma"><code class="language-js" data-lang="js"><span class="c1">// non-angular-link-directive.js
</span><span class="c1"></span><span class="k">export</span> <span class="k">const</span> <span class="nx">nonAngularLinkDirective</span> <span class="o">=</span> <span class="p">{</span>
  <span class="c1">// directive definition
</span><span class="c1"></span><span class="p">};</span>
</code></pre></div><div class="highlight"><pre class="chroma"><code class="language-html" data-lang="html">// MyComponent.vue
<span class="p">&lt;</span><span class="nt">template</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">a</span>
    <span class="na">href</span><span class="o">=</span><span class="s">&#34;/my-url&#34;</span>
    <span class="na">v-non-angular-link</span>
  <span class="p">&gt;</span>
    Go
  <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">template</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">nonAngularDirective</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;./non-angular-link.directive&#39;</span><span class="p">;</span>
<span class="k">export</span> <span class="k">default</span> <span class="p">{</span>
  <span class="nx">directives</span><span class="o">:</span> <span class="p">{</span>
    <span class="s1">&#39;non-angular-link&#39;</span><span class="o">:</span> <span class="nx">nonAngularLinkDirective</span>
  <span class="p">}</span>
<span class="p">};</span>
<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span></code></pre></div>
<h1 id="minimal-directive">A minimal directive API üëå</h1>

<p>A full <code>MyAnchor</code> single file component would look like the following:</p>
<div class="highlight"><pre class="chroma"><code class="language-html" data-lang="html">// MyAnchor.vue
<span class="p">&lt;</span><span class="nt">template</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">a</span>
    <span class="err">@</span><span class="na">click</span><span class="o">=</span><span class="s">&#34;goToUrl($event)&#34;</span>
    <span class="na">:href</span><span class="o">=</span><span class="s">&#34;href&#34;</span>
  <span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">slot</span> <span class="p">/&gt;</span>
  <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">template</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="k">export</span> <span class="k">default</span> <span class="p">{</span>
  <span class="nx">props</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">href</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">type</span><span class="o">:</span> <span class="nb">String</span><span class="p">,</span>
      <span class="nx">required</span><span class="o">:</span> <span class="kc">true</span>
    <span class="p">}</span>
  <span class="p">},</span>
  <span class="nx">methods</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">goToUrl</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
      <span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">assign</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">href</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">});</span>
<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span></code></pre></div>
<p>This is quite verbose and leverages a global DOM object&hellip; not ideal.
Here‚Äôs something similar using a directive:</p>
<div class="highlight"><pre class="chroma"><code class="language-js" data-lang="js"><span class="c1">// non-angular-link-directive.js
</span><span class="c1"></span><span class="k">export</span> <span class="k">const</span> <span class="nx">nonAngularLinkDirective</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">bind</span><span class="p">(</span><span class="nx">el</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">el</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">&#34;click&#34;</span><span class="p">,</span> <span class="nx">event</span> <span class="p">=&gt;</span> <span class="p">{</span>
      <span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
      <span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">assign</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">href</span><span class="p">);</span>
    <span class="p">});</span>
  <span class="p">}</span>
<span class="p">};</span>
</code></pre></div>
<p>This directive has to be used like so <code>&lt;a href=&quot;/my-url&quot; v-non-angular-link&gt;Go&lt;/a&gt;</code>, which isn‚Äôt the nicest API.
By leveraging the second parameter passed to <code>bind</code> we can write it so that it can be used like <code>&lt;a v-href=&quot;'/my-url'&quot;&gt;Go&lt;/a&gt;</code>
(for more information about <code>el</code> and <code>binding</code>, see <a href="https://vuejs.org/v2/guide/custom-directive.html#Directive-Hook-Arguments):">https://vuejs.org/v2/guide/custom-directive.html#Directive-Hook-Arguments):</a></p>
<div class="highlight"><pre class="chroma"><code class="language-js" data-lang="js"><span class="c1">// non-angular-link-directive.js
</span><span class="c1"></span><span class="k">export</span> <span class="k">const</span> <span class="nx">nonAngularLinkDirective</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">bind</span><span class="p">(</span><span class="nx">el</span><span class="p">,</span> <span class="nx">binding</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">el</span><span class="p">.</span><span class="nx">href</span> <span class="o">=</span> <span class="nx">binding</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
    <span class="nx">el</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">&#34;click&#34;</span><span class="p">,</span> <span class="nx">event</span> <span class="p">=&gt;</span> <span class="p">{</span>
      <span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
      <span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">assign</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">href</span><span class="p">);</span>
    <span class="p">});</span>
  <span class="p">}</span>
<span class="p">};</span>
</code></pre></div>
<p>We can now use it like using a local directive definition:</p>
<div class="highlight"><pre class="chroma"><code class="language-html" data-lang="html">// MyComponent.vue
<span class="p">&lt;</span><span class="nt">template</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">a</span> <span class="na">v-href</span><span class="o">=</span><span class="s">&#34;&#39;/my-url&#39;&#34;</span><span class="p">&gt;</span>Go<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">template</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">nonAngularLinkDirective</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;./non-angular-link.directive&#39;</span><span class="p">;</span>
<span class="k">export</span> <span class="k">default</span> <span class="p">{</span>
  <span class="nx">directives</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">href</span><span class="o">:</span> <span class="nx">nonAngularLinkDirective</span>
  <span class="p">}</span>
<span class="p">};</span>
<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span></code></pre></div>
<h1 id="hooks-and-remove">Vue directive hooks and <code>removeEventListener</code> üÜì</h1>

<p>For the full list of directive hooks, see <a href="https://vuejs.org/v2/guide/custom-directive.html#Hook-Functions">https://vuejs.org/v2/guide/custom-directive.html#Hook-Functions</a>.</p>

<p>As a good practice, the event listener should be removed when it‚Äôs not required any more.
This can be done in <code>unbind</code> much in the same way as it was added, there‚Äôs a catch though,
the arguments passed to <code>removeEventListener</code> have to be the same as the ones passed to <code>addEventListener</code>:</p>
<div class="highlight"><pre class="chroma"><code class="language-js" data-lang="js"><span class="c1">// non-angular-link-directive.js
</span><span class="c1"></span><span class="k">const</span> <span class="nx">handleClick</span> <span class="o">=</span> <span class="nx">event</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
  <span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">assign</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">href</span><span class="p">);</span>
<span class="p">};</span>
<span class="k">export</span> <span class="k">const</span> <span class="nx">nonAngularLinkDirective</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">bind</span><span class="p">(</span><span class="nx">el</span><span class="p">,</span> <span class="nx">binding</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">el</span><span class="p">.</span><span class="nx">href</span> <span class="o">=</span> <span class="nx">binding</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
    <span class="nx">el</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">&#34;click&#34;</span><span class="p">,</span> <span class="nx">handleClick</span><span class="p">);</span>
  <span class="p">},</span>
  <span class="nx">unbind</span><span class="p">(</span><span class="nx">el</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">el</span><span class="p">.</span><span class="nx">removeEventListener</span><span class="p">(</span><span class="s2">&#34;click&#34;</span><span class="p">,</span> <span class="nx">handleClick</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">};</span>
</code></pre></div>
<p>This will now remove the listener when the component where the directive is used is destroyed/un-mounts
and leaves us with no hanging listeners.</p>

<h1 id="handling-clicks">Handling clicks properly üñ±</h1>

<p>An edge case happens when an anchor contains an image: the <code>target</code> of the event is not the <code>anchor</code>,
but the <code>img</code>‚Ä¶ which doesn‚Äôt have a <code>href</code> attribute.</p>

<p>To deal with this, with a little knowledge of how <code>addEventListener</code> calls the passed handler,
we can refactor the <code>handleClick</code> function.</p>
<div class="highlight"><pre class="chroma"><code class="language-js" data-lang="js"><span class="c1">// non-angular-link-directive.js
</span><span class="c1"></span><span class="kd">function</span> <span class="nx">handleClick</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// The `this` context is the element
</span><span class="c1"></span>  <span class="c1">// on which the event listener is defined.
</span><span class="c1"></span>  <span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
  <span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">assign</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">href</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// rest stays the same
</span><span class="c1"></span></code></pre></div>
<p>By using a named functions and the <code>this</code> allows the event listener to bind
<code>this</code> to the element on which it‚Äôs attached as opposed to the lexical <code>this</code> of an arrow function.</p>

<h2 id="parting-thoughts">Parting thoughts üìö</h2>

<p>We use <code>window.location.assign</code> so as to allow to test easily. With Jest and <code>@vue/test-utils</code> a test at the component level should look like this:</p>
<div class="highlight"><pre class="chroma"><code class="language-js" data-lang="js"><span class="k">import</span> <span class="p">{</span> <span class="nx">shallowMount</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;@vue/test-utils&#39;</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">MyComponent</span> <span class="nx">from</span> <span class="s1">&#39;./MyComponent.vue&#39;</span><span class="p">;</span>

<span class="nx">test</span><span class="p">(</span><span class="s1">&#39;It should call window.location.assign with the right urls&#39;</span><span class="p">,</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="c1">// Stub window.location.assign
</span><span class="c1"></span>  <span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">assign</span> <span class="o">=</span> <span class="nx">jest</span><span class="p">.</span><span class="nx">fn</span><span class="p">();</span>

  <span class="k">const</span> <span class="nx">myComponent</span> <span class="o">=</span> <span class="nx">shallowMount</span><span class="p">(</span><span class="nx">MyComponent</span><span class="p">);</span>

  <span class="nx">myComponent</span><span class="p">.</span><span class="nx">findAll</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">).</span><span class="nx">wrappers</span><span class="p">.</span><span class="nx">forEach</span><span class="p">((</span><span class="nx">anchor</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="k">const</span> <span class="nx">mockEvent</span> <span class="o">=</span> <span class="p">{</span>
      <span class="nx">preventDefault</span><span class="o">:</span> <span class="nx">jest</span><span class="p">.</span><span class="nx">fn</span><span class="p">()</span>
    <span class="p">};</span>
    <span class="nx">anchor</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="nx">mockEvent</span><span class="p">);</span>
    <span class="nx">expect</span><span class="p">(</span><span class="nx">mockEvent</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">).</span><span class="nx">toHaveBeenCalled</span><span class="p">();</span>
    <span class="nx">expect</span><span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">assign</span><span class="p">).</span><span class="nx">toHaveBeenCalledWith</span><span class="p">(</span>
      <span class="nx">anchor</span><span class="p">.</span><span class="nx">attributes</span><span class="p">().</span><span class="nx">href</span>
    <span class="p">);</span>
<span class="p">});</span>
</code></pre></div>
<p>Directives allow you to contain pieces of code that interact with the DOM. This code needs to be generic enough to be used with the limited information available to a directive.</p>

<p>By coding against the DOM, we leverage the browser APIs instead of re-inventing them.</p>

<p>Cover photo by <a href="https://unsplash.com/photos/tjX_sniNzgQ?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText">frank mckenna</a> on <a href="https://unsplash.com/search/photos/contain?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText">Unsplash</a></p>
    
        </div>
    </section>

    <section class="subscribe-form">
        <h3 class="subscribe-form-title">Subscribe to Code with Hugo</h3>
        <p>Get all the posts of the week before anyone else in your inbox</p>
        <form
            action="https://buttondown.email/api/emails/embed-subscribe/hugo"
            method="post"
            target="popupwindow"
            onsubmit="window.open('https://buttondown.email/hugo', 'popupwindow')"
        >
            <div class="form-group">
                <input class="subscribe-email" type="email" name="email" id="bd-email" placeholder="youremail@example.com">
                <input type="hidden" value="1" name="embed"/>
            </div>
            <button class="" value="Subscribe" type="submit"><span>Subscribe</span></button>
        </form>
    </section>

    <footer class="post-full-footer">
      <section class="author-card">
        <img class="author-profile-image" src="https://cdn-images-1.medium.com/fit/c/200/200/0*Rb-aDjpTtV1UZA4O.jpeg" alt="Author" />
        <section class="author-card-content">
            <h4 class="author-card-name"><a href="https://codewithhugo.com/">Hugo Di Francesco</a></h4>
                <p>A developer, working out of London writing CSS, JavaScript and Python.</p>
        </section>
      </section>
    </footer>
</article>
    
    
    

  </div>
</main>


<aside class="read-next outer">
  <div class="inner">
    <div class="read-next-feed">      
      
<article class="read-next-card" 
            style="background-image: url(https://codewithhugo.com/img/cover.jpg);" >
    <header class="read-next-card-header">
        <small class="read-next-card-header-sitetitle">&mdash; Code with Hugo &mdash;</small>
        
        <h3 class="read-next-card-header-title"><a href="https://codewithhugo.com/tags/javascript/">#JavaScript</a></h3>
    </header>
    <div class="read-next-divider"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 14.5s2 3 5 3 5.5-2.463 5.5-5.5S21 6.5 18 6.5c-5 0-7 11-12 11C2.962 17.5.5 15.037.5 12S3 6.5 6 6.5s4.5 3.5 4.5 3.5"/></svg>
    </div>

    <div class="read-next-card-content">
      
        <ul>
          <li><a href="https://codewithhugo.com/setting-up-express-and-redis-with-docker-compose/">Setting up Express and Redis with Docker compose</a></li>            
        
          <li><a href="https://codewithhugo.com/animations-css-vs-javascript/">Animations: CSS vs JavaScript</a></li>            
        
          <li><a href="https://codewithhugo.com/just-enough-bash-to-be-dangerous/">Just enough bash to be dangerous</a></li>            
        
          <li><a href="https://codewithhugo.com/how-components-won-the-framework-wars/">How components won the ‚Äúframework wars‚Äù</a></li>            
        </ul>
    </div>
    <footer class="read-next-card-footer">
      
        <a href="https://codewithhugo.com/tags/javascript/">See all related posts ‚Üí</a>
    </footer>
</article>


      
      <article class="post-card post"> 
    
    <a class="post-card-image-link" href="https://codewithhugo.com/split-an-existing-git-commit/">
      <div class="post-card-image" style="background-image: url(https://codewithhugo.com/img/markus-spiske-unsplash.jpg)"></div>
    </a>
    

    <div class="post-card-content">
      <a class="post-card-content-link" href="https://codewithhugo.com/split-an-existing-git-commit/">
          <header class="post-card-header">
              <span class="post-card-tags">
              #git 
              #web development 
              #productivity  </span>
              
              <h2 class="post-card-title">Split an existing git commit</h2>
          </header>
          <section class="post-card-excerpt">
              
                <p>One of git&rsquo;s main differences when compared to other version control systems is that it lets the user rewrite the history. The main way to do this is to use git rebase, usually followed by a git push --force to overwrite history the remote with the local history.
Here‚Äôs a look at how to split existing commits using rebase, reset and commit.
Say you have two files edited in a commit (A and B) and you would like to get the changes from one of those files (A) into your current branch but not those from the other (B). ...  </p>
              
          </section>
      </a>

      <footer class="post-card-meta">
          <img class="author-profile-image" src="https://cdn-images-1.medium.com/fit/c/200/200/0*Rb-aDjpTtV1UZA4O.jpeg" alt="Author" />
          <span class="post-card-author"><a href="/">Hugo Di Francesco</a></span>
      </footer>
    </div>
</article>
      
      
      <article class="post-card post"> 
    
    <a class="post-card-image-link" href="https://codewithhugo.com/using-es6-classes-for-sequelize-4-models/">
      <div class="post-card-image" style="background-image: url(https://codewithhugo.com/img/eugene-lim-unsplash.jpg)"></div>
    </a>
    

    <div class="post-card-content">
      <a class="post-card-content-link" href="https://codewithhugo.com/using-es6-classes-for-sequelize-4-models/">
          <header class="post-card-header">
              <span class="post-card-tags">
              #JavaScript 
              #Node 
              #productivity 
              #web development  </span>
              
              <h2 class="post-card-title">Using ES6 classes for Sequelize 4 models</h2>
          </header>
          <section class="post-card-excerpt">
              
                <p>The ES2015 or ES6 specification introduced class to JavaScript. Libraries like React went from React.createClass to class MyComponent extends React.Component, ie went from rolling their own constructor to leveraging a language built-in to convey the programmer‚Äôs intent.
For a Node.js web application‚Äôs persistence layer, a few databases come to mind like MongoDB (possibly paired with mongoose), or a key-value store like Redis.
To run a relational database with a Node application, Sequelize, ‚ÄúAn easy-to-use multi SQL dialect ORM for Node. ...  </p>
              
          </section>
      </a>

      <footer class="post-card-meta">
          <img class="author-profile-image" src="https://cdn-images-1.medium.com/fit/c/200/200/0*Rb-aDjpTtV1UZA4O.jpeg" alt="Author" />
          <span class="post-card-author"><a href="/">Hugo Di Francesco</a></span>
      </footer>
    </div>
</article>
      
    </div>
  </div>
</aside>

<div class="floating-header">
  <div class="floating-header-logo">
    <a href="https://codewithhugo.com/">
      
      <span>Code with Hugo</span>
    </a>
  </div>
  <span class="floating-header-divider">&mdash;</span>
  <div class="floating-header-title">A simple, real-world Vue.js directive</div>
  <div class="floating-header-share">
    <div class="floating-header-share-label">Share this <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
     <path d="M7.5 15.5V4a1.5 1.5 0 1 1 3 0v4.5h2a1 1 0 0 1 1 1h2a1 1 0 0 1 1 1H18a1.5 1.5 0 0 1 1.5 1.5v3.099c0 .929-.13 1.854-.385 2.748L17.5 23.5h-9c-1.5-2-5.417-8.673-5.417-8.673a1.2 1.2 0 0 1 1.76-1.605L7.5 15.5zm6-6v2m-3-3.5v3.5m6-1v2"/></svg>
    </div>
    
    <a class="floating-header-share-tw" href="https://twitter.com/share?text=A%20simple%2c%20real-world%20Vue.js%20directive&amp;url=https%3a%2f%2fcodewithhugo.com%2fa-simple-real-world-vue.js-directive%2f"
          onclick="window.open(this.href, 'share-twitter', 'width=550,height=235');return false;">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M30.063 7.313c-.813 1.125-1.75 2.125-2.875 2.938v.75c0 1.563-.188 3.125-.688 4.625a15.088 15.088 0 0 1-2.063 4.438c-.875 1.438-2 2.688-3.25 3.813a15.015 15.015 0 0 1-4.625 2.563c-1.813.688-3.75 1-5.75 1-3.25 0-6.188-.875-8.875-2.625.438.063.875.125 1.375.125 2.688 0 5.063-.875 7.188-2.5-1.25 0-2.375-.375-3.375-1.125s-1.688-1.688-2.063-2.875c.438.063.813.125 1.125.125.5 0 1-.063 1.5-.25-1.313-.25-2.438-.938-3.313-1.938a5.673 5.673 0 0 1-1.313-3.688v-.063c.813.438 1.688.688 2.625.688a5.228 5.228 0 0 1-1.875-2c-.5-.875-.688-1.813-.688-2.75 0-1.063.25-2.063.75-2.938 1.438 1.75 3.188 3.188 5.25 4.25s4.313 1.688 6.688 1.813a5.579 5.579 0 0 1 1.5-5.438c1.125-1.125 2.5-1.688 4.125-1.688s3.063.625 4.188 1.813a11.48 11.48 0 0 0 3.688-1.375c-.438 1.375-1.313 2.438-2.563 3.188 1.125-.125 2.188-.438 3.313-.875z"/></svg>
      </a>
      <a class="floating-header-share-fb" href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fcodewithhugo.com%2fa-simple-real-world-vue.js-directive%2f"
          onclick="window.open(this.href, 'share-facebook','width=580,height=296');return false;">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M19 6h5V0h-5c-3.86 0-7 3.14-7 7v3H8v6h4v16h6V16h5l1-6h-6V7c0-.542.458-1 1-1z"/></svg>
      </a>
  </div>

  <progress class="progress" value="0">
    <div class="progress-container">
      <span class="progress-bar"></span>
    </div>
  </progress>
</div>



<footer class="site-footer outer">
  <div class="site-footer-content inner">
    <section class="copyright" style="line-height: 1.3em;">
      <a href="/">Code with Hugo</a>  <br>
      
    </section>
    <nav class="site-footer-nav">
        <a href="/">Latest Posts</a>
        
        <a href="https://twitter.com/hugo__df" target="_blank" rel="noopener">Twitter</a>
        <a href="https://github.com/HugoDF" target="_blank" rel="noopener">Github</a>
        
        <a href="https://medium.com/@hugo__df" target="_blank" rel="noopener">Medium</a>
    </nav>  
  </div>
</footer>

</div>

<script type="text/javascript" src="//code.jquery.com/jquery-3.2.1.min.js"></script>
<script type="text/javascript" src="https://codewithhugo.com/js/jquery.fitvids.js"></script>




  <!-- Google Analytics -->
  <script>
    var _gaq=[['_setAccount','UA-60469708-1'],['_trackPageview']];
    (function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];
    g.src=('https:'==location.protocol?'//ssl':'//www')+'.google-analytics.com/ga.js';
    s.parentNode.insertBefore(g,s)}(document,'script'));
  </script>



<script async src="//simplewebsiteanalytics.com/hello.js"></script> 
<noscript><img src="//simplewebsiteanalytics.com/hello.gif" alt=""></noscript>

    <script>





$(document).ready(function () {
    
    var $postContent = $(".post-full-content");
    $postContent.fitVids();
    

    var progressBar = document.querySelector('progress');
    var header = document.querySelector('.floating-header');
    var title = document.querySelector('.post-full-title');

    var lastScrollY = window.scrollY;
    var lastWindowHeight = window.innerHeight;
    var lastDocumentHeight = $(document).height();
    var ticking = false;

    function onScroll() {
        lastScrollY = window.scrollY;
        requestTick();
    }

    function onResize() {
        lastWindowHeight = window.innerHeight;
        lastDocumentHeight = $(document).height();
        requestTick();
    }

    function requestTick() {
        if (!ticking) {
            requestAnimationFrame(update);
        }
        ticking = true;
    }

    function update() {
        var trigger = title.getBoundingClientRect().top + window.scrollY;
        var triggerOffset = title.offsetHeight + 35;
        var progressMax = lastDocumentHeight - lastWindowHeight;

        
        if (lastScrollY >= trigger + triggerOffset) {
            header.classList.add('floating-active');
        } else {
            header.classList.remove('floating-active');
        }

        progressBar.setAttribute('max', progressMax);
        progressBar.setAttribute('value', lastScrollY);

        ticking = false;
    }

    window.addEventListener('scroll', onScroll, {passive: true});
    window.addEventListener('resize', onResize, false);

    update();
});
</script>
</body></html>
